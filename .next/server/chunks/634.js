"use strict";exports.id=634,exports.ids=[634],exports.modules={6634:(e,t,l)=>{l.d(t,{Z:()=>f});var s=l(326),a=l(7577),r=l(1709),n=l(6283),o=l(2881);let i=(0,o.Z)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);var c=l(3855);let d=(0,o.Z)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),u=(0,o.Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var m=l(2374);let g={async sendChatMessageWithFiles(e,t,l){console.log("=== FILE SERVICE DEBUG START ==="),console.log("Message:",e),console.log("Files count:",t.length),console.log("ConversationId received:",l),console.log("ConversationId type:",typeof l),console.log("ConversationId truthy?",!!l),console.log('ConversationId === "undefined"?',"undefined"===l),console.log("ConversationId === undefined?",void 0===l),console.log("ConversationId === null?",null===l),console.log('ConversationId === ""?',""===l);let s=new FormData;for(let[t,a]of(s.append("message",e),l&&"undefined"!==l&&"null"!==l&&""!==l.trim()?(console.log("✅ Appending conversation_id to FormData:",l),s.append("conversation_id",l.trim())):(console.log("❌ NOT appending conversation_id - will create new conversation"),console.log("  Reason: conversationId is",l)),console.log("FormData contents before files:"),s.entries()))"string"==typeof a?console.log(`  ${t}: "${a}"`):console.log(`  ${t}:`,a);t.forEach((e,t)=>{console.log(`Appending file ${t}: ${e.name} (${e.size} bytes, ${e.type})`),s.append("files",e)}),console.log("Final FormData entries:");let a=!1;for(let[e,t]of s.entries())"conversation_id"===e?(a=!0,console.log(`  ✅ ${e}: "${t}"`)):"message"===e?console.log(`  ${e}: "${t}"`):"files"===e?console.log(`  ${e}: [File object]`):console.log(`  ${e}:`,t);console.log("Has conversation_id in FormData?",a);try{console.log("\uD83D\uDE80 Making API call to /api/chat/message-with-files");let e=Date.now(),{data:t}=await m.h.post("/api/chat/message-with-files",s,{headers:{"Content-Type":"multipart/form-data"},timeout:12e4}),a=Date.now();return console.log("✅ API Response received in",a-e,"ms"),console.log("Response data:",{conversation_id:t.conversation_id,intent:t.intent,response_preview:t.response?.substring(0,100)+"...",attachment_processed:t.attachment_processed,blocks_count:t.blocks?.length||0}),l&&t.conversation_id&&l!==t.conversation_id?(console.log("⚠️ CONVERSATION ID MISMATCH!"),console.log("  Sent:",l),console.log("  Received:",t.conversation_id)):!l&&t.conversation_id?console.log("✅ New conversation created:",t.conversation_id):l&&t.conversation_id&&l===t.conversation_id&&console.log("✅ Message added to existing conversation:",t.conversation_id),console.log("=== FILE SERVICE DEBUG END ==="),t}catch(e){throw console.error("❌ FILE SERVICE ERROR:",e),console.error("Error details:",{status:e.response?.status,statusText:e.response?.statusText,data:e.response?.data,message:e.message}),Error(e.response?.data?.detail||e.message||"File processing failed")}},async testFileUpload(e){console.log("Testing file upload for:",e.name);let t=new FormData;t.append("file",e);try{let{data:e}=await m.h.post("/api/test/upload-file",t,{headers:{"Content-Type":"multipart/form-data"}});return console.log("Test upload successful:",e),e}catch(e){throw console.error("Test upload failed:",e),Error(e.response?.data?.detail||"Test upload failed")}},async testCompleteProcessing(e,t="What is this document about?"){console.log("Testing complete processing for:",e.name);let l=new FormData;l.append("file",e),l.append("message",t);try{let{data:e}=await m.h.post("/api/test/test-ollama",l,{headers:{"Content-Type":"multipart/form-data"},timeout:12e4});return console.log("Complete processing test successful"),e}catch(e){throw console.error("Complete processing test failed:",e),Error(e.response?.data?.detail||"Test processing failed")}},async healthCheck(){try{let{data:e}=await m.h.get("/api/test/health/services");return console.log("Health check result:",e),e}catch(e){return console.error("Health check failed:",e),{status:"unhealthy",error:e.response?.data?.detail||"Health check failed"}}},async checkOllamaHealth(){try{let{data:e}=await m.h.get("/api/chat/health/ollama");return console.log("Ollama health check result:",e),e}catch(e){return console.error("Ollama health check failed:",e),{ollama_available:!1,error:e.response?.data?.detail||"Ollama health check failed"}}},utils:{formatFileSize:e=>e<1024?e+" B":e<1048576?Math.round(e/1024)+" KB":Math.round(e/1048576*100)/100+" MB",validateFileClientSide(e){return["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/bmp","image/tiff","application/pdf"].includes(e.type)?e.size>10485760?{valid:!1,error:`File too large: ${this.formatFileSize(e.size)}. Maximum: 10MB`}:{valid:!0}:{valid:!1,error:`Unsupported file type: ${e.type}. Supported: images and PDFs`}},getFileExtension:e=>"."+e.split(".").pop()?.toLowerCase(),isImageFile:e=>e.type.startsWith("image/"),isPDFFile:e=>"application/pdf"===e.type,createPreviewURL(e){return this.isImageFile(e)?URL.createObjectURL(e):null},revokePreviewURL(e){try{URL.revokeObjectURL(e)}catch(t){console.warn("Failed to revoke URL:",e)}},getFileTypeDescription(e){return this.isImageFile(e)?"Image":this.isPDFFile(e)?"PDF Document":"Document"},validateMultipleFiles(e){let t=[],l=[];return e.length>5&&(e.slice(5).forEach(e=>{l.push({file:e,error:"Maximum 5 files allowed per message"})}),e=e.slice(0,5)),e.forEach(e=>{let s=this.validateFileClientSide(e);s.valid?t.push(e):l.push({file:e,error:s.error||"Invalid file"})}),{valid:t,invalid:l}},debugConversationId(e){console.log("=== CONVERSATION ID DEBUG ==="),console.log("Value:",e),console.log("Type:",typeof e),console.log("String value:",String(e)),console.log("JSON stringify:",JSON.stringify(e)),console.log("Truthy:",!!e),console.log("Is undefined:",void 0===e),console.log("Is null:",null===e),console.log("Is empty string:",""===e),console.log('Is "undefined" string:',"undefined"===e),console.log('Is "null" string:',"null"===e),console.log("Length (if string):","string"==typeof e?e.length:"N/A"),console.log("Trimmed (if string):","string"==typeof e?`"${e.trim()}"`:"N/A"),console.log("=== END DEBUG ===")}}},h={MAX_FILE_SIZE_MB:10,SUPPORTED_TYPES:["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/bmp","image/tiff","application/pdf"]};var p=l(9366),x=l(7285);function f({onSend:e,onSendWithFiles:t,onFileProcessingComplete:l,onNewMessage:o,busy:m,conversationId:f}){let[v,b]=(0,a.useState)(""),[y,w]=(0,a.useState)(!1),[j,k]=(0,a.useState)([]),[N,F]=(0,a.useState)(!1),[I,C]=(0,a.useState)(null),[E,D]=(0,a.useState)({top:0,left:0}),_=(0,a.useRef)(null),S=(0,a.useRef)(null),M=(0,a.useRef)(null),R=(0,a.useRef)(null),T=async(l,s)=>{let a=l||v.trim();if(a&&x.z5.send({type:"auto-collapse"}),j.length>0&&!N){if(!a){C("Please enter a message to send with the file(s)");return}F(!0),C(null);try{if(console.log("=== FILE UPLOAD DEBUG ==="),console.log("Message:",a),console.log("Files:",j.length),console.log("ConversationId from props:",f),console.log("onSendWithFiles exists:",!!t),t)console.log("Using onSendWithFiles handler - existing chat flow"),await t(a,j,f);else{console.log("Using chatService.sendMessageWithFiles - new chat flow"),console.log("ConversationId being passed:",f);let t=await p.A.sendMessageWithFiles(a,j,f);console.log("Chat service response:",{conversation_id:t.conversation_id,intent:t.intent,attachment_processed:t.attachment_processed});let l={type:"file_processing_complete",conversation_id:t.conversation_id,attachment_processed:t.attachment_processed,files_count:j.length,backend_response:t};await e(a,l)}k([]),b("")}catch(e){C(e instanceof Error?e.message:"File processing failed"),console.error("File processing error:",e)}finally{F(!1)}return}if(a&&!m&&!N){l||b("");try{await e(a,s)}catch(e){console.error("Error in ChatInput:",e)}_.current?.focus()}},P=async e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),await T())},z=e=>{S.current&&(S.current.accept=e,S.current.click()),w(!1)},U=e=>{let t=j[e];g.utils.isImageFile(t),k(t=>t.filter((t,l)=>l!==e)),C(null)},$=e=>g.utils.formatFileSize(e),L=(v.trim()||j.length>0)&&!m&&!N,O=m||N;return(0,s.jsxs)(s.Fragment,{children:[s.jsx("div",{className:"pt-2 pb-3 bg-gradient-to-t from-neutral-100/60 via-neutral-50/20 to-transparent dark:from-neutral-950/60 dark:via-neutral-950/20",children:(0,s.jsxs)("div",{className:"mx-auto max-w-4xl px-4 sm:px-6",children:[(0,s.jsxs)("div",{className:"border border-neutral-300/60 bg-white/70 dark:border-neutral-700/60 dark:bg-neutral-900/70 rounded-2xl sm:rounded-3xl shadow-[var(--shadow-soft)] relative overflow-visible",children:[j.length>0&&(0,s.jsxs)("div",{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-2",children:[s.jsx("div",{className:"flex flex-wrap gap-2",children:j.map((e,t)=>s.jsx("div",{className:"relative w-12 h-12 sm:w-16 sm:h-16",title:`${e.name} (${$(e.size)}) - ${g.utils.getFileTypeDescription(e)}`,children:(0,s.jsxs)("div",{className:"w-full h-full bg-neutral-200 dark:bg-neutral-700 rounded-lg sm:rounded-xl overflow-hidden border border-neutral-300 dark:border-neutral-600 group relative",children:[g.utils.isImageFile(e)?s.jsx("img",{src:URL.createObjectURL(e),alt:e.name,className:"w-full h-full object-cover",onLoad:e=>{let t=e.target;setTimeout(()=>{try{URL.revokeObjectURL(t.src)}catch(e){}},1e3)},onError:e=>{e.target.style.display="none"}}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full bg-neutral-300 dark:bg-neutral-600 text-xs",children:[s.jsx(n.Z,{size:16,className:"sm:w-5 sm:h-5 text-neutral-600 dark:text-neutral-300 mb-1"}),s.jsx("span",{className:"text-[9px] sm:text-[10px] text-neutral-500 dark:text-neutral-400 text-center px-1 leading-tight",children:g.utils.isPDFFile(e)?"PDF":"DOC"})]}),N&&s.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:s.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"})}),s.jsx("button",{onClick:e=>{e.stopPropagation(),U(t)},className:"absolute -top-1 -right-1 sm:-top-2 sm:-right-2 w-5 h-5 sm:w-6 sm:h-6 bg-red-500 hover:bg-red-600 rounded-full  flex items-center justify-center opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all duration-200 shadow-lg border-2 border-white z-20 touch-manipulation",disabled:N,"aria-label":`Remove ${e.name}`,children:s.jsx(i,{size:10,className:"sm:w-3.5 sm:h-3.5 text-white"})})]})},`${e.name}-${e.size}-${t}`))}),j.length>1&&(0,s.jsxs)("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:[j.length," files selected (",j.reduce((e,t)=>e+t.size,0)>1048576?$(j.reduce((e,t)=>e+t.size,0)):$(j.reduce((e,t)=>e+t.size,0))," total)"]})]}),(0,s.jsxs)("div",{className:"px-3 sm:px-4 py-2 sm:py-3",children:[s.jsx("div",{children:s.jsx("textarea",{ref:_,value:v,onChange:e=>b(e.target.value),onKeyDown:P,placeholder:j.length>0?"Ask me about these files...":N?"Processing files...":"Reply to Olaji Chat...","aria-label":"Chat message",className:"w-full bg-transparent outline-none resize-none text-base sm:text-lg leading-relaxed text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-500 dark:placeholder:text-neutral-500 disabled:opacity-50 min-h-[36px] max-h-[120px] py-1 px-0",disabled:O,maxLength:2e3,rows:1})}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[s.jsx("div",{className:"relative",ref:M,children:s.jsx("button",{ref:R,onClick:()=>{if(!y&&R.current){let e=R.current.getBoundingClientRect(),t=window.scrollY,l=window.innerWidth,s=e.left,a=e.top+t-10;l<640&&(s=Math.max(16,Math.min(l-216,e.left)),a=e.top+t-80),D({top:a,left:s})}w(!y),C(null)},className:"flex items-center justify-center w-9 h-9 sm:w-10 sm:h-10 text-neutral-600 hover:text-neutral-800  dark:text-neutral-400 dark:hover:text-neutral-200 transition-colors duration-200 touch-manipulation disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Attach files",disabled:O,children:s.jsx(c.Z,{size:18})})}),s.jsx("input",{ref:S,type:"file",onChange:e=>{let t=e.target.files;if(!t||0===t.length)return;let l=Array.from(t),s=g.utils.validateMultipleFiles([...j,...l]);if(s.invalid.length>0?C(s.invalid.map(e=>`${e.file.name}: ${e.error}`).join(", ")):C(null),s.valid.length>0){let e=s.valid.filter(e=>!j.some(t=>t.name===e.name&&t.size===e.size));e.length>0?k(t=>[...t,...e]):0===s.invalid.length&&C("Some files are already selected")}S.current&&(S.current.value="")},className:"hidden",multiple:!0,accept:h.SUPPORTED_TYPES.join(",")}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex items-center",children:(0,s.jsxs)("span",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:["Olaji"," ",s.jsx("span",{style:{color:"var(--color-brand)"},children:"Chat"})]})}),s.jsx("button",{className:"flex items-center justify-center w-10 h-10 sm:w-11 sm:h-11 rounded-full transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation shadow-lg hover:shadow-xl",style:{backgroundColor:L?"var(--color-brand)":"var(--color-neutral-300)",color:"white"},onMouseEnter:e=>{L&&(e.currentTarget.style.backgroundColor="var(--color-brand-dark)")},onMouseLeave:e=>{L&&(e.currentTarget.style.backgroundColor="var(--color-brand)")},onClick:()=>T(),disabled:!L,"aria-label":j.length>0?"Send message with files":"Send message",children:O?s.jsx("div",{className:"flex items-center justify-center",children:s.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"})}):s.jsx(d,{size:18,className:"sm:w-5 sm:h-5"})})]})]})]})]}),I&&s.jsx("div",{className:"mt-3 text-sm bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[s.jsx(u,{size:16,className:"text-red-600 dark:text-red-400 mt-0.5 flex-shrink-0"}),s.jsx("div",{className:"text-red-600 dark:text-red-400",children:I})]})}),N&&s.jsx("div",{className:"mt-3 text-sm text-neutral-600 dark:text-neutral-400 bg-neutral-50 dark:bg-neutral-800 p-3 rounded text-center",children:(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[s.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Processing ",j.length," file",1!==j.length?"s":"","..."]})}),v.length>1500&&(0,s.jsxs)("div",{className:"text-xs text-neutral-500 text-right mt-2 hidden sm:block",children:[v.length,"/2000"]}),j.length>0&&!N&&(0,s.jsxs)("div",{className:"mt-3 text-sm text-neutral-500 dark:text-neutral-400 text-center",children:["I'll analyze your ",j.length," file",1!==j.length?"s":""," along with your message"]})]})}),y&&(0,s.jsxs)("div",{className:"fixed bg-white dark:bg-neutral-800  border border-neutral-200 dark:border-neutral-700 rounded-lg shadow-xl  min-w-[180px] sm:min-w-[200px] z-[999] py-2 transform -translate-y-full",style:{top:E.top,left:E.left},ref:M,children:[(0,s.jsxs)("button",{onClick:()=>z("image/*"),className:"flex items-center gap-3 w-full px-4 py-2.5 text-sm text-neutral-700  dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-700  transition-colors text-left",children:[s.jsx(r.Z,{size:16,className:"text-neutral-500 dark:text-neutral-400"}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("div",{children:"Attach Images"}),s.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"JPG, PNG, GIF, WebP, etc."})]})]}),(0,s.jsxs)("button",{onClick:()=>z("application/pdf"),className:"flex items-center gap-3 w-full px-4 py-2.5 text-sm text-neutral-700  dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-700  transition-colors text-left",children:[s.jsx(n.Z,{size:16,className:"text-neutral-500 dark:text-neutral-400"}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("div",{children:"Upload PDF"}),s.jsx("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"PDF documents up to 10MB"})]})]}),(0,s.jsxs)("button",{onClick:()=>z(h.SUPPORTED_TYPES.join(",")),className:"flex items-center gap-3 w-full px-4 py-2.5 text-sm text-neutral-700  dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-700  transition-colors text-left",children:[s.jsx("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center",children:s.jsx("div",{className:"w-2 h-2 bg-white rounded-sm"})}),(0,s.jsxs)("div",{className:"flex-1",children:[s.jsx("div",{children:"Any File Type"}),(0,s.jsxs)("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:["Images, PDFs (max ",h.MAX_FILE_SIZE_MB,"MB each)"]})]})]})]})]})}},6283:(e,t,l)=>{l.d(t,{Z:()=>s});let s=(0,l(2881).Z)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},1709:(e,t,l)=>{l.d(t,{Z:()=>s});let s=(0,l(2881).Z)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]])}};