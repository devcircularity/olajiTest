exports.id=189,exports.ids=[189],exports.modules={7529:()=>{},2189:(e,t,s)=>{Promise.resolve().then(s.bind(s,3136))},1625:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},3136:(e,t,s)=>{"use strict";s.d(t,{AuthProvider:()=>i,a:()=>c});var o=s(326),n=s(7577),a=s(5047);let r=(0,n.createContext)({token:null,active_school_id:null,isLoading:!0,login:async()=>{},logout:()=>{},setSchoolId:()=>{},isAuthenticated:!1});function i({children:e}){let[t,s]=(0,n.useState)({token:null,active_school_id:null,isLoading:!0}),i=(0,a.useRouter)(),c=async e=>{localStorage.setItem("token",e.token),s(t=>({...t,token:e.token,isLoading:!1}))},l={...t,login:c,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),s({token:null,active_school_id:null,isLoading:!1}),i.replace("/login")},setSchoolId:e=>{localStorage.setItem("active_school_id",e),s(t=>({...t,active_school_id:e}))},isAuthenticated:!!t.token&&!t.isLoading};return o.jsx(r.Provider,{value:l,children:e})}let c=()=>(0,n.useContext)(r)},798:(e,t,s)=>{"use strict";s.d(t,{x:()=>a}),s(7577);var o=s(5047),n=s(3136);function a(e="/login"){let{token:t,isLoading:s}=(0,n.a)();return(0,o.useRouter)(),{isAuthenticated:!!t&&!s,isLoading:s}}},2374:(e,t,s)=>{"use strict";s.d(t,{h:()=>o});let o=s(4099).Z.create({baseURL:"http://localhost:8000",timeout:2e4});o.interceptors.request.use(e=>e),o.interceptors.response.use(e=>e,e=>(e.response?.status===401&&(console.error("Unauthorized request detected"),localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),window.location.href="/login"),Promise.reject(e)))},9366:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var o=s(2374),n=s(2366);let a=e=>e.map(e=>{let t="USER"===e.message_type?"user":"assistant";e.response_data?.attachments&&(console.log("=== TRANSFORMING MESSAGE WITH ATTACHMENTS ==="),console.log("Original message:",{id:e.id,message_type:e.message_type,content:e.content.substring(0,50)+"...",response_data:e.response_data}),console.log("Attachments found:",e.response_data.attachments.length),console.log("Will be role:",t));let s={role:t,content:e.content,blocks:"assistant"===t&&e.response_data?.blocks?e.response_data.blocks:void 0,response_data:e.response_data,intent:e.intent,id:e.id,timestamp:e.created_at};return s.response_data?.attachments&&console.log("Transformed display message:",{role:s.role,hasAttachments:!!s.response_data?.attachments,attachmentCount:s.response_data.attachments.length}),s}),r={async sendMessage(e,t,s){let a=(0,n.rc)()??void 0;console.log("=== CHAT SERVICE SEND MESSAGE ==="),console.log("Message:",e),console.log("ConversationId:",t),console.log("Context:",s);try{let{data:r}=await o.h.post("/api/chat/message",{message:e,conversation_id:t,context:s});return console.log("Chat service response:",{conversation_id:r.conversation_id,intent:r.intent,response_preview:r.response?.substring(0,100)}),r.conversation_id&&(t?n.MN.messageSent(r.conversation_id,{message:e,response:r.response},a):n.MN.conversationCreated(r.conversation_id,{title:e.slice(0,50)},a)),r}catch(e){throw console.error("Failed to send message:",e),e}},async sendMessageWithFiles(e,t,s){let a=(0,n.rc)()??void 0;console.log("=== CHAT SERVICE SEND MESSAGE WITH FILES ==="),console.log("Message:",e),console.log("Files count:",t.length),console.log("ConversationId:",s),console.log("ConversationId type:",typeof s),console.log("ConversationId truthy:",!!s),s&&"new"!==s&&"undefined"!==s?console.log("âœ… Using existing conversation:",s):(console.log("\uD83D\uDCDD Will create new conversation"),s=void 0);let r=new FormData;for(let[o,n]of(r.append("message",e),s?(console.log("Appending conversation_id to form:",s),r.append("conversation_id",s)):console.log("Not appending conversation_id - will create new"),t.forEach((e,t)=>{console.log(`Appending file ${t}:`,e.name),r.append("files",e)}),console.log("FormData entries:"),r.entries()))"files"===o?console.log(`  ${o}: [File object]`):console.log(`  ${o}:`,n);try{console.log("\uD83D\uDE80 Making API call to /api/chat/message-with-files");let{data:t}=await o.h.post("/api/chat/message-with-files",r,{headers:{"Content-Type":"multipart/form-data"},timeout:12e4});return console.log("File message response:",{conversation_id:t.conversation_id,intent:t.intent,attachment_processed:t.attachment_processed,response_preview:t.response?.substring(0,100)}),t.conversation_id&&(s?n.MN.messageSent(t.conversation_id,{message:e,response:t.response},a):n.MN.conversationCreated(t.conversation_id,{title:e.slice(0,50)},a)),t}catch(e){throw console.error("Failed to send message with files:",e),Error(e.response?.data?.detail||e.message||"File processing failed")}},async getSuggestions(){let{data:e}=await o.h.get("/api/chat/suggestions");return e},async getConversations(e=1,t=20,s=!1){try{let{data:n}=await o.h.get("/api/chat/conversations",{params:{page:e,limit:t,include_archived:s}});return n}catch(e){throw console.error("Failed to get conversations:",e),e}},async getConversation(e){try{console.log("=== GETTING CONVERSATION ===",e);let{data:t}=await o.h.get(`/api/chat/conversations/${e}`);console.log("Raw conversation data:",{id:t.id,title:t.title,messageCount:t.messages?.length||0}),t.messages&&t.messages.forEach((e,t)=>{e.response_data?.attachments&&console.log(`Message ${t} has attachments:`,{message_type:e.message_type,content:e.content.substring(0,50),attachments:e.response_data.attachments.length})});let s=a(t.messages||[]);return console.log("Transformed display messages:",s.length),s.forEach((e,t)=>{e.response_data?.attachments&&console.log(`Display message ${t}:`,{role:e.role,hasAttachments:!0,attachmentCount:e.response_data.attachments.length})}),{...t,displayMessages:s}}catch(e){throw console.error("Failed to get conversation:",e),e}},async updateConversation(e,t){let s=(0,n.rc)()??void 0;try{let{data:a}=await o.h.patch(`/api/chat/conversations/${e}`,t);return n.MN.conversationUpdated(e,t,s),a}catch(e){throw console.error("Failed to update conversation:",e),e}},async deleteConversation(e){let t=(0,n.rc)()??void 0;try{await o.h.delete(`/api/chat/conversations/${e}`),n.MN.conversationDeleted(e,t)}catch(e){throw console.error("Failed to delete conversation:",e),e}},async getRecentConversations(e=7,t=10){try{let{data:s}=await o.h.get("/api/chat/conversations/recent",{params:{days:e,limit:t}});return s}catch(e){throw console.error("Failed to get recent conversations:",e),e}},async searchConversations(e,t=20){try{let{data:s}=await o.h.get("/api/chat/conversations/search",{params:{q:e,limit:t}});return s}catch(e){throw console.error("Failed to search conversations:",e),e}},forceRefresh(){let e=(0,n.rc)()??void 0;n.MN.forceRefresh(e)},async list(){return(await this.getConversations(1,50)).conversations.map(e=>({id:e.id,title:e.title,is_starred:!1,created_at:e.created_at,updated_at:e.last_activity}))},async get(e){let t=await this.getConversation(e);return{chat:{id:t.id,title:t.title,is_starred:!1},messages:t.displayMessages}},create:async()=>({id:"new",title:"New Chat",messages:[]}),async update(e,t){return t.title&&await this.updateConversation(e,{title:t.title}),{id:e,...t}},async delete(e){await this.deleteConversation(e)},star:async e=>(console.warn("Starring not implemented on backend yet"),{id:e,is_starred:!0}),unstar:async e=>(console.warn("Unstarring not implemented on backend yet"),{id:e,is_starred:!1}),async rename(e,t){return await this.updateConversation(e,{title:t})}}},2366:(e,t,s)=>{"use strict";s.d(t,{MN:()=>n,rc:()=>a}),s(7577);class o{constructor(){this.listeners=new Map,this.lastEventTimestamp=0,this.handleStorageEvent=e=>{if("chat_event"===e.key&&e.newValue)try{let t=JSON.parse(e.newValue);if(t.timestamp<=this.lastEventTimestamp)return;this.lastEventTimestamp=t.timestamp,this.notifyListeners(t)}catch(e){console.error("Error parsing chat event:",e)}},this.handleWindowFocus=()=>{this.broadcast("force_refresh")},this.handleVisibilityChange=()=>{document.hidden||this.broadcast("force_refresh")}}notifyListeners(e){let t=this.listeners.get(e.type)||[],s=this.listeners.get("*")||[];t.concat(s).forEach(t=>{try{t(e)}catch(e){console.error("Error in chat event listener:",e)}})}subscribe(e,t){return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t),()=>{let s=this.listeners.get(e)||[],o=s.indexOf(t);o>-1&&s.splice(o,1)}}broadcast(e,t,s,o){}conversationCreated(e,t,s){this.broadcast("conversation_created",e,t,s)}conversationUpdated(e,t,s){this.broadcast("conversation_updated",e,t,s)}conversationDeleted(e,t){this.broadcast("conversation_deleted",e,void 0,t)}messageSent(e,t,s){this.broadcast("message_sent",e,t,s)}forceRefresh(e){this.broadcast("force_refresh",void 0,void 0,e)}destroy(){this.listeners.clear()}}let n=new o;function a(){return null}},7449:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d,metadata:()=>l});var o=s(9510);s(7272),s(1159);var n=s(8570);let a=(0,n.createProxy)(String.raw`/Users/ericmwirichia/Documents/SchoolAI/doneFrontend/contexts/AuthContext.tsx`),{__esModule:r,$$typeof:i}=a;a.default;let c=(0,n.createProxy)(String.raw`/Users/ericmwirichia/Documents/SchoolAI/doneFrontend/contexts/AuthContext.tsx#AuthProvider`);(0,n.createProxy)(String.raw`/Users/ericmwirichia/Documents/SchoolAI/doneFrontend/contexts/AuthContext.tsx#useAuth`);let l={title:"School Chat Alpha"};function d({children:e}){return o.jsx("html",{lang:"en",children:o.jsx("body",{className:"min-h-svh bg-neutral-50 text-neutral-900 dark:bg-neutral-950 dark:text-neutral-100 antialiased",children:o.jsx(c,{children:e})})})}},7272:()=>{}};