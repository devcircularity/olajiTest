(()=>{var e={};e.id=332,e.ids=[332],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},8782:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>i.a,__next_app__:()=>o,originalPathname:()=>x,pages:()=>m,routeModule:()=>p,tree:()=>d}),s(9219),s(596),s(7449),s(5866);var a=s(3191),l=s(8716),n=s(7922),i=s.n(n),r=s(5231),c={};for(let e in r)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>r[e]);s.d(t,c);let d=["",{children:["admin",{children:["configuration",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,9219)),"/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/admin/configuration/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,596)),"/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,7449)),"/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],m=["/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/admin/configuration/page.tsx"],x="/admin/configuration/page",o={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:l.x.APP_PAGE,page:"/admin/configuration/page",pathname:"/admin/configuration",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},6457:(e,t,s)=>{Promise.resolve().then(s.bind(s,9324))},9324:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>I});var a=s(326),l=s(7577),n=s(3136),i=s(912),r=s(1405),c=s(3679);function d({size:e="md",className:t="",text:s="Loading..."}){return(0,a.jsxs)("div",{className:`flex flex-col items-center justify-center p-4 ${t}`,children:[a.jsx("div",{className:`animate-spin rounded-full border-2 border-neutral-200 border-t-[--color-brand] ${{sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[e]}`}),s&&a.jsx("p",{className:"mt-2 text-sm text-neutral-600 dark:text-neutral-400",children:s})]})}var m=s(2881);let x=(0,m.Z)("code",[["path",{d:"m16 18 6-6-6-6",key:"eg8j8"}],["path",{d:"m8 6-6 6 6 6",key:"ppft3o"}]]);var o=s(617),p=s(6697),h=s(361),u=s(1291),g=s(8378),j=s(4893),v=s(2978);function f({overview:e}){let[t,s]=(0,l.useState)(""),[n,r]=(0,l.useState)(null),[d,m]=(0,l.useState)(!1),f=async()=>{if(t.trim())try{m(!0);let e=await i.q.testClassify({message:t});r(e)}catch(e){console.error("Test failed:",e)}finally{m(!1)}};return(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(x,{size:14,className:"text-blue-600 flex-shrink-0"}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Total Patterns"})]}),a.jsx("p",{className:"text-lg sm:text-2xl font-bold",children:e.totalPatterns}),(0,a.jsxs)("p",{className:"text-xs text-neutral-500",children:[e.enabledPatterns," enabled"]})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(o.Z,{size:14,className:"text-green-600 flex-shrink-0"}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Total Templates"})]}),a.jsx("p",{className:"text-lg sm:text-2xl font-bold",children:e.totalTemplates}),(0,a.jsxs)("p",{className:"text-xs text-neutral-500",children:[e.enabledTemplates," enabled"]})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(p.Z,{size:14,className:"text-purple-600 flex-shrink-0"}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"System Health"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1 sm:gap-2",children:["healthy"===e.systemHealth?a.jsx(h.Z,{size:16,className:"text-green-600 flex-shrink-0"}):a.jsx(u.Z,{size:16,className:"text-orange-600 flex-shrink-0"}),a.jsx("span",{className:"font-bold capitalize text-sm sm:text-base truncate",children:e.systemHealth})]})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(g.Z,{size:14,className:"text-gray-600 flex-shrink-0"}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Cache Status"})]}),a.jsx("p",{className:"text-sm sm:text-lg font-bold capitalize truncate",children:e.cacheStatus})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6",children:[(0,a.jsxs)("div",{className:"card p-4 sm:p-6",children:[(0,a.jsxs)("h3",{className:"text-base sm:text-lg font-semibold mb-3 sm:mb-4 flex items-center gap-2",children:[a.jsx(j.Z,{size:16,className:"text-green-600 flex-shrink-0"}),a.jsx("span",{className:"truncate",children:"Active Configuration"})]}),e.activeVersion?(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("strong",{children:"Name:"}),a.jsx("span",{className:"truncate ml-2",children:e.activeVersion.name})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("strong",{children:"Patterns:"}),a.jsx("span",{children:e.activeVersion.pattern_count})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("strong",{children:"Templates:"}),a.jsx("span",{children:e.activeVersion.template_count})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("strong",{children:"Activated:"}),a.jsx("span",{className:"truncate ml-2",children:e.activeVersion.activated_at?new Date(e.activeVersion.activated_at).toLocaleDateString():"N/A"})]})]}):a.jsx("p",{className:"text-red-600 text-sm",children:"No active configuration found!"})]}),(0,a.jsxs)("div",{className:"card p-4 sm:p-6",children:[(0,a.jsxs)("h3",{className:"text-base sm:text-lg font-semibold mb-3 sm:mb-4 flex items-center gap-2",children:[a.jsx(g.Z,{size:16,className:"text-blue-600 flex-shrink-0"}),a.jsx("span",{className:"truncate",children:"Candidate Configuration"})]}),e.candidateVersion?(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("strong",{children:"Name:"}),a.jsx("span",{className:"truncate ml-2",children:e.candidateVersion.name})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("strong",{children:"Patterns:"}),a.jsx("span",{children:e.candidateVersion.pattern_count})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("strong",{children:"Templates:"}),a.jsx("span",{children:e.candidateVersion.template_count})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[a.jsx("strong",{children:"Created:"}),a.jsx("span",{className:"truncate ml-2",children:new Date(e.candidateVersion.created_at).toLocaleDateString()})]})]}):a.jsx("p",{className:"text-neutral-600 text-sm",children:"No candidate configuration"})]})]}),(0,a.jsxs)("div",{className:"card p-4 sm:p-6",children:[(0,a.jsxs)("h3",{className:"text-base sm:text-lg font-semibold mb-3 sm:mb-4 flex items-center gap-2",children:[a.jsx(v.Z,{size:16,className:"flex-shrink-0"}),a.jsx("span",{children:"Quick Classification Test"})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 mb-4",children:[a.jsx("input",{type:"text",value:t,onChange:e=>s(e.target.value),placeholder:"Enter a message to test classification...",className:"input flex-1 text-sm"}),(0,a.jsxs)(c.default,{onClick:f,disabled:d||!t.trim(),className:"flex items-center gap-2 whitespace-nowrap",children:[a.jsx(v.Z,{size:16}),d?"Testing...":"Test"]})]}),n&&(0,a.jsxs)("div",{className:"bg-neutral-50 dark:bg-neutral-800 p-3 sm:p-4 rounded-lg",children:[a.jsx("h4",{className:"font-semibold mb-2 text-sm sm:text-base",children:"Result:"}),a.jsx("pre",{className:"text-xs sm:text-sm overflow-auto",children:JSON.stringify(n.final_decision,null,2)})]})]})]})}var b=s(2714),N=s(9508),y=s(8091),w=s(8307),k=s(3855);let C=(0,m.Z)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var _=s(2607),S=s(4019);let P=(0,m.Z)("wand-sparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]]),z=(0,m.Z)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function V({item:e,availableHandlers:t,availableIntents:s,onSave:n,onClose:r,onChange:d}){let[m,x]=(0,l.useState)(!1),[o,p]=(0,l.useState)(!1),[h,u]=(0,l.useState)(!1),[g,j]=(0,l.useState)(s),v=(t,s)=>{d({...e,item:{...e.item,[t]:s}})},f=(t,s)=>{let a=[...e.item.phrases||[]];a[t]=s,v("phrases",a)},b=t=>{v("phrases",(e.item.phrases||[]).filter((e,s)=>s!==t))},N=async()=>{let t=e.item,s=t.phrases?.filter(e=>e.trim())||[];if(0===s.length){alert("Please add at least one phrase before generating regex");return}x(!0);try{let a=await i.q.generateRegexFromPhrases({phrases:s,intent:t.intent,pattern_kind:t.kind});a.errors&&a.errors.length>0&&(console.warn("Regex generation warnings:",a.errors),alert(`Regex generation warnings: ${a.errors.join(", ")}`));let l=a.generated_regex||"",n=a.confidence||0,r=a.explanation||"",c={...e,item:{...e.item,pattern:l,regex_confidence:n,regex_explanation:r}};d(c),l&&p(!0)}catch(e){console.error("Failed to generate regex:",e),alert("Failed to generate regex. Please try again or enter manually.")}finally{x(!1)}};return(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[a.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:r}),a.jsx("div",{className:"relative bg-white dark:bg-neutral-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4 sm:mb-6",children:[(0,a.jsxs)("h2",{className:"text-lg sm:text-xl font-bold",children:[e.isNew?"Add":"Edit"," Pattern"]}),a.jsx(c.default,{onClick:r,className:"text-sm btn-secondary",children:a.jsx(S.Z,{size:16})})]}),(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-sm",children:"Handler"}),(0,a.jsxs)("select",{value:e.item.handler,onChange:e=>v("handler",e.target.value),className:"input text-sm",children:[a.jsx("option",{value:"",children:"Select handler..."}),t.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-sm",children:"Intent"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{value:e.item.intent,onChange:e=>v("intent",e.target.value),className:"input text-sm",disabled:h,children:[a.jsx("option",{value:"",children:h?"Loading intents...":e.item.handler?"Select intent...":"Select handler first..."}),g.map(e=>a.jsx("option",{value:e,children:e},e))]}),h&&a.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-sm",children:"Kind"}),(0,a.jsxs)("select",{value:e.item.kind,onChange:e=>v("kind",e.target.value),className:"input text-sm",children:[a.jsx("option",{value:"positive",children:"Positive"}),a.jsx("option",{value:"negative",children:"Negative"}),a.jsx("option",{value:"synonym",children:"Synonym"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-sm",children:"Priority"}),a.jsx("input",{type:"number",value:e.item.priority,onChange:e=>v("priority",parseInt(e.target.value)),className:"input text-sm"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-sm",children:"School Scope (Optional)"}),a.jsx("input",{type:"text",value:e.item.scope_school_id||"",onChange:e=>v("scope_school_id",e.target.value||void 0),placeholder:"Leave empty for global",className:"input text-sm"})]})]}),(0,a.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-sm",children:"Example Phrases (Recommended)"}),a.jsx("p",{className:"text-xs text-neutral-500",children:"Add natural language examples. We'll automatically generate the regex for you."})]}),a.jsx(c.default,{onClick:()=>p(!o),className:"text-xs btn-secondary",children:o?"Hide Advanced":"Show Advanced"})]}),a.jsx("textarea",{value:e.item.pattern,onChange:e=>v("pattern",e.target.value),placeholder:"Regex will be generated automatically from phrases...",className:"input font-mono text-sm",rows:3,readOnly:!o}),e.item.regex_confidence&&(0,a.jsxs)("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:"text-sm font-medium",children:"Confidence:"}),(0,a.jsxs)("span",{className:`px-2 py-1 rounded text-xs ${e.item.regex_confidence>=.8?"bg-green-100 text-green-700":e.item.regex_confidence>=.6?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[Math.round(100*e.item.regex_confidence),"%"]})]}),e.item.regex_explanation&&a.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:e.item.regex_explanation})]}),a.jsx("p",{className:"text-xs text-neutral-500 mt-2",children:o?"Advanced: You can manually edit the regex pattern here":"The regex is auto-generated from your phrases. Click 'Show Advanced' to edit manually."})]}),a.jsx("div",{children:(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:e.item.enabled,onChange:e=>v("enabled",e.target.checked),className:"rounded"}),a.jsx("span",{className:"text-sm",children:"Enabled"})]})}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)(c.default,{onClick:()=>{v("phrases",[...e.item.phrases||[],""])},className:"flex items-center gap-2 text-sm btn-secondary",children:[a.jsx(k.Z,{size:14}),"Add Phrase"]}),a.jsx("div",{className:"space-y-2",children:(e.item.phrases||[""]).map((t,s)=>(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",value:t,onChange:e=>f(s,e.target.value),placeholder:'Example: "show me student details"',className:"input flex-1 text-sm"}),(e.item.phrases||[]).length>1&&a.jsx(c.default,{onClick:()=>b(s),className:"px-2 text-sm btn-secondary",children:a.jsx(y.Z,{size:14})})]},s))}),(e.item.phrases||[]).some(e=>e.trim())&&a.jsx("div",{className:"flex justify-center",children:(0,a.jsxs)(c.default,{onClick:N,disabled:m,className:"flex items-center gap-2 text-sm",children:[a.jsx(P,{size:16}),m?"Generating...":"Generate Regex from Phrases"]})})]}),(0,a.jsxs)("div",{children:[a.jsx("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-2 gap-2",children:a.jsx("label",{className:"label text-sm",children:"Generated Regex Pattern"})}),a.jsx("textarea",{readOnly:!0,value:e.item.pattern||"",className:"input font-mono text-sm",rows:4})]})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 mt-4 sm:mt-6 pt-4 border-t",children:[(0,a.jsxs)(c.default,{onClick:n,className:"flex-1 text-sm",children:[a.jsx(z,{size:16,className:"mr-2"}),e.isNew?"Create":"Save Changes"]}),a.jsx(c.default,{onClick:r,className:"flex-1 text-sm btn-secondary",children:"Cancel"})]})]})})]})}function q({patterns:e,loading:t,selectedVersion:s,setSelectedVersion:n,overview:r,availableHandlers:d,availableIntents:m,editingItem:x,setEditingItem:o,onSaveItem:p,onDataChange:h}){let[u,g]=(0,l.useState)(""),[j,v]=(0,l.useState)(""),[f,S]=(0,l.useState)(""),P=e.filter(e=>{let t=!u||e.pattern.toLowerCase().includes(u.toLowerCase())||e.handler.toLowerCase().includes(u.toLowerCase())||e.intent.toLowerCase().includes(u.toLowerCase())||e.phrases&&e.phrases.some(e=>e.toLowerCase().includes(u.toLowerCase())),s=!j||e.handler===j,a=!f||e.intent===f;return t&&s&&a}),z=async e=>{if(confirm("Are you sure you want to delete this pattern?"))try{await i.q.deletePattern(e.id),h()}catch(e){console.error("Failed to delete pattern:",e),alert("Failed to delete pattern")}},q=[{label:"View",icon:a.jsx(b.Z,{size:14}),onClick:e=>o({type:"pattern",item:e,isNew:!1}),variant:"secondary"},{label:"Edit",icon:a.jsx(N.Z,{size:14}),onClick:e=>o({type:"pattern",item:e,isNew:!1}),variant:"primary"},{label:"Delete",icon:a.jsx(y.Z,{size:14}),onClick:z,variant:"danger"}];return(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("div",{className:"card p-3 sm:p-4",children:(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row lg:flex-wrap gap-3 lg:gap-4 lg:items-center",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1",children:"Configuration Version"}),(0,a.jsxs)("select",{value:s,onChange:e=>n(e.target.value),className:"input w-full sm:w-48 text-sm",children:[r?.activeVersion&&(0,a.jsxs)("option",{value:r.activeVersion.id,children:[r.activeVersion.name," (Active)"]}),r?.candidateVersion&&(0,a.jsxs)("option",{value:r.candidateVersion.id,children:[r.candidateVersion.name," (Candidate)"]})]})]}),(0,a.jsxs)("div",{className:"min-w-0",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1",children:"Search"}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx(w.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400",size:16}),a.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"Search patterns...",className:"input pl-10 w-full sm:w-64 text-sm"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 lg:flex lg:gap-4",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1",children:"Handler"}),(0,a.jsxs)("select",{value:j,onChange:e=>v(e.target.value),className:"input w-full sm:w-40 text-sm",children:[a.jsx("option",{value:"",children:"All Handlers"}),d.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"min-w-0",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1",children:"Intent"}),(0,a.jsxs)("select",{value:f,onChange:e=>S(e.target.value),className:"input w-full sm:w-40 text-sm",children:[a.jsx("option",{value:"",children:"All Intents"}),m.map(e=>a.jsx("option",{value:e,children:e},e))]})]})]}),a.jsx("div",{className:"lg:ml-auto",children:(0,a.jsxs)(c.default,{onClick:()=>{o({type:"pattern",item:{id:"",handler:"",intent:"",kind:"positive",pattern:"",priority:100,enabled:!0,scope_school_id:void 0,created_at:"",updated_at:"",phrases:[""]},isNew:!0})},className:"flex items-center gap-2 w-full sm:w-auto text-sm",children:[a.jsx(k.Z,{size:16}),"Add Pattern"]})})]})}),a.jsx("div",{className:"card p-3 sm:p-4 bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[a.jsx(C,{size:16,className:"text-blue-600 mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{children:[a.jsx("h4",{className:"text-xs sm:text-sm font-semibold text-blue-800 dark:text-blue-200",children:"Phrase-Friendly Patterns"}),a.jsx("p",{className:"text-xs sm:text-sm text-blue-700 dark:text-blue-300",children:'Patterns now support friendly phrases like "show student details" that are automatically converted to regex. You can create patterns using natural language instead of complex regex expressions.'})]})]})}),a.jsx(_.Z,{data:P,columns:[{key:"handler",label:"Handler",render:e=>a.jsx("code",{className:"text-xs sm:text-sm bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded",children:e}),width:"120px"},{key:"intent",label:"Intent",render:e=>a.jsx("span",{className:"text-xs sm:text-sm font-medium",children:e}),width:"100px"},{key:"kind",label:"Kind",render:e=>a.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs ${"positive"===e?"bg-green-100 text-green-800":"negative"===e?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"}`,children:e}),width:"80px"},{key:"phrases",label:"Phrases",render:(e,t)=>e&&e.length>0?(0,a.jsxs)("div",{className:"max-w-xs sm:max-w-md",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-1 mb-1",children:[e.slice(0,2).map((e,t)=>(0,a.jsxs)("span",{className:"bg-blue-50 text-blue-700 px-2 py-1 rounded text-xs",children:['"',e,'"']},t)),e.length>2&&(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:["+",e.length-2," more"]})]}),t.regex_confidence&&a.jsx("div",{className:"flex items-center gap-1 mt-1",children:(0,a.jsxs)("span",{className:`text-xs px-1 py-0.5 rounded ${t.regex_confidence>=.8?"bg-green-100 text-green-700":t.regex_confidence>=.6?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[Math.round(100*t.regex_confidence),"%"]})})]}):(0,a.jsxs)("div",{className:"max-w-xs sm:max-w-md",children:[a.jsx("code",{className:"text-xs bg-neutral-50 dark:bg-neutral-800 p-1 rounded block truncate",title:t.pattern,children:t.pattern}),a.jsx("span",{className:"text-xs text-gray-500",children:"Raw regex"})]})},{key:"priority",label:"Priority",width:"80px",render:e=>a.jsx("span",{className:"text-xs sm:text-sm",children:e})},{key:"enabled",label:"Status",render:e=>a.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${e?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e?"Enabled":"Disabled"}),width:"80px"}],actions:q,loading:t,emptyMessage:"No patterns found",className:"overflow-x-auto"}),x&&"pattern"===x.type&&a.jsx(V,{item:x,availableHandlers:d,availableIntents:m,onSave:p,onClose:()=>o(null),onChange:o})]})}function Z({item:e,availableHandlers:t,availableIntents:s,onSave:n,onClose:i,onChange:r}){let[d,m]=(0,l.useState)(!1),[x,o]=(0,l.useState)(s),p=(t,s)=>{r({...e,item:{...e.item,[t]:s}})};return(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[a.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:i}),a.jsx("div",{className:"relative bg-white dark:bg-neutral-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4 sm:mb-6",children:[(0,a.jsxs)("h2",{className:"text-lg sm:text-xl font-bold",children:[e.isNew?"Add":"Edit"," Template"]}),a.jsx(c.default,{onClick:i,className:"text-sm btn-secondary",children:a.jsx(S.Z,{size:16})})]}),(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-sm",children:"Handler"}),(0,a.jsxs)("select",{value:e.item.handler,onChange:e=>p("handler",e.target.value),className:"input text-sm",children:[a.jsx("option",{value:"",children:"Select handler..."}),t.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-sm",children:"Intent"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("select",{value:e.item.intent||"",onChange:e=>p("intent",e.target.value),className:"input text-sm",disabled:d,children:[a.jsx("option",{value:"",children:d?"Loading intents...":e.item.handler?"Select intent...":"Select handler first..."}),x.map(e=>a.jsx("option",{value:e,children:e},e))]}),d&&a.jsx("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"})})]}),e.item.handler&&0===x.length&&!d&&(0,a.jsxs)("p",{className:"text-xs text-amber-600 mt-1",children:['No intents found for "',e.item.handler,'" handler']})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-sm",children:"Template Type"}),(0,a.jsxs)("select",{value:e.item.template_type,onChange:e=>p("template_type",e.target.value),className:"input text-sm",children:[a.jsx("option",{value:"system",children:"System"}),a.jsx("option",{value:"user",children:"User"}),a.jsx("option",{value:"fallback_context",children:"Fallback Context"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-sm",children:"Template Text"}),a.jsx("textarea",{value:e.item.template_text,onChange:e=>p("template_text",e.target.value),placeholder:"Enter template text...",className:"input min-h-[200px] text-sm",rows:8}),(0,a.jsxs)("p",{className:"text-xs text-neutral-500 mt-1",children:["You can use variables like ","{user_message}",", ","{context}",", etc."]})]}),a.jsx("div",{children:(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:e.item.enabled,onChange:e=>p("enabled",e.target.checked),className:"rounded"}),a.jsx("span",{className:"text-sm",children:"Enabled"})]})})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 mt-4 sm:mt-6 pt-4 border-t",children:[(0,a.jsxs)(c.default,{onClick:n,className:"flex-1 text-sm",children:[a.jsx(z,{size:16,className:"mr-2"}),e.isNew?"Create":"Save Changes"]}),a.jsx(c.default,{onClick:i,className:"flex-1 text-sm btn-secondary",children:"Cancel"})]})]})})]})}function A({templates:e,loading:t,selectedVersion:s,setSelectedVersion:n,overview:r,availableHandlers:d,availableIntents:m,editingItem:x,setEditingItem:o,onSaveItem:p,onDataChange:h}){let[u,g]=(0,l.useState)(""),[j,v]=(0,l.useState)(""),[f,C]=(0,l.useState)(""),S=e.filter(e=>{let t=!u||e.template_text.toLowerCase().includes(u.toLowerCase())||e.handler.toLowerCase().includes(u.toLowerCase())||e.intent&&e.intent.toLowerCase().includes(u.toLowerCase()),s=!j||e.handler===j,a=!f||e.intent===f;return t&&s&&a}),P=async e=>{if(confirm("Are you sure you want to delete this template?"))try{await i.q.deleteTemplate(e.id),h()}catch(e){console.error("Failed to delete template:",e),alert("Failed to delete template")}},z=[{key:"handler",label:"Handler",render:e=>a.jsx("code",{className:"text-xs sm:text-sm bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded",children:e}),width:"150px"},{key:"intent",label:"Intent",render:e=>a.jsx("span",{className:"text-xs sm:text-sm",children:e||"-"}),width:"120px"},{key:"template_type",label:"Type",render:e=>a.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs bg-purple-100 text-purple-800",children:e}),width:"100px"},{key:"template_text",label:"Template",render:e=>a.jsx("div",{className:"max-w-xs sm:max-w-md text-xs sm:text-sm",children:a.jsx("div",{className:"truncate",title:e,children:e})})},{key:"enabled",label:"Status",render:e=>a.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${e?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e?"Enabled":"Disabled"}),width:"80px"}],V=[{label:"View",icon:a.jsx(b.Z,{size:14}),onClick:e=>o({type:"template",item:e,isNew:!1}),variant:"secondary"},{label:"Edit",icon:a.jsx(N.Z,{size:14}),onClick:e=>o({type:"template",item:e,isNew:!1}),variant:"primary"},{label:"Delete",icon:a.jsx(y.Z,{size:14}),onClick:P,variant:"danger"}];return(0,a.jsxs)("div",{className:"space-y-4",children:[a.jsx("div",{className:"card p-3 sm:p-4",children:(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row lg:flex-wrap gap-3 lg:gap-4 lg:items-center",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1",children:"Configuration Version"}),(0,a.jsxs)("select",{value:s,onChange:e=>n(e.target.value),className:"input w-full sm:w-48 text-sm",children:[r?.activeVersion&&(0,a.jsxs)("option",{value:r.activeVersion.id,children:[r.activeVersion.name," (Active)"]}),r?.candidateVersion&&(0,a.jsxs)("option",{value:r.candidateVersion.id,children:[r.candidateVersion.name," (Candidate)"]})]})]}),(0,a.jsxs)("div",{className:"min-w-0",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1",children:"Search"}),(0,a.jsxs)("div",{className:"relative",children:[a.jsx(w.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400",size:16}),a.jsx("input",{type:"text",value:u,onChange:e=>g(e.target.value),placeholder:"Search templates...",className:"input pl-10 w-full sm:w-64 text-sm"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 lg:flex lg:gap-4",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1",children:"Handler"}),(0,a.jsxs)("select",{value:j,onChange:e=>v(e.target.value),className:"input w-full sm:w-40 text-sm",children:[a.jsx("option",{value:"",children:"All Handlers"}),d.map(e=>a.jsx("option",{value:e,children:e},e))]})]}),(0,a.jsxs)("div",{className:"min-w-0",children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1",children:"Intent"}),(0,a.jsxs)("select",{value:f,onChange:e=>C(e.target.value),className:"input w-full sm:w-40 text-sm",children:[a.jsx("option",{value:"",children:"All Intents"}),m.map(e=>a.jsx("option",{value:e,children:e},e))]})]})]}),a.jsx("div",{className:"lg:ml-auto",children:(0,a.jsxs)(c.default,{onClick:()=>{o({type:"template",item:{id:"",handler:"",intent:"",template_type:"user",template_text:"",enabled:!0,created_at:"",updated_at:""},isNew:!0})},className:"flex items-center gap-2 w-full sm:w-auto text-sm",children:[a.jsx(k.Z,{size:16}),"Add Template"]})})]})}),a.jsx(_.Z,{data:S,columns:z,actions:V,loading:t,emptyMessage:"No templates found",className:"overflow-x-auto"}),x&&"template"===x.type&&a.jsx(Z,{item:x,availableHandlers:d,availableIntents:m,onSave:p,onClose:()=>o(null),onChange:o})]})}function T(){return a.jsx("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"card p-4 sm:p-6",children:[a.jsx("h3",{className:"text-base sm:text-lg font-semibold mb-3 sm:mb-4",children:"Configuration Analytics"}),a.jsx("p",{className:"text-sm sm:text-base text-neutral-600 mb-3 sm:mb-4",children:"View detailed routing logs and analytics in the Logs section."}),a.jsx(c.default,{onClick:()=>window.location.href="/admin/logs",className:"text-sm",children:"View Detailed Logs"})]})})}function M({activeTab:e,overview:t,onOverviewRefresh:s}){let[n,r]=(0,l.useState)([]),[c,d]=(0,l.useState)([]),[m,x]=(0,l.useState)(!1),[o,p]=(0,l.useState)(""),[h,u]=(0,l.useState)([]),[g,j]=(0,l.useState)([]),[v,b]=(0,l.useState)(null),N=async()=>{if(o)try{if(x(!0),"patterns"===e){let e=await i.q.getPatterns(o);r(e)}else if("templates"===e){let e=await i.q.getTemplates(o);d(e)}}catch(e){console.error("Failed to load data:",e)}finally{x(!1)}},y=async()=>{if(v)try{if("pattern"===v.type){let e=v.item;v.isNew?await i.q.createPattern(o,{handler:e.handler,intent:e.intent,kind:e.kind,pattern:e.pattern,priority:e.priority,enabled:e.enabled,scope_school_id:e.scope_school_id,...e.phrases&&{phrases:e.phrases}}):await i.q.updatePattern(e.id,{handler:e.handler,intent:e.intent,kind:e.kind,pattern:e.pattern,priority:e.priority,enabled:e.enabled,scope_school_id:e.scope_school_id,...e.phrases&&{phrases:e.phrases}})}else{let e=v.item;v.isNew?await i.q.createTemplate(o,{handler:e.handler,intent:e.intent,template_type:e.template_type,template_text:e.template_text,enabled:e.enabled}):await i.q.updateTemplate(e.id,{handler:e.handler,intent:e.intent,template_type:e.template_type,template_text:e.template_text,enabled:e.enabled})}b(null),N(),s()}catch(e){console.error("Failed to save item:",e),alert("Failed to save changes")}};return"overview"===e&&t?a.jsx(f,{overview:t}):"patterns"===e?a.jsx(q,{patterns:n,loading:m,selectedVersion:o,setSelectedVersion:p,overview:t,availableHandlers:h,availableIntents:g,editingItem:v,setEditingItem:b,onSaveItem:y,onDataChange:N}):"templates"===e?a.jsx(A,{templates:c,loading:m,selectedVersion:o,setSelectedVersion:p,overview:t,availableHandlers:h,availableIntents:g,editingItem:v,setEditingItem:b,onSaveItem:y,onDataChange:N}):"analytics"===e?a.jsx(T,{}):null}function L({cacheStatus:e}){return a.jsx("div",{className:"card p-3 sm:p-4 mb-4 sm:mb-6 border-orange-200 bg-orange-50 dark:bg-orange-900/20",children:(0,a.jsxs)("div",{className:"flex items-start gap-2 sm:gap-3 text-orange-800 dark:text-orange-200",children:[a.jsx(u.Z,{size:18,className:"mt-0.5 flex-shrink-0"}),(0,a.jsxs)("div",{className:"min-w-0",children:[a.jsx("h3",{className:"font-semibold text-sm sm:text-base",children:"System Health Warning"}),(0,a.jsxs)("p",{className:"text-xs sm:text-sm",children:["Configuration cache status: ",e,". Consider reloading the cache."]})]})]})})}function I(){let{user:e}=(0,n.a)(),[t,s]=(0,l.useState)(null),[m,x]=(0,l.useState)(!0),[o,p]=(0,l.useState)("overview"),h=async()=>{try{x(!0);let[e,t,a]=await Promise.all([i.q.getVersions(),i.q.getStats(),i.q.getCacheStats().catch(()=>({status:"error"}))]),l=e.find(e=>"active"===e.status)||null,n=e.find(e=>"candidate"===e.status)||null;s({activeVersion:l,candidateVersion:n,totalPatterns:t.patterns?.total||0,totalTemplates:t.templates?.total||0,enabledPatterns:t.patterns?.enabled||0,enabledTemplates:t.templates?.enabled||0,systemHealth:"loaded"===a.status?"healthy":"warning",cacheStatus:a.status||"error"})}catch(e){console.error("Failed to load configuration overview:",e)}finally{x(!1)}},u=async()=>{try{await i.q.reloadConfig(),alert("Configuration cache reloaded successfully"),h()}catch(e){console.error("Failed to reload cache:",e),alert("Failed to reload configuration")}};return e?.permissions?.can_manage_intent_config||e?.permissions?.is_admin||e?.permissions?.is_super_admin?m?a.jsx(d,{size:"lg",text:"Loading configuration..."}):(0,a.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 sm:mb-6 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-2",children:"Configuration Management"}),a.jsx("p",{className:"text-sm sm:text-base text-neutral-600",children:"View and manage all intent patterns, templates, and system configuration"})]}),a.jsx("div",{className:"flex gap-2",children:(0,a.jsxs)(c.default,{onClick:u,className:"btn-secondary flex items-center gap-2 text-sm",children:[a.jsx(r.Z,{size:16}),a.jsx("span",{className:"hidden sm:inline",children:"Reload Cache"}),a.jsx("span",{className:"sm:hidden",children:"Reload"})]})})]}),t&&"healthy"!==t.systemHealth&&a.jsx(L,{cacheStatus:t.cacheStatus}),a.jsx("div",{className:"border-b border-neutral-200 dark:border-neutral-700 mb-4 sm:mb-6",children:a.jsx("nav",{className:"flex space-x-4 sm:space-x-8 overflow-x-auto",children:["overview","patterns","templates","analytics"].map(e=>a.jsx("button",{onClick:()=>p(e),className:`py-2 px-1 border-b-2 font-medium text-xs sm:text-sm whitespace-nowrap ${o===e?"border-[--color-brand] text-[--color-brand]":"border-transparent text-neutral-500 hover:text-neutral-700 dark:hover:text-neutral-300"}`,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})}),a.jsx(M,{activeTab:o,overview:t,onOverviewRefresh:h})]}):a.jsx("div",{className:"p-4 sm:p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-4",children:"Access Denied"}),a.jsx("p",{className:"text-neutral-600",children:"You don't have permission to manage intent configuration."})]})})}},361:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},2714:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},8091:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},9219:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>i,__esModule:()=>n,default:()=>r});var a=s(8570);let l=(0,a.createProxy)(String.raw`/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/admin/configuration/page.tsx`),{__esModule:n,$$typeof:i}=l;l.default;let r=(0,a.createProxy)(String.raw`/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/admin/configuration/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[226,328,657,480,289],()=>s(8782));module.exports=a})();