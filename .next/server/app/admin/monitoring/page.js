(()=>{var e={};e.id=232,e.ids=[232],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},1130:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>i.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>o,routeModule:()=>p,tree:()=>d}),t(4706),t(596),t(7449),t(5866);var a=t(3191),r=t(8716),n=t(7922),i=t.n(n),l=t(5231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);t.d(s,c);let d=["",{children:["admin",{children:["monitoring",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,4706)),"/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/admin/monitoring/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,596)),"/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/admin/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,7449)),"/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/admin/monitoring/page.tsx"],m="/admin/monitoring/page",x={require:t,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/admin/monitoring/page",pathname:"/admin/monitoring",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},8937:(e,s,t)=>{Promise.resolve().then(t.bind(t,8051))},8051:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>j});var a=t(326),r=t(7577),n=t(3136),i=t(2374);class l{async getRecentMessages(e){let s=new URLSearchParams;return e?.limit&&s.append("limit",e.limit.toString()),e?.school_id&&s.append("school_id",e.school_id),e?.user_id&&s.append("user_id",e.user_id),e?.has_rating&&s.append("has_rating","true"),e?.message_type&&s.append("message_type",e.message_type),e?.hours_back&&s.append("hours_back",e.hours_back.toString()),(await i.x.get(`/api/admin/chat/messages?${s.toString()}`)).data}async getActiveConversations(e){let s=new URLSearchParams;return e?.school_id&&s.append("school_id",e.school_id),e?.limit&&s.append("limit",e.limit.toString()),e?.problems_only&&s.append("problems_only","true"),(await i.x.get(`/api/admin/chat/conversations?${s.toString()}`)).data}async getRealtimeStats(e){let s=e?`?school_id=${e}`:"";return(await i.x.get(`/api/admin/chat/stats/realtime${s}`)).data}async getConversationDetails(e){return(await i.x.get(`/api/admin/chat/conversations/${e}`)).data}async flagConversation(e,s){return(await i.x.post(`/api/admin/chat/conversations/${e}/flag`,{reason:s})).data}async getChatAnalytics(e){let s=new URLSearchParams;return e?.start_date&&s.append("start_date",e.start_date),e?.end_date&&s.append("end_date",e.end_date),e?.school_id&&s.append("school_id",e.school_id),e?.group_by&&s.append("group_by",e.group_by),(await i.x.get(`/api/admin/chat/analytics?${s.toString()}`)).data}}let c=new l;var d=t(2607),o=t(2714),m=t(4061),x=t(617),p=t(8998),u=t(7069),h=t(949),g=t(3679);function j(){let{user:e}=(0,n.a)(),[s,t]=(0,r.useState)(null),[i,l]=(0,r.useState)([]),[j,b]=(0,r.useState)(!0),[N,v]=(0,r.useState)(!0),[y,f]=(0,r.useState)(null),k=async()=>{try{b(!0);let[e,s]=await Promise.all([c.getRealtimeStats(),c.getRecentMessages({limit:50,hours_back:24})]);t(e),l(s)}catch(e){console.error("Failed to load monitoring data:",e)}finally{b(!1)}},_=async e=>{try{let s=await c.getConversationDetails(e.conversation_id);console.log("Conversation details:",s),f(e)}catch(e){console.error("Failed to load conversation:",e)}},w=[{key:"created_at",label:"Time",render:e=>{let s=new Date(e),t=Math.floor((new Date().getTime()-s.getTime())/6e4);return t<1?a.jsx("span",{className:"text-xs sm:text-sm",children:"Just now"}):t<60?(0,a.jsxs)("span",{className:"text-xs sm:text-sm",children:[t,"m ago"]}):t<1440?(0,a.jsxs)("span",{className:"text-xs sm:text-sm",children:[Math.floor(t/60),"h ago"]}):a.jsx("span",{className:"text-xs sm:text-sm",children:s.toLocaleDateString()})},width:"100px"},{key:"message_type",label:"Type",render:e=>a.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${"user"===e?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200":"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200"}`,children:"user"===e?"User":"Assistant"}),width:"80px"},{key:"content",label:"Message",render:e=>a.jsx("div",{className:"max-w-xs sm:max-w-md truncate text-xs sm:text-sm break-words",title:e,children:e})},{key:"intent",label:"Intent",render:e=>e?a.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded break-all",children:e}):"-",width:"120px"},{key:"rating",label:"Rating",render:(e,s)=>"user"===s.message_type?a.jsx("span",{className:"text-xs sm:text-sm",children:"-"}):1===e?a.jsx("span",{className:"text-green-600",children:"\uD83D\uDC4D"}):-1===e?a.jsx("span",{className:"text-red-600",children:"\uD83D\uDC4E"}):a.jsx("span",{className:"text-gray-400",children:"-"}),width:"60px"},{key:"processing_time_ms",label:"Response Time",render:e=>a.jsx("span",{className:"text-xs sm:text-sm",children:e?`${e}ms`:"-"}),width:"100px"}],P=[{label:"View Conversation",icon:a.jsx(o.Z,{size:14}),onClick:_,variant:"secondary"}];return e?.permissions?.is_admin||e?.permissions?.is_super_admin?(0,a.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 sm:mb-6 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-2",children:"Chat Monitoring"}),a.jsx("p",{className:"text-sm sm:text-base text-neutral-600",children:"Real-time monitoring of chat interactions and system performance"})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:N,onChange:e=>v(e.target.checked),className:"rounded"}),a.jsx("span",{className:"text-xs sm:text-sm",children:"Auto-refresh"})]}),a.jsx(g.Z,{onClick:k,className:"btn-secondary text-sm",children:"Refresh Now"})]})]}),s&&(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3 sm:gap-4 mb-4 sm:mb-6",children:[(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(m.Z,{size:14,className:"text-blue-600 flex-shrink-0"}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Active Chats"})]}),a.jsx("p",{className:"text-lg sm:text-2xl font-bold",children:s.active_conversations})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(x.Z,{size:14,className:"text-green-600 flex-shrink-0"}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Messages Today"})]}),a.jsx("p",{className:"text-lg sm:text-2xl font-bold",children:s.messages_today})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(p.Z,{size:14,className:"text-purple-600 flex-shrink-0"}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Avg Response"})]}),(0,a.jsxs)("p",{className:"text-lg sm:text-2xl font-bold",children:[s.average_response_time,"ms"]})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(u.Z,{size:14,className:"text-green-600 flex-shrink-0"}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Satisfaction"})]}),(0,a.jsxs)("p",{className:"text-lg sm:text-2xl font-bold",children:[(100*s.satisfaction_rate).toFixed(1),"%"]})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(h.Z,{size:14,className:"text-orange-600 flex-shrink-0"}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Fallback Rate"})]}),(0,a.jsxs)("p",{className:"text-lg sm:text-2xl font-bold",children:[(100*s.fallback_rate).toFixed(1),"%"]})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(u.Z,{size:14,className:"text-blue-600 flex-shrink-0"}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Top Intent"})]}),a.jsx("p",{className:"text-sm sm:text-lg font-bold truncate",children:s.top_intents_today[0]?.intent||"N/A"}),(0,a.jsxs)("p",{className:"text-xs text-neutral-500",children:[s.top_intents_today[0]?.count||0," uses"]})]})]}),(0,a.jsxs)("div",{className:"mb-4 sm:mb-6",children:[a.jsx("h2",{className:"text-base sm:text-lg font-semibold mb-3 sm:mb-4",children:"Recent Messages (Last 24 Hours)"}),a.jsx("div",{className:"overflow-x-auto",children:a.jsx(d.Z,{data:i,columns:w,actions:P,loading:j,searchable:!0,searchPlaceholder:"Search messages...",emptyMessage:"No recent messages found",className:"text-xs sm:text-sm"})})]}),y&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[a.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>f(null)}),a.jsx("div",{className:"relative bg-white dark:bg-neutral-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start mb-4 sm:mb-6 gap-3",children:[a.jsx("h2",{className:"text-lg sm:text-xl font-bold",children:"Conversation Details"}),a.jsx(g.Z,{onClick:()=>f(null),className:"btn-secondary text-sm",children:"Close"})]}),(0,a.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm",children:"Message Type:"}),a.jsx("span",{className:"ml-2 text-sm",children:y.message_type})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm",children:"Intent:"}),a.jsx("span",{className:"ml-2 text-sm",children:y.intent||"N/A"})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm",children:"User ID:"}),a.jsx("span",{className:"ml-2 text-sm font-mono break-all",children:y.user_id})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm",children:"Conversation ID:"}),a.jsx("span",{className:"ml-2 text-sm font-mono break-all",children:y.conversation_id})]})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm",children:"Message Content:"}),a.jsx("div",{className:"mt-2 p-3 sm:p-4 bg-neutral-50 dark:bg-neutral-700 rounded-lg",children:a.jsx("p",{className:"text-sm whitespace-pre-wrap break-words",children:y.content})})]}),y.processing_time_ms&&(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm",children:"Processing Time:"}),(0,a.jsxs)("span",{className:"ml-2 text-sm",children:[y.processing_time_ms,"ms"]})]}),y.rating&&(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm",children:"User Rating:"}),a.jsx("span",{className:`ml-2 text-sm ${1===y.rating?"text-green-600":"text-red-600"}`,children:1===y.rating?" \uD83D\uDC4D Positive":" \uD83D\uDC4E Negative"})]})]})]})})]})]}):a.jsx("div",{className:"p-4 sm:p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-4",children:"Access Denied"}),a.jsx("p",{className:"text-neutral-600",children:"You don't have permission to view chat monitoring."})]})})}},3679:(e,s,t)=>{"use strict";t.d(s,{Z:()=>n});var a=t(326),r=t(1135);function n({className:e,children:s,...t}){return a.jsx("button",{className:(0,r.Z)("btn-primary",e),...t,children:s})}},2607:(e,s,t)=>{"use strict";t.d(s,{Z:()=>d});var a=t(326),r=t(7577),n=t(8307),i=t(1890);let l=(0,t(2881).Z)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var c=t(3679);function d({data:e,columns:s,actions:t,loading:d=!1,searchable:o=!1,searchPlaceholder:m="Search...",pagination:x,emptyMessage:p="No data available",className:u=""}){let[h,g]=(0,r.useState)(""),[j,b]=(0,r.useState)(null),N=o?e.filter(e=>Object.values(e).some(e=>String(e).toLowerCase().includes(h.toLowerCase()))):e,v=j?[...N].sort((e,s)=>{let t=e[j.key],a=s[j.key];return t<a?"asc"===j.direction?-1:1:t>a?"asc"===j.direction?1:-1:0}):N,y=e=>{b(s=>s?.key===e?{key:e,direction:"asc"===s.direction?"desc":"asc"}:{key:e,direction:"asc"})},f=(e,s)=>{let t=e[s.key];return s.render?s.render(t,e):t};return d?a.jsx("div",{className:`card ${u}`,children:(0,a.jsxs)("div",{className:"p-8 text-center",children:[a.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-[--color-brand]"}),a.jsx("p",{className:"mt-2 text-neutral-600",children:"Loading..."})]})}):(0,a.jsxs)("div",{className:`card ${u}`,children:[o&&a.jsx("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-700",children:(0,a.jsxs)("div",{className:"relative",children:[a.jsx(n.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400",size:16}),a.jsx("input",{type:"text",placeholder:m,value:h,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg  bg-white dark:bg-neutral-800 focus:ring-2 focus:ring-[--color-brand] focus:border-transparent"})]})}),a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-800",children:(0,a.jsxs)("tr",{children:[s.map((e,s)=>a.jsx("th",{className:`px-4 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider
                    ${e.sortable?"cursor-pointer hover:bg-neutral-100 dark:hover:bg-neutral-700":""}
                    ${e.width?`w-${e.width}`:""}`,onClick:e.sortable?()=>y(String(e.key)):void 0,children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[e.label,e.sortable&&j?.key===e.key&&a.jsx("span",{className:"text-[--color-brand]",children:"asc"===j.direction?"↑":"↓"})]})},s)),t&&t.length>0&&a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-700",children:0===v.length?a.jsx("tr",{children:a.jsx("td",{colSpan:s.length+(t?1:0),className:"px-4 py-8 text-center text-neutral-500 dark:text-neutral-400",children:p})}):v.map((e,r)=>(0,a.jsxs)("tr",{className:"hover:bg-neutral-50 dark:hover:bg-neutral-800/50",children:[s.map((s,t)=>a.jsx("td",{className:"px-4 py-3 text-sm text-neutral-900 dark:text-neutral-100",children:f(e,s)},t)),t&&t.length>0&&a.jsx("td",{className:"px-4 py-3 text-sm",children:a.jsx("div",{className:"flex gap-2",children:t.map((s,t)=>(0,a.jsxs)(c.Z,{onClick:()=>s.onClick(e),className:`btn-sm ${"danger"===s.variant?"btn-danger":"secondary"===s.variant?"btn-secondary":"btn-primary"}`,disabled:s.disabled?.(e),children:[s.icon&&a.jsx("span",{className:"mr-1",children:s.icon}),s.label]},t))})})]},r))})]})}),x&&(0,a.jsxs)("div",{className:"px-4 py-3 border-t border-neutral-200 dark:border-neutral-700 flex items-center justify-between",children:[(0,a.jsxs)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:["Page ",x.currentPage," of ",x.totalPages]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(c.Z,{onClick:()=>x.onPageChange(x.currentPage-1),disabled:x.currentPage<=1,className:"btn-sm btn-secondary",children:[a.jsx(i.Z,{size:16}),"Previous"]}),(0,a.jsxs)(c.Z,{onClick:()=>x.onPageChange(x.currentPage+1),disabled:x.currentPage>=x.totalPages,className:"btn-sm btn-secondary",children:["Next",a.jsx(l,{size:16})]})]})]})]})}},8998:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});let a=(0,t(2881).Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},2714:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});let a=(0,t(2881).Z)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},8307:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});let a=(0,t(2881).Z)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},7069:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});let a=(0,t(2881).Z)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},949:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});let a=(0,t(2881).Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},4706:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>i,__esModule:()=>n,default:()=>l});var a=t(8570);let r=(0,a.createProxy)(String.raw`/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/admin/monitoring/page.tsx`),{__esModule:n,$$typeof:i}=r;r.default;let l=(0,a.createProxy)(String.raw`/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/admin/monitoring/page.tsx#default`)}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[226,784,392,832],()=>t(1130));module.exports=a})();