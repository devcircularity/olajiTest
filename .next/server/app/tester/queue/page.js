(()=>{var e={};e.id=29,e.ids=[29],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},9491:e=>{"use strict";e.exports=require("assert")},6113:e=>{"use strict";e.exports=require("crypto")},2361:e=>{"use strict";e.exports=require("events")},7147:e=>{"use strict";e.exports=require("fs")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},6224:e=>{"use strict";e.exports=require("tty")},7310:e=>{"use strict";e.exports=require("url")},3837:e=>{"use strict";e.exports=require("util")},9796:e=>{"use strict";e.exports=require("zlib")},5044:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>m,originalPathname:()=>x,pages:()=>o,routeModule:()=>u,tree:()=>c}),s(8262),s(9602),s(7449),s(5866);var a=s(3191),r=s(8716),l=s(7922),n=s.n(l),i=s(5231),d={};for(let e in i)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>i[e]);s.d(t,d);let c=["",{children:["tester",{children:["queue",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8262)),"/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/tester/queue/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,9602)),"/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/tester/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,7449)),"/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],o=["/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/tester/queue/page.tsx"],x="/tester/queue/page",m={require:s,loadChunk:()=>Promise.resolve()},u=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/tester/queue/page",pathname:"/tester/queue",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},299:(e,t,s)=>{Promise.resolve().then(s.bind(s,2152))},7229:(e,t,s)=>{Promise.resolve().then(s.bind(s,1512))},2152:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(326),r=s(7577),l=s(3136),n=s(5047),i=s(2281);function d({children:e}){let{user:t,isLoading:s,isAuthenticated:d}=(0,l.a)();(0,n.useRouter)();let[c,o]=(0,r.useState)(!1),[x,m]=(0,r.useState)(!1);return s?a.jsx("div",{className:"flex items-center justify-center h-screen bg-white dark:bg-neutral-900",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),a.jsx("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Loading..."})]})}):d&&t&&(t.permissions?.is_tester||t.permissions?.is_admin||t.permissions?.is_super_admin||t.roles?.includes("TESTER")||t.roles?.includes("ADMIN")||t.roles?.includes("SUPER_ADMIN"))?(0,a.jsxs)("div",{className:"flex h-screen bg-neutral-50 dark:bg-neutral-950",children:[x&&!c&&a.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:()=>o(!0)}),a.jsx("div",{className:`
        ${x?"fixed top-0 left-0 h-full z-50":"relative"}
        ${x&&c?"-translate-x-full":"translate-x-0"}
        transition-transform duration-300 ease-in-out
      `,children:a.jsx(i.Z,{collapsed:c,onCollapse:o,isMobile:x})}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[x&&c&&a.jsx("div",{className:"lg:hidden bg-white dark:bg-neutral-900 border-b border-neutral-200 dark:border-neutral-800 px-4 py-3",children:a.jsx("button",{onClick:()=>o(!1),className:"p-2 rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",title:"Open sidebar",children:(0,a.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[a.jsx("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),a.jsx("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),a.jsx("line",{x1:"3",y1:"18",x2:"21",y2:"18"})]})})}),a.jsx("main",{className:"flex-1 overflow-hidden bg-white dark:bg-neutral-900",children:a.jsx("div",{className:"h-full overflow-y-auto",children:e})})]})]}):null}},1512:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var a=s(326),r=s(7577),l=s(3136),n=s(7750),i=s(2607),d=s(2714),c=s(3855),o=s(1405),x=s(949),m=s(617),u=s(8998);let p=(0,s(2881).Z)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var h=s(9561),g=s(3679);function b(){let{user:e}=(0,l.a)(),[t,s]=(0,r.useState)([]),[b,v]=(0,r.useState)(!0),[y,f]=(0,r.useState)(""),[N,k]=(0,r.useState)(""),[w,_]=(0,r.useState)(7),[C,S]=(0,r.useState)(null),[P,I]=(0,r.useState)(!1),Z=async()=>{try{v(!0);let e={days_back:w,limit:100,...y&&{priority:parseInt(y)},...N&&{issue_type:N}},t=await n.g.getQueue(e);s(t)}catch(e){console.error("Failed to load queue:",e)}finally{v(!1)}},q=e=>({1:"High",2:"Medium",3:"Low"})[e]||"Unknown",M=e=>{switch(e){case 1:return"bg-red-100 text-red-800";case 2:return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},A=e=>({negative_rating:"Negative Rating",fallback:"Fallback Used",low_confidence:"Low Confidence",unhandled:"Unhandled"})[e]||e,D=e=>{switch(e){case"negative_rating":return"bg-red-100 text-red-800";case"fallback":return"bg-yellow-100 text-yellow-800";case"low_confidence":return"bg-orange-100 text-orange-800";case"unhandled":return"bg-purple-100 text-purple-800";default:return"bg-gray-100 text-gray-800"}},L=[{key:"created_at",label:"Time",render:e=>{let t=new Date(e),s=Math.floor((new Date().getTime()-t.getTime())/6e4);return s<1?a.jsx("span",{className:"text-xs sm:text-sm",children:"Just now"}):s<60?(0,a.jsxs)("span",{className:"text-xs sm:text-sm",children:[s,"m ago"]}):s<1440?(0,a.jsxs)("span",{className:"text-xs sm:text-sm",children:[Math.floor(s/60),"h ago"]}):a.jsx("span",{className:"text-xs sm:text-sm",children:t.toLocaleDateString()})},width:"100px",sortable:!0},{key:"priority",label:"Priority",render:e=>a.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${M(e)}`,children:q(e)}),width:"100px",sortable:!0},{key:"issue_type",label:"Issue Type",render:e=>a.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${D(e)}`,children:A(e)}),width:"140px"},{key:"user_message",label:"User Message",render:e=>a.jsx("div",{className:"max-w-xs truncate text-xs sm:text-sm break-words",title:e,children:e})},{key:"assistant_response",label:"AI Response",render:e=>a.jsx("div",{className:"max-w-xs truncate text-xs sm:text-sm break-words",title:e,children:e})},{key:"intent",label:"Intent",render:e=>e?a.jsx("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded break-all",children:e}):"-",width:"120px"},{key:"rating",label:"Rating",render:e=>1===e?a.jsx("span",{className:"text-green-600",children:"\uD83D\uDC4D"}):-1===e?a.jsx("span",{className:"text-red-600",children:"\uD83D\uDC4E"}):a.jsx("span",{className:"text-gray-400",children:"-"}),width:"60px"},{key:"llm_confidence",label:"Confidence",render:e=>e?(0,a.jsxs)("span",{className:`text-xs ${e>=.8?"text-green-600":e>=.6?"text-yellow-600":"text-red-600"}`,children:[(100*e).toFixed(0),"%"]}):"-",width:"80px"}],U=[{label:"View Details",icon:a.jsx(d.Z,{size:14}),onClick:e=>{S(e)},variant:"secondary"},{label:"Create Suggestion",icon:a.jsx(c.Z,{size:14}),onClick:e=>{S(e),I(!0)},variant:"primary"}];return e?.permissions?.is_tester||e?.permissions?.is_admin||e?.permissions?.is_super_admin?(0,a.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 sm:mb-6 gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-2",children:"Problem Queue"}),(0,a.jsxs)("p",{className:"text-sm sm:text-base text-neutral-600",children:["Messages that need tester attention (",t.length," items)"]})]}),(0,a.jsxs)(g.Z,{onClick:Z,className:"btn-secondary flex items-center gap-2 text-sm",children:[a.jsx(o.Z,{size:16}),"Refresh"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-4 sm:mb-6",children:[(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(x.Z,{className:"text-red-600 flex-shrink-0",size:14}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"High Priority"})]}),a.jsx("p",{className:"text-lg sm:text-2xl font-bold text-red-600",children:t.filter(e=>1===e.priority).length})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(m.Z,{className:"text-orange-600 flex-shrink-0",size:14}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Negative Ratings"})]}),a.jsx("p",{className:"text-lg sm:text-2xl font-bold text-orange-600",children:t.filter(e=>-1===e.rating).length})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(u.Z,{className:"text-yellow-600 flex-shrink-0",size:14}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Fallback Used"})]}),a.jsx("p",{className:"text-lg sm:text-2xl font-bold text-yellow-600",children:t.filter(e=>e.fallback_used).length})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx(p,{className:"text-purple-600 flex-shrink-0",size:14}),a.jsx("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Low Confidence"})]}),a.jsx("p",{className:"text-lg sm:text-2xl font-bold text-purple-600",children:t.filter(e=>e.llm_confidence&&e.llm_confidence<.6).length})]})]}),a.jsx("div",{className:"card p-3 sm:p-4 mb-4 sm:mb-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-4 items-end",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1",children:"Time Range"}),(0,a.jsxs)("select",{value:w,onChange:e=>_(Number(e.target.value)),className:"input w-full text-sm",children:[a.jsx("option",{value:1,children:"Last 24h"}),a.jsx("option",{value:3,children:"Last 3 days"}),a.jsx("option",{value:7,children:"Last week"}),a.jsx("option",{value:14,children:"Last 2 weeks"}),a.jsx("option",{value:30,children:"Last month"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1",children:"Priority"}),(0,a.jsxs)("select",{value:y,onChange:e=>f(e.target.value),className:"input w-full text-sm",children:[a.jsx("option",{value:"",children:"All"}),a.jsx("option",{value:"1",children:"High"}),a.jsx("option",{value:"2",children:"Medium"}),a.jsx("option",{value:"3",children:"Low"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"block text-xs sm:text-sm font-medium mb-1",children:"Issue Type"}),(0,a.jsxs)("select",{value:N,onChange:e=>k(e.target.value),className:"input w-full text-sm",children:[a.jsx("option",{value:"",children:"All Issues"}),a.jsx("option",{value:"negative_rating",children:"Negative Rating"}),a.jsx("option",{value:"fallback",children:"Fallback Used"}),a.jsx("option",{value:"low_confidence",children:"Low Confidence"}),a.jsx("option",{value:"unhandled",children:"Unhandled"})]})]}),a.jsx("div",{className:"sm:col-span-2 lg:col-span-1",children:(0,a.jsxs)(g.Z,{onClick:()=>{f(""),k(""),_(7)},className:"btn-secondary flex items-center gap-2 w-full sm:w-auto text-sm",children:[a.jsx(h.Z,{size:16}),"Clear Filters"]})})]})}),a.jsx("div",{className:"overflow-x-auto",children:a.jsx(i.Z,{data:t,columns:L,actions:U,loading:b,searchable:!0,searchPlaceholder:"Search messages...",emptyMessage:"No problematic messages found",className:"text-xs sm:text-sm"})}),C&&!P&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[a.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:()=>S(null)}),a.jsx("div",{className:"relative bg-white dark:bg-neutral-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start mb-4 sm:mb-6 gap-3",children:[a.jsx("h2",{className:"text-lg sm:text-xl font-bold",children:"Message Details"}),a.jsx(g.Z,{onClick:()=>S(null),className:"btn-secondary text-sm",children:"Close"})]}),(0,a.jsxs)("div",{className:"space-y-4 sm:space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm",children:"Issue Type:"}),a.jsx("span",{className:`ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${D(C.issue_type)}`,children:A(C.issue_type)})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm",children:"Priority:"}),a.jsx("span",{className:`ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${M(C.priority)}`,children:q(C.priority)})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm",children:"Intent:"}),a.jsx("span",{className:"ml-2 text-sm",children:C.intent||"None"})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm",children:"Rating:"}),1===C.rating&&a.jsx("span",{className:"text-green-600 ml-2",children:"\uD83D\uDC4D Positive"}),-1===C.rating&&a.jsx("span",{className:"text-red-600 ml-2",children:"\uD83D\uDC4E Negative"}),!C.rating&&a.jsx("span",{className:"text-gray-500 ml-2",children:"No rating"})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm",children:"Created:"}),a.jsx("span",{className:"ml-2 text-sm",children:new Date(C.created_at).toLocaleString()})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm",children:"Processing Time:"}),a.jsx("span",{className:"ml-2 text-sm",children:C.processing_time_ms?`${C.processing_time_ms}ms`:"N/A"})]})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm sm:text-base",children:"User Message:"}),(0,a.jsxs)("div",{className:"mt-2 p-3 sm:p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[a.jsx(m.Z,{className:"inline mr-2 flex-shrink-0",size:16}),a.jsx("span",{className:"text-sm whitespace-pre-wrap break-words",children:C.user_message})]})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm sm:text-base",children:"AI Response:"}),a.jsx("div",{className:"mt-2 p-3 sm:p-4 bg-neutral-50 dark:bg-neutral-700 rounded-lg",children:a.jsx("span",{className:"text-sm whitespace-pre-wrap break-words",children:C.assistant_response})})]}),C.routing_log_id&&(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm sm:text-base",children:"Routing Information:"}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400",children:"LLM Intent:"}),a.jsx("span",{className:"ml-2 break-words",children:C.llm_intent||"N/A"})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400",children:"LLM Confidence:"}),a.jsx("span",{className:"ml-2",children:C.llm_confidence?(100*C.llm_confidence).toFixed(1)+"%":"N/A"})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400",children:"Router Intent:"}),a.jsx("span",{className:"ml-2 break-words",children:C.router_intent||"N/A"})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400",children:"Final Intent:"}),a.jsx("span",{className:"ml-2 break-words",children:C.final_intent||"N/A"})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400",children:"Fallback Used:"}),a.jsx("span",{className:`ml-2 ${C.fallback_used?"text-red-600":"text-green-600"}`,children:C.fallback_used?"Yes":"No"})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400",children:"User ID:"}),a.jsx("span",{className:"ml-2 font-mono text-xs break-all",children:C.user_id})]})]})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{className:"text-sm sm:text-base",children:"Context Information:"}),(0,a.jsxs)("div",{className:"mt-2 grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400",children:"Conversation ID:"}),a.jsx("span",{className:"ml-2 font-mono text-xs break-all",children:C.conversation_id})]}),(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400",children:"School ID:"}),a.jsx("span",{className:"ml-2 font-mono text-xs break-all",children:C.school_id||"N/A"})]}),C.rated_at&&(0,a.jsxs)("div",{children:[a.jsx("span",{className:"text-neutral-600 dark:text-neutral-400",children:"Rated At:"}),a.jsx("span",{className:"ml-2 text-sm",children:new Date(C.rated_at).toLocaleString()})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4 pt-4 border-t",children:[(0,a.jsxs)(g.Z,{onClick:()=>I(!0),className:"flex items-center gap-2 text-sm",children:[a.jsx(c.Z,{size:16}),"Create Suggestion"]}),(0,a.jsxs)(g.Z,{onClick:()=>window.open(`/admin/monitoring?conversation=${C.conversation_id}`,"_blank"),className:"btn-secondary flex items-center gap-2 text-sm",children:[a.jsx(d.Z,{size:16}),a.jsx("span",{className:"hidden sm:inline",children:"View Full Conversation"}),a.jsx("span",{className:"sm:hidden",children:"View Conversation"})]})]})]})]})})]}),P&&C&&a.jsx(j,{message:C,onClose:()=>{I(!1),S(null)},onSubmit:()=>{I(!1),S(null)}})]}):a.jsx("div",{className:"p-4 sm:p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-4",children:"Access Denied"}),a.jsx("p",{className:"text-neutral-600",children:"You don't have permission to access the tester queue."})]})})}function j({message:e,onClose:t,onSubmit:s}){let[l,i]=(0,r.useState)({suggestion_type:"prompt_template",title:"",description:"",handler:e.intent||"",intent:e.intent||"",pattern:"",template_text:"",priority:"medium",tester_note:""}),[d,c]=(0,r.useState)(!1),o=async()=>{if(!l.title||!l.description){alert("Please fill in title and description");return}if("regex_pattern"===l.suggestion_type&&!l.pattern){alert("Please provide a regex pattern");return}if("prompt_template"===l.suggestion_type&&!l.template_text){alert("Please provide template text");return}try{c(!0),await n.g.submitSuggestion({message_id:e.message_id,routing_log_id:e.routing_log_id,suggestion_type:l.suggestion_type,title:l.title,description:l.description,handler:l.handler,intent:l.intent,pattern:l.pattern||void 0,template_text:l.template_text||void 0,priority:l.priority,tester_note:l.tester_note||void 0}),alert("Suggestion submitted successfully!"),s()}catch(e){console.error("Failed to submit suggestion:",e),alert("Failed to submit suggestion. Please try again.")}finally{c(!1)}},x=()=>[{value:"regex_pattern",label:"Regex Pattern",description:"Add a regex pattern to improve classification"},{value:"prompt_template",label:"Prompt Template",description:"Improve the AI response template"},{value:"intent_mapping",label:"Intent Mapping",description:"Create or modify intent mapping"},{value:"error_handling",label:"Error Handling",description:"Improve error handling"}],m=()=>[{value:"low",label:"Low",description:"Nice to have improvement"},{value:"medium",label:"Medium",description:"Should be addressed"},{value:"high",label:"High",description:"Important fix needed"},{value:"critical",label:"Critical",description:"Urgent issue affecting users"}];return(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[a.jsx("div",{className:"absolute inset-0 bg-black/50",onClick:t}),a.jsx("div",{className:"relative bg-white dark:bg-neutral-800 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-4 sm:p-6",children:[a.jsx("h2",{className:"text-lg sm:text-xl font-bold mb-3 sm:mb-4",children:"Create Suggestion"}),(0,a.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-xs sm:text-sm",children:"Suggestion Type"}),a.jsx("select",{value:l.suggestion_type,onChange:e=>i(t=>({...t,suggestion_type:e.target.value})),className:"input text-sm",children:x().map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))}),a.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:x().find(e=>e.value===l.suggestion_type)?.description})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-xs sm:text-sm",children:"Title"}),a.jsx("input",{type:"text",value:l.title,onChange:e=>i(t=>({...t,title:e.target.value})),className:"input text-sm",placeholder:"Brief description of the suggestion",required:!0})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-xs sm:text-sm",children:"Description"}),a.jsx("textarea",{value:l.description,onChange:e=>i(t=>({...t,description:e.target.value})),className:"input min-h-24 text-sm",placeholder:"Detailed explanation of the issue and proposed solution",required:!0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-xs sm:text-sm",children:"Handler"}),a.jsx("input",{type:"text",value:l.handler,onChange:e=>i(t=>({...t,handler:e.target.value})),className:"input text-sm",placeholder:"e.g., homework_help"})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-xs sm:text-sm",children:"Intent"}),a.jsx("input",{type:"text",value:l.intent,onChange:e=>i(t=>({...t,intent:e.target.value})),className:"input text-sm",placeholder:"e.g., get_assignment"})]})]}),"regex_pattern"===l.suggestion_type&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-xs sm:text-sm",children:"Regex Pattern"}),a.jsx("input",{type:"text",value:l.pattern,onChange:e=>i(t=>({...t,pattern:e.target.value})),className:"input font-mono text-sm",placeholder:"(?i)\\\\b(homework|assignment)\\\\b.*\\\\b(help|assist)"}),a.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"Regular expression pattern for matching user messages. Use (?i) for case-insensitive matching."})]}),"prompt_template"===l.suggestion_type&&(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-xs sm:text-sm",children:"Template Text"}),a.jsx("textarea",{value:l.template_text,onChange:e=>i(t=>({...t,template_text:e.target.value})),className:"input min-h-32 font-mono text-sm",placeholder:"Improved response template with clear, helpful guidance..."}),a.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"Provide a better template that would improve the AI's response to this type of query."})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-xs sm:text-sm",children:"Priority"}),a.jsx("select",{value:l.priority,onChange:e=>i(t=>({...t,priority:e.target.value})),className:"input text-sm",children:m().map(e=>a.jsx("option",{value:e.value,children:e.label},e.value))}),a.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:m().find(e=>e.value===l.priority)?.description})]}),(0,a.jsxs)("div",{children:[a.jsx("label",{className:"label text-xs sm:text-sm",children:"Tester Note (Optional)"}),a.jsx("textarea",{value:l.tester_note,onChange:e=>i(t=>({...t,tester_note:e.target.value})),className:"input min-h-20 text-sm",placeholder:"Additional context, testing notes, or implementation guidance for admins..."})]}),(0,a.jsxs)("div",{className:"border-t pt-3 sm:pt-4",children:[a.jsx("h4",{className:"font-semibold mb-2 text-sm sm:text-base",children:"Related Message Context:"}),(0,a.jsxs)("div",{className:"text-xs sm:text-sm space-y-2",children:[(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"User:"})," ",a.jsx("span",{className:"break-words",children:e.user_message})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"AI:"})," ",a.jsx("span",{className:"break-words",children:e.assistant_response})]}),(0,a.jsxs)("div",{children:[a.jsx("strong",{children:"Issue:"})," ",e.issue_type]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 mt-4 sm:mt-6",children:[a.jsx(g.Z,{onClick:o,disabled:d||!l.title||!l.description,className:"flex-1 text-sm",children:d?"Submitting...":"Submit Suggestion"}),a.jsx(g.Z,{onClick:t,className:"btn-secondary flex-1 text-sm",children:"Cancel"})]})]})})]})}},3679:(e,t,s)=>{"use strict";s.d(t,{Z:()=>l});var a=s(326),r=s(1135);function l({className:e,children:t,...s}){return a.jsx("button",{className:(0,r.Z)("btn-primary",e),...s,children:t})}},2607:(e,t,s)=>{"use strict";s.d(t,{Z:()=>c});var a=s(326),r=s(7577),l=s(8307),n=s(1890);let i=(0,s(2881).Z)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);var d=s(3679);function c({data:e,columns:t,actions:s,loading:c=!1,searchable:o=!1,searchPlaceholder:x="Search...",pagination:m,emptyMessage:u="No data available",className:p=""}){let[h,g]=(0,r.useState)(""),[b,j]=(0,r.useState)(null),v=o?e.filter(e=>Object.values(e).some(e=>String(e).toLowerCase().includes(h.toLowerCase()))):e,y=b?[...v].sort((e,t)=>{let s=e[b.key],a=t[b.key];return s<a?"asc"===b.direction?-1:1:s>a?"asc"===b.direction?1:-1:0}):v,f=e=>{j(t=>t?.key===e?{key:e,direction:"asc"===t.direction?"desc":"asc"}:{key:e,direction:"asc"})},N=(e,t)=>{let s=e[t.key];return t.render?t.render(s,e):s};return c?a.jsx("div",{className:`card ${p}`,children:(0,a.jsxs)("div",{className:"p-8 text-center",children:[a.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-[--color-brand]"}),a.jsx("p",{className:"mt-2 text-neutral-600",children:"Loading..."})]})}):(0,a.jsxs)("div",{className:`card ${p}`,children:[o&&a.jsx("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-700",children:(0,a.jsxs)("div",{className:"relative",children:[a.jsx(l.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400",size:16}),a.jsx("input",{type:"text",placeholder:x,value:h,onChange:e=>g(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg  bg-white dark:bg-neutral-800 focus:ring-2 focus:ring-[--color-brand] focus:border-transparent"})]})}),a.jsx("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[a.jsx("thead",{className:"bg-neutral-50 dark:bg-neutral-800",children:(0,a.jsxs)("tr",{children:[t.map((e,t)=>a.jsx("th",{className:`px-4 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider
                    ${e.sortable?"cursor-pointer hover:bg-neutral-100 dark:hover:bg-neutral-700":""}
                    ${e.width?`w-${e.width}`:""}`,onClick:e.sortable?()=>f(String(e.key)):void 0,children:(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[e.label,e.sortable&&b?.key===e.key&&a.jsx("span",{className:"text-[--color-brand]",children:"asc"===b.direction?"↑":"↓"})]})},t)),s&&s.length>0&&a.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-700",children:0===y.length?a.jsx("tr",{children:a.jsx("td",{colSpan:t.length+(s?1:0),className:"px-4 py-8 text-center text-neutral-500 dark:text-neutral-400",children:u})}):y.map((e,r)=>(0,a.jsxs)("tr",{className:"hover:bg-neutral-50 dark:hover:bg-neutral-800/50",children:[t.map((t,s)=>a.jsx("td",{className:"px-4 py-3 text-sm text-neutral-900 dark:text-neutral-100",children:N(e,t)},s)),s&&s.length>0&&a.jsx("td",{className:"px-4 py-3 text-sm",children:a.jsx("div",{className:"flex gap-2",children:s.map((t,s)=>(0,a.jsxs)(d.Z,{onClick:()=>t.onClick(e),className:`btn-sm ${"danger"===t.variant?"btn-danger":"secondary"===t.variant?"btn-secondary":"btn-primary"}`,disabled:t.disabled?.(e),children:[t.icon&&a.jsx("span",{className:"mr-1",children:t.icon}),t.label]},s))})})]},r))})]})}),m&&(0,a.jsxs)("div",{className:"px-4 py-3 border-t border-neutral-200 dark:border-neutral-700 flex items-center justify-between",children:[(0,a.jsxs)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:["Page ",m.currentPage," of ",m.totalPages]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(d.Z,{onClick:()=>m.onPageChange(m.currentPage-1),disabled:m.currentPage<=1,className:"btn-sm btn-secondary",children:[a.jsx(n.Z,{size:16}),"Previous"]}),(0,a.jsxs)(d.Z,{onClick:()=>m.onPageChange(m.currentPage+1),disabled:m.currentPage>=m.totalPages,className:"btn-sm btn-secondary",children:["Next",a.jsx(i,{size:16})]})]})]})]})}},8998:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},2714:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},9561:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]])},3855:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},1405:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},8307:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},949:(e,t,s)=>{"use strict";s.d(t,{Z:()=>a});let a=(0,s(2881).Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},7750:(e,t,s)=>{"use strict";s.d(t,{g:()=>l});var a=s(2374);class r{async getQueue(e={}){let t=new URLSearchParams;return e.priority&&t.append("priority",e.priority.toString()),e.issue_type&&t.append("issue_type",e.issue_type),e.limit&&t.append("limit",e.limit.toString()),e.days_back&&t.append("days_back",e.days_back.toString()),e.school_id&&t.append("school_id",e.school_id),(await a.x.get(`/api/tester/queue?${t.toString()}`)).data}async submitSuggestion(e){return(await a.x.post("/api/tester/suggestions",e)).data}async getMySuggestions(e={}){let t=new URLSearchParams;return e.limit&&t.append("limit",e.limit.toString()),e.status&&t.append("status",e.status),e.suggestion_type&&t.append("suggestion_type",e.suggestion_type),(await a.x.get(`/api/tester/suggestions?${t.toString()}`)).data}async getStats(e={}){let t=new URLSearchParams;return e.days_back&&t.append("days_back",e.days_back.toString()),e.school_id&&t.append("school_id",e.school_id),(await a.x.get(`/api/tester/stats?${t.toString()}`)).data}async getFilters(){return(await a.x.get("/api/tester/filters")).data}getSuggestionTypes(){return[{value:"regex_pattern",label:"Regex Pattern",description:"Add or improve message classification patterns"},{value:"prompt_template",label:"Prompt Template",description:"Improve response templates for better answers"},{value:"intent_mapping",label:"Intent Mapping",description:"Better intent classification for specific handlers"},{value:"handler_improvement",label:"Handler Improvement",description:"General handler behavior improvements"}]}getPriorityLevels(){return[{value:"critical",label:"Critical",description:"Urgent fixes for broken responses"},{value:"high",label:"High",description:"Important improvements for common issues"},{value:"medium",label:"Medium",description:"General improvements and optimizations"},{value:"low",label:"Low",description:"Minor enhancements and edge cases"}]}getIssueTypeLabels(){return{negative_rating:"User gave thumbs down",fallback:"Fallback response used",low_confidence:"Low classification confidence",unhandled:"Unhandled intent"}}getPriorityLabels(){return{1:"High",2:"Medium",3:"Low"}}getPriorityColor(e){switch(e){case 1:return"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200";case 2:return"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200";default:return"bg-gray-100 dark:bg-gray-900/30 text-gray-800 dark:text-gray-200"}}getIssueTypeColor(e){switch(e){case"negative_rating":return"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200";case"fallback":return"bg-orange-100 dark:bg-orange-900/30 text-orange-800 dark:text-orange-200";case"low_confidence":return"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200";case"unhandled":return"bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-200";default:return"bg-gray-100 dark:bg-gray-900/30 text-gray-800 dark:text-gray-200"}}getSuggestionStatusColor(e){switch(e){case"pending":default:return"bg-gray-100 dark:bg-gray-900/30 text-gray-800 dark:text-gray-200";case"approved":return"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200";case"rejected":return"bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-200";case"implemented":return"bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-200"}}}let l=new r},9602:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>l,default:()=>i});var a=s(8570);let r=(0,a.createProxy)(String.raw`/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/tester/layout.tsx`),{__esModule:l,$$typeof:n}=r;r.default;let i=(0,a.createProxy)(String.raw`/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/tester/layout.tsx#default`)},8262:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>l,default:()=>i});var a=s(8570);let r=(0,a.createProxy)(String.raw`/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/tester/queue/page.tsx`),{__esModule:l,$$typeof:n}=r;r.default;let i=(0,a.createProxy)(String.raw`/Users/ericmwirichia/Documents/SchoolAI/admin-frontend/app/tester/queue/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[226,784,392],()=>s(5044));module.exports=a})();