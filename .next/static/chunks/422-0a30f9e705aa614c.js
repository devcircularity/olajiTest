"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[422],{422:function(e,t,l){l.d(t,{Z:function(){return x}});var a=l(7437),s=l(2265),n=l(8604),o=l(2023),r=l(4697),i=l(2513),c=l(994),d=l(6780),u=l(459);let m={async sendChatMessageWithFiles(e,t,l){var a,s,n,o,r,i,c;console.log("=== FILE SERVICE DEBUG START ==="),console.log("Message:",e),console.log("Files count:",t.length),console.log("ConversationId received:",l),console.log("ConversationId type:",typeof l),console.log("ConversationId truthy?",!!l),console.log('ConversationId === "undefined"?',"undefined"===l),console.log("ConversationId === undefined?",void 0===l),console.log("ConversationId === null?",null===l),console.log('ConversationId === ""?',""===l);let d=new FormData;for(let[t,a]of(d.append("message",e),l&&"undefined"!==l&&"null"!==l&&""!==l.trim()?(console.log("✅ Appending conversation_id to FormData:",l),d.append("conversation_id",l.trim())):(console.log("❌ NOT appending conversation_id - will create new conversation"),console.log("  Reason: conversationId is",l)),console.log("FormData contents before files:"),d.entries()))"string"==typeof a?console.log("  ".concat(t,': "').concat(a,'"')):console.log("  ".concat(t,":"),a);t.forEach((e,t)=>{console.log("Appending file ".concat(t,": ").concat(e.name," (").concat(e.size," bytes, ").concat(e.type,")")),d.append("files",e)}),console.log("Final FormData entries:");let m=!1;for(let[e,t]of d.entries())"conversation_id"===e?(m=!0,console.log("  ✅ ".concat(e,': "').concat(t,'"'))):"message"===e?console.log("  ".concat(e,': "').concat(t,'"')):"files"===e?console.log("  ".concat(e,": [File object]")):console.log("  ".concat(e,":"),t);console.log("Has conversation_id in FormData?",m);try{console.log("\uD83D\uDE80 Making API call to /api/chat/message-with-files");let e=Date.now(),{data:t}=await u.h.post("/api/chat/message-with-files",d,{headers:{"Content-Type":"multipart/form-data"},timeout:12e4}),n=Date.now();return console.log("✅ API Response received in",n-e,"ms"),console.log("Response data:",{conversation_id:t.conversation_id,intent:t.intent,response_preview:(null===(a=t.response)||void 0===a?void 0:a.substring(0,100))+"...",attachment_processed:t.attachment_processed,blocks_count:(null===(s=t.blocks)||void 0===s?void 0:s.length)||0}),l&&t.conversation_id&&l!==t.conversation_id?(console.log("⚠️ CONVERSATION ID MISMATCH!"),console.log("  Sent:",l),console.log("  Received:",t.conversation_id)):!l&&t.conversation_id?console.log("✅ New conversation created:",t.conversation_id):l&&t.conversation_id&&l===t.conversation_id&&console.log("✅ Message added to existing conversation:",t.conversation_id),console.log("=== FILE SERVICE DEBUG END ==="),t}catch(e){throw console.error("❌ FILE SERVICE ERROR:",e),console.error("Error details:",{status:null===(n=e.response)||void 0===n?void 0:n.status,statusText:null===(o=e.response)||void 0===o?void 0:o.statusText,data:null===(r=e.response)||void 0===r?void 0:r.data,message:e.message}),Error((null===(c=e.response)||void 0===c?void 0:null===(i=c.data)||void 0===i?void 0:i.detail)||e.message||"File processing failed")}},async testFileUpload(e){console.log("Testing file upload for:",e.name);let t=new FormData;t.append("file",e);try{let{data:e}=await u.h.post("/api/test/upload-file",t,{headers:{"Content-Type":"multipart/form-data"}});return console.log("Test upload successful:",e),e}catch(e){var l,a;throw console.error("Test upload failed:",e),Error((null===(a=e.response)||void 0===a?void 0:null===(l=a.data)||void 0===l?void 0:l.detail)||"Test upload failed")}},async testCompleteProcessing(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"What is this document about?";console.log("Testing complete processing for:",e.name);let l=new FormData;l.append("file",e),l.append("message",t);try{let{data:e}=await u.h.post("/api/test/test-ollama",l,{headers:{"Content-Type":"multipart/form-data"},timeout:12e4});return console.log("Complete processing test successful"),e}catch(e){var a,s;throw console.error("Complete processing test failed:",e),Error((null===(s=e.response)||void 0===s?void 0:null===(a=s.data)||void 0===a?void 0:a.detail)||"Test processing failed")}},async healthCheck(){try{let{data:e}=await u.h.get("/api/test/health/services");return console.log("Health check result:",e),e}catch(l){var e,t;return console.error("Health check failed:",l),{status:"unhealthy",error:(null===(t=l.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.detail)||"Health check failed"}}},async checkOllamaHealth(){try{let{data:e}=await u.h.get("/api/chat/health/ollama");return console.log("Ollama health check result:",e),e}catch(l){var e,t;return console.error("Ollama health check failed:",l),{ollama_available:!1,error:(null===(t=l.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.detail)||"Ollama health check failed"}}},utils:{formatFileSize:e=>e<1024?e+" B":e<1048576?Math.round(e/1024)+" KB":Math.round(e/1048576*100)/100+" MB",validateFileClientSide(e){return["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/bmp","image/tiff","application/pdf"].includes(e.type)?e.size>10485760?{valid:!1,error:"File too large: ".concat(this.formatFileSize(e.size),". Maximum: ").concat(10,"MB")}:{valid:!0}:{valid:!1,error:"Unsupported file type: ".concat(e.type,". Supported: images and PDFs")}},getFileExtension(e){var t;return"."+(null===(t=e.split(".").pop())||void 0===t?void 0:t.toLowerCase())},isImageFile:e=>e.type.startsWith("image/"),isPDFFile:e=>"application/pdf"===e.type,createPreviewURL(e){return this.isImageFile(e)?URL.createObjectURL(e):null},revokePreviewURL(e){try{URL.revokeObjectURL(e)}catch(t){console.warn("Failed to revoke URL:",e)}},getFileTypeDescription(e){return this.isImageFile(e)?"Image":this.isPDFFile(e)?"PDF Document":"Document"},validateMultipleFiles(e){let t=[],l=[];return e.length>5&&(e.slice(5).forEach(e=>{l.push({file:e,error:"Maximum 5 files allowed per message"})}),e=e.slice(0,5)),e.forEach(e=>{let a=this.validateFileClientSide(e);a.valid?t.push(e):l.push({file:e,error:a.error||"Invalid file"})}),{valid:t,invalid:l}},debugConversationId(e){console.log("=== CONVERSATION ID DEBUG ==="),console.log("Value:",e),console.log("Type:",typeof e),console.log("String value:",String(e)),console.log("JSON stringify:",JSON.stringify(e)),console.log("Truthy:",!!e),console.log("Is undefined:",void 0===e),console.log("Is null:",null===e),console.log("Is empty string:",""===e),console.log('Is "undefined" string:',"undefined"===e),console.log('Is "null" string:',"null"===e),console.log("Length (if string):","string"==typeof e?e.length:"N/A"),console.log("Trimmed (if string):","string"==typeof e?'"'.concat(e.trim(),'"'):"N/A"),console.log("=== END DEBUG ===")}}},g={MAX_FILE_SIZE_MB:10,SUPPORTED_TYPES:["image/jpeg","image/jpg","image/png","image/gif","image/webp","image/bmp","image/tiff","application/pdf"]};var h=l(6195),p=l(7276);function x(e){let{onSend:t,onSendWithFiles:l,onFileProcessingComplete:u,onNewMessage:x,busy:v,conversationId:f}=e,[b,w]=(0,s.useState)(""),[y,j]=(0,s.useState)(!1),[k,N]=(0,s.useState)([]),[F,E]=(0,s.useState)(!1),[C,I]=(0,s.useState)(null),[_,D]=(0,s.useState)({top:0,left:0}),S=(0,s.useRef)(null),R=(0,s.useRef)(null),T=(0,s.useRef)(null),P=(0,s.useRef)(null),M=async(e,a)=>{var s;let n=e||b.trim();if(n&&p.z5.send({type:"auto-collapse"}),k.length>0&&!F){if(!n){I("Please enter a message to send with the file(s)");return}E(!0),I(null);try{if(console.log("=== FILE UPLOAD DEBUG ==="),console.log("Message:",n),console.log("Files:",k.length),console.log("ConversationId from props:",f),console.log("onSendWithFiles exists:",!!l),l)console.log("Using onSendWithFiles handler - existing chat flow"),await l(n,k,f);else{console.log("Using chatService.sendMessageWithFiles - new chat flow"),console.log("ConversationId being passed:",f);let e=await h.A.sendMessageWithFiles(n,k,f);console.log("Chat service response:",{conversation_id:e.conversation_id,intent:e.intent,attachment_processed:e.attachment_processed});let l={type:"file_processing_complete",conversation_id:e.conversation_id,attachment_processed:e.attachment_processed,files_count:k.length,backend_response:e};await t(n,l)}N([]),w("")}catch(e){I(e instanceof Error?e.message:"File processing failed"),console.error("File processing error:",e)}finally{E(!1)}return}if(n&&!v&&!F){e||w("");try{await t(n,a)}catch(e){console.error("Error in ChatInput:",e)}null===(s=S.current)||void 0===s||s.focus()}},z=async e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),await M())};(0,s.useEffect)(()=>{S.current&&(S.current.style.height="auto",S.current.style.height="".concat(Math.min(S.current.scrollHeight,120),"px"))},[b]),(0,s.useEffect)(()=>{let e=e=>{T.current&&!T.current.contains(e.target)&&P.current&&!P.current.contains(e.target)&&j(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let L=e=>{R.current&&(R.current.accept=e,R.current.click()),j(!1)},U=e=>{let t=k[e];m.utils.isImageFile(t),N(t=>t.filter((t,l)=>l!==e)),I(null)},O=e=>m.utils.formatFileSize(e),A=(b.trim()||k.length>0)&&!v&&!F,B=v||F;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"pt-2 pb-3 bg-gradient-to-t from-neutral-100/60 via-neutral-50/20 to-transparent dark:from-neutral-950/60 dark:via-neutral-950/20",children:(0,a.jsxs)("div",{className:"mx-auto max-w-4xl px-4 sm:px-6",children:[(0,a.jsxs)("div",{className:"border border-neutral-300/60 bg-white/70 dark:border-neutral-700/60 dark:bg-neutral-900/70 rounded-2xl sm:rounded-3xl shadow-[var(--shadow-soft)] relative overflow-visible",children:[k.length>0&&(0,a.jsxs)("div",{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-2",children:[(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:k.map((e,t)=>(0,a.jsx)("div",{className:"relative w-12 h-12 sm:w-16 sm:h-16",title:"".concat(e.name," (").concat(O(e.size),") - ").concat(m.utils.getFileTypeDescription(e)),children:(0,a.jsxs)("div",{className:"w-full h-full bg-neutral-200 dark:bg-neutral-700 rounded-lg sm:rounded-xl overflow-hidden border border-neutral-300 dark:border-neutral-600 group relative",children:[m.utils.isImageFile(e)?(0,a.jsx)("img",{src:URL.createObjectURL(e),alt:e.name,className:"w-full h-full object-cover",onLoad:e=>{let t=e.target;setTimeout(()=>{try{URL.revokeObjectURL(t.src)}catch(e){}},1e3)},onError:e=>{e.target.style.display="none"}}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center w-full h-full bg-neutral-300 dark:bg-neutral-600 text-xs",children:[(0,a.jsx)(o.Z,{size:16,className:"sm:w-5 sm:h-5 text-neutral-600 dark:text-neutral-300 mb-1"}),(0,a.jsx)("span",{className:"text-[9px] sm:text-[10px] text-neutral-500 dark:text-neutral-400 text-center px-1 leading-tight",children:m.utils.isPDFFile(e)?"PDF":"DOC"})]}),F&&(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"})}),(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),U(t)},className:"absolute -top-1 -right-1 sm:-top-2 sm:-right-2 w-5 h-5 sm:w-6 sm:h-6 bg-red-500 hover:bg-red-600 rounded-full  flex items-center justify-center opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-all duration-200 shadow-lg border-2 border-white z-20 touch-manipulation",disabled:F,"aria-label":"Remove ".concat(e.name),children:(0,a.jsx)(r.Z,{size:10,className:"sm:w-3.5 sm:h-3.5 text-white"})})]})},"".concat(e.name,"-").concat(e.size,"-").concat(t)))}),k.length>1&&(0,a.jsxs)("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-1",children:[k.length," files selected (",k.reduce((e,t)=>e+t.size,0)>1048576?O(k.reduce((e,t)=>e+t.size,0)):O(k.reduce((e,t)=>e+t.size,0))," total)"]})]}),(0,a.jsxs)("div",{className:"px-3 sm:px-4 py-2 sm:py-3",children:[(0,a.jsx)("div",{children:(0,a.jsx)("textarea",{ref:S,value:b,onChange:e=>w(e.target.value),onKeyDown:z,placeholder:k.length>0?"Ask me about these files...":F?"Processing files...":"Reply to Olaji Chat...","aria-label":"Chat message",className:"w-full bg-transparent outline-none resize-none text-base sm:text-lg leading-relaxed text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-500 dark:placeholder:text-neutral-500 disabled:opacity-50 min-h-[36px] max-h-[120px] py-1 px-0",disabled:B,maxLength:2e3,rows:1})}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"relative",ref:T,children:(0,a.jsx)("button",{ref:P,onClick:()=>{if(!y&&P.current){let e=P.current.getBoundingClientRect(),t=window.scrollY,l=window.innerWidth,a=e.left,s=e.top+t-10;l<640&&(a=Math.max(16,Math.min(l-216,e.left)),s=e.top+t-80),D({top:s,left:a})}j(!y),I(null)},className:"flex items-center justify-center w-9 h-9 sm:w-10 sm:h-10 text-neutral-600 hover:text-neutral-800  dark:text-neutral-400 dark:hover:text-neutral-200 transition-colors duration-200 touch-manipulation disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Attach files",disabled:B,children:(0,a.jsx)(i.Z,{size:18})})}),(0,a.jsx)("input",{ref:R,type:"file",onChange:e=>{let t=e.target.files;if(!t||0===t.length)return;let l=Array.from(t),a=m.utils.validateMultipleFiles([...k,...l]);if(a.invalid.length>0?I(a.invalid.map(e=>"".concat(e.file.name,": ").concat(e.error)).join(", ")):I(null),a.valid.length>0){let e=a.valid.filter(e=>!k.some(t=>t.name===e.name&&t.size===e.size));e.length>0?N(t=>[...t,...e]):0===a.invalid.length&&I("Some files are already selected")}R.current&&(R.current.value="")},className:"hidden",multiple:!0,accept:g.SUPPORTED_TYPES.join(",")}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsxs)("span",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:["Olaji"," ",(0,a.jsx)("span",{style:{color:"var(--color-brand)"},children:"Chat"})]})}),(0,a.jsx)("button",{className:"flex items-center justify-center w-10 h-10 sm:w-11 sm:h-11 rounded-full transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed touch-manipulation shadow-lg hover:shadow-xl",style:{backgroundColor:A?"var(--color-brand)":"var(--color-neutral-300)",color:"white"},onMouseEnter:e=>{A&&(e.currentTarget.style.backgroundColor="var(--color-brand-dark)")},onMouseLeave:e=>{A&&(e.currentTarget.style.backgroundColor="var(--color-brand)")},onClick:()=>M(),disabled:!A,"aria-label":k.length>0?"Send message with files":"Send message",children:B?(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"})}):(0,a.jsx)(c.Z,{size:18,className:"sm:w-5 sm:h-5"})})]})]})]})]}),C&&(0,a.jsx)("div",{className:"mt-3 text-sm bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(d.Z,{size:16,className:"text-red-600 dark:text-red-400 mt-0.5 flex-shrink-0"}),(0,a.jsx)("div",{className:"text-red-600 dark:text-red-400",children:C})]})}),F&&(0,a.jsx)("div",{className:"mt-3 text-sm text-neutral-600 dark:text-neutral-400 bg-neutral-50 dark:bg-neutral-800 p-3 rounded text-center",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Processing ",k.length," file",1!==k.length?"s":"","..."]})}),b.length>1500&&(0,a.jsxs)("div",{className:"text-xs text-neutral-500 text-right mt-2 hidden sm:block",children:[b.length,"/2000"]}),k.length>0&&!F&&(0,a.jsxs)("div",{className:"mt-3 text-sm text-neutral-500 dark:text-neutral-400 text-center",children:["I'll analyze your ",k.length," file",1!==k.length?"s":""," along with your message"]})]})}),y&&(0,a.jsxs)("div",{className:"fixed bg-white dark:bg-neutral-800  border border-neutral-200 dark:border-neutral-700 rounded-lg shadow-xl  min-w-[180px] sm:min-w-[200px] z-[999] py-2 transform -translate-y-full",style:{top:_.top,left:_.left},ref:T,children:[(0,a.jsxs)("button",{onClick:()=>L("image/*"),className:"flex items-center gap-3 w-full px-4 py-2.5 text-sm text-neutral-700  dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-700  transition-colors text-left",children:[(0,a.jsx)(n.Z,{size:16,className:"text-neutral-500 dark:text-neutral-400"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{children:"Attach Images"}),(0,a.jsx)("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"JPG, PNG, GIF, WebP, etc."})]})]}),(0,a.jsxs)("button",{onClick:()=>L("application/pdf"),className:"flex items-center gap-3 w-full px-4 py-2.5 text-sm text-neutral-700  dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-700  transition-colors text-left",children:[(0,a.jsx)(o.Z,{size:16,className:"text-neutral-500 dark:text-neutral-400"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{children:"Upload PDF"}),(0,a.jsx)("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:"PDF documents up to 10MB"})]})]}),(0,a.jsxs)("button",{onClick:()=>L(g.SUPPORTED_TYPES.join(",")),className:"flex items-center gap-3 w-full px-4 py-2.5 text-sm text-neutral-700  dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-700  transition-colors text-left",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-2 h-2 bg-white rounded-sm"})}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{children:"Any File Type"}),(0,a.jsxs)("div",{className:"text-xs text-neutral-500 dark:text-neutral-400",children:["Images, PDFs (max ",g.MAX_FILE_SIZE_MB,"MB each)"]})]})]})]})]})}}}]);