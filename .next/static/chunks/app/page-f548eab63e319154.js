(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9995:function(e,t,s){Promise.resolve().then(s.bind(s,6774))},6774:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return i}});var n=s(7437),a=s(6463),o=s(2265),r=s(857);function i(){let{user:e,isAuthenticated:t,isLoading:s}=(0,r.a)(),i=(0,a.useRouter)();return(0,o.useEffect)(()=>{var n,a,o;if(!s){if(!t||!e){i.replace("/login");return}(null===(n=e.roles)||void 0===n?void 0:n.includes("TESTER"))?i.replace("/tester"):(null===(a=e.permissions)||void 0===a?void 0:a.is_admin)||(null===(o=e.permissions)||void 0===o?void 0:o.is_super_admin)?i.replace("/admin"):i.replace("/dashboard")}},[e,t,s,i]),(0,n.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Redirecting..."})]})})}},857:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return l},a:function(){return c}});var n=s(7437),a=s(2265),o=s(6463),r=s(1785);let i=(0,a.createContext)({token:null,active_school_id:null,user:null,isLoading:!0,login:async()=>({}),logout:()=>{},setSchoolId:()=>{},isAuthenticated:!1,hasValidRole:!1});function l(e){var t,s,l,c;let{children:u}=e,[d,h]=(0,a.useState)({token:null,active_school_id:null,user:null,isLoading:!0}),m=(0,o.useRouter)();(0,a.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("active_school_id");if(e){r.O.storeToken(e);try{let s=await r.O.getCurrentUser();h({token:e,active_school_id:t,user:s,isLoading:!1})}catch(e){localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),h({token:null,active_school_id:null,user:null,isLoading:!1})}}else h({token:null,active_school_id:null,user:null,isLoading:!1})})()},[]);let g=async e=>{localStorage.setItem("token",e.token),r.O.storeToken(e.token);try{let t=await r.O.getCurrentUser();return h(s=>({...s,token:e.token,user:t,isLoading:!1})),t}catch(t){throw h(t=>({...t,token:e.token,user:null,isLoading:!1})),t}},_=!!(t=d.user)&&!!((null===(s=t.roles)||void 0===s?void 0:s.includes("TESTER"))||(null===(l=t.permissions)||void 0===l?void 0:l.is_admin)||(null===(c=t.permissions)||void 0===c?void 0:c.is_super_admin)),p={...d,login:g,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),r.O.logout(),h({token:null,active_school_id:null,user:null,isLoading:!1}),m.replace("/login")},setSchoolId:e=>{localStorage.setItem("active_school_id",e),r.O.storeSchoolId(e),h(t=>({...t,active_school_id:e}))},isAuthenticated:!!d.token&&!!d.user&&!d.isLoading,hasValidRole:_};return(0,n.jsx)(i.Provider,{value:p,children:u})}let c=()=>(0,a.useContext)(i)},459:function(e,t,s){"use strict";s.d(t,{x:function(){return o}});var n=s(8472);class a{handleApiError(e){!e.response||401!==e.response.status||(localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),window.location.pathname.includes("/login")||window.location.pathname.includes("/signup")||window.location.pathname.includes("/public")||(window.location.href="/login"))}async get(e,t){return this.client.get(e,{params:t})}async post(e,t){return this.client.post(e,t)}async put(e,t){return this.client.put(e,t)}async patch(e,t){return this.client.patch(e,t)}async delete(e){return this.client.delete(e)}async uploadFile(e,t,s){let n=new FormData;return n.append("file",t),s&&Object.keys(s).forEach(e=>{n.append(e,s[e])}),this.client.post(e,n,{headers:{"Content-Type":"multipart/form-data"}})}async healthCheck(){try{let e=await this.client.get("/healthz");return 200===e.status}catch(e){return!1}}getBaseURL(){return this.baseURL}setAuthToken(e){this.client.defaults.headers.common.Authorization="Bearer ".concat(e)}clearAuthToken(){delete this.client.defaults.headers.common.Authorization}static isSuccess(e){return e.status>=200&&e.status<300}static getErrorMessage(e){var t;if(null===(t=e.response)||void 0===t?void 0:t.data){let t=e.response.data;return t.detail||t.message||"An error occurred"}return e.message||"Network error"}constructor(){this.baseURL="http://localhost:8000",this.client=n.Z.create({baseURL:this.baseURL,timeout:3e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,e=>(this.handleApiError(e),Promise.reject(e)))}}let o=new a},1785:function(e,t,s){"use strict";s.d(t,{O:function(){return o}});var n=s(459);class a{async login(e){return(await n.x.post("/api/auth/login",e)).data}async register(e){return(await n.x.post("/api/auth/register",e)).data}async switchSchool(e){return(await n.x.post("/api/auth/switch-school",e)).data}async getCurrentUser(){return(await n.x.get("/api/auth/me")).data}async getUserPermissions(){return(await n.x.get("/api/auth/permissions")).data}hasRole(e,t){var s,n;return null!==(n=null==e?void 0:null===(s=e.roles)||void 0===s?void 0:s.includes(t))&&void 0!==n&&n}hasAnyRole(e,t){return null!=e&&!!e.roles&&t.some(t=>e.roles.includes(t))}isAdmin(e){return this.hasAnyRole(e,["ADMIN","SUPER_ADMIN"])}isSuperAdmin(e){return this.hasRole(e,"SUPER_ADMIN")}isTester(e){return this.hasRole(e,"TESTER")}getPrimaryRole(e){var t;return null!==(t=null==e?void 0:e.primary_role)&&void 0!==t?t:"PARENT"}formatRoleName(e){return({SUPER_ADMIN:"Super Admin",ADMIN:"Administrator",TESTER:"Tester",TEACHER:"Teacher",ACCOUNTANT:"Accountant",PARENT:"Parent"})[e]||e}getAvailableActions(e){let t=[];return e&&(e.can_manage_students&&t.push("manage_students"),e.can_manage_classes&&t.push("manage_classes"),e.can_manage_fees&&t.push("manage_fees"),e.can_manage_payments&&t.push("manage_payments"),e.can_manage_school&&t.push("manage_school"),e.can_manage_users&&t.push("manage_users"),e.can_view_logs&&t.push("view_logs"),e.can_manage_intent_config&&t.push("manage_intent_config"),e.can_access_tester_queue&&t.push("access_tester_queue"),e.can_submit_suggestions&&t.push("submit_suggestions"),e.can_manage_all_schools&&t.push("manage_all_schools"),e.can_access_system_settings&&t.push("access_system_settings")),t}logout(){localStorage.removeItem("token"),localStorage.removeItem("active_school_id")}getStoredToken(){return localStorage.getItem("token")}getStoredSchoolId(){return localStorage.getItem("active_school_id")}storeToken(e){localStorage.setItem("token",e)}storeSchoolId(e){localStorage.setItem("active_school_id",e)}}let o=new a}},function(e){e.O(0,[236,971,23,744],function(){return e(e.s=9995)}),_N_E=e.O()}]);