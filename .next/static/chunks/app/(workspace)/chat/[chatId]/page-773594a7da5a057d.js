(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[151],{9011:function(e,t,a){Promise.resolve().then(a.bind(a,8879))},8879:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return q}});var n=a(7437),s=a(2265),r=a(6463),l=a(6195),i=a(2731);let o=e=>"bar"===e.chartType||"line"===e.chartType||"area"===e.chartType,c=e=>"pie"===e.chartType||"donut"===e.chartType,d=e=>"button"===e.type,u=e=>"button_group"===e.type,m=e=>"confirmation"===e.type,x=e=>"action_panel"===e.type,h=e=>"text"===e.type,g=e=>"kpis"===e.type,p=e=>"chart"===e.type,b=e=>"table"===e.type,v=e=>"timeline"===e.type,f=e=>"empty"===e.type,y=e=>"error"===e.type,j=e=>"file_download"===e.type,k=e=>"status"===e.type;function N(e){let{block:t}=e,a=t.text.split("\n");return(0,n.jsx)("div",{className:"text-neutral-900 dark:text-neutral-100",children:a.map((e,t)=>(0,n.jsx)("div",{className:t>0?"mt-4":"",children:""===e.trim()?(0,n.jsx)("div",{className:"h-4"}):(0,n.jsx)("div",{className:"leading-relaxed",children:e.split(/(\*\*[^*]+\*\*|\*[^*]+\*|`[^`]+`)/g).map((e,t)=>{if(e.startsWith("**")&&e.endsWith("**")){let a=e.slice(2,-2);return(0,n.jsx)("strong",{children:a},t)}if(e.startsWith("*")&&e.endsWith("*")&&!e.startsWith("**")){let a=e.slice(1,-1);return(0,n.jsx)("em",{children:a},t)}if(e.startsWith("`")&&e.endsWith("`")){let a=e.slice(1,-1);return(0,n.jsx)("code",{className:"bg-neutral-100 dark:bg-neutral-800 px-1 py-0.5 rounded text-sm font-mono",children:a},t)}return(0,n.jsx)("span",{children:e},t)})})},t))})}function w(e,t){if("string"==typeof e)return e;switch(t){case"integer":return Math.round(e).toLocaleString();case"decimal":return e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});case"currency:KES":return new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES",minimumFractionDigits:0}).format(e);case"percent":return"".concat((100*e).toFixed(1),"%");case"date":return new Date(e).toLocaleDateString("en-KE");default:return e.toLocaleString()}}function C(e){let t={primary:{bg:"bg-blue-100 dark:bg-blue-900/30",text:"text-blue-700 dark:text-blue-300",badge:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"},secondary:{bg:"bg-gray-100 dark:bg-gray-800",text:"text-gray-700 dark:text-gray-300",badge:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"},success:{bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-700 dark:text-green-300",badge:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"},warning:{bg:"bg-yellow-100 dark:bg-yellow-900/30",text:"text-yellow-700 dark:text-yellow-300",badge:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300"},danger:{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-700 dark:text-red-300",badge:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"},info:{bg:"bg-cyan-100 dark:bg-cyan-900/30",text:"text-cyan-700 dark:text-cyan-300",badge:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900/30 dark:text-cyan-300"}};return t[e]||t.primary}function _(e){switch(e){case"center":return"text-center";case"right":return"text-right";default:return"text-left"}}function S(e){let{block:t,onAction:a}=e,s=e=>{e&&a&&a(e)};return(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:t.items.map((e,t)=>{let a=!!e.action,r=C(e.variant||"primary");return(0,n.jsxs)("div",{className:"\n              card p-4 transition-all duration-200\n              ".concat(a?"cursor-pointer hover:shadow-lg hover:scale-105":"","\n            "),onClick:()=>s(e.action),children:[(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mb-1",children:e.label}),(0,n.jsx)("p",{className:"text-2xl font-semibold text-neutral-900 dark:text-neutral-100",children:w(e.value,e.format)})]}),e.icon&&(0,n.jsx)("div",{className:"p-2 rounded-lg ".concat(r.bg),children:(0,n.jsx)("div",{className:"w-5 h-5 ".concat(r.text),children:(0,n.jsx)("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"w-5 h-5",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})})})]}),e.variant&&(0,n.jsx)("div",{className:"inline-flex px-2 py-1 rounded-full text-xs font-medium mt-2 ".concat(r.badge),children:e.variant})]},t)})})}function E(e){var t;let{block:a,onAction:r}=e,[l,i]=(0,s.useState)(new Set),[o,c]=(0,s.useState)(1),d=(e,t)=>{e._action&&r&&r(e._action)},u=e=>{let t=new Set(l);t.has(e)?t.delete(e):t.add(e),i(t)},m=e=>{r&&r({...e,selectedRows:Array.from(l)})},x=(e,t)=>{if(t.format)return w(e,t.format);if(t.badge&&"string"==typeof e){let a=C(t.badge.map[e]||"primary");return(0,n.jsx)("span",{className:"inline-flex px-2 py-1 rounded-full text-xs font-medium ".concat(a.badge),children:e})}return e},h=(e,t)=>{if("string"==typeof e)return(0,n.jsx)("option",{value:e,children:e},e);{let a=e.value||e.id||"",s=e.label||e.name||a;return(0,n.jsx)("option",{value:a,children:s},"".concat(a,"-").concat(t))}},g=null===(t=a.config.actions)||void 0===t?void 0:t.some(e=>e.selectionRequired);return(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("div",{className:"p-4 border-b border-neutral-200 dark:border-neutral-800",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:a.config.title}),a.config.actions&&a.config.actions.length>0&&(0,n.jsx)("div",{className:"flex gap-2",children:a.config.actions.map((e,t)=>(0,n.jsx)("button",{onClick:()=>m(e),disabled:e.selectionRequired&&0===l.size,className:"btn-primary disabled:opacity-50",children:e.label},t))})]}),a.config.filters&&a.config.filters.length>0&&(0,n.jsx)("div",{className:"flex gap-4 mt-4",children:a.config.filters.map((e,t)=>{var a;return(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("label",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300",children:e.label}),"select"===e.type?(0,n.jsxs)("select",{className:"input min-w-32",children:[(0,n.jsx)("option",{value:"",children:"All"}),null===(a=e.options)||void 0===a?void 0:a.map((e,t)=>h(e,t))]}):"daterange"===e.type?(0,n.jsx)("input",{type:"date",className:"input"}):(0,n.jsx)("input",{type:"text",className:"input",placeholder:"Filter ".concat(e.label)})]},t)})})]}),(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full",children:[(0,n.jsx)("thead",{className:"bg-neutral-50 dark:bg-neutral-800/50",children:(0,n.jsxs)("tr",{children:[g&&(0,n.jsx)("th",{className:"px-4 py-3 text-left",children:(0,n.jsx)("input",{type:"checkbox",onChange:e=>{e.target.checked?i(new Set(Array.from({length:a.config.rows.length},(e,t)=>t))):i(new Set)},className:"rounded border-neutral-300"})}),a.config.columns.map(e=>(0,n.jsx)("th",{className:"px-4 py-3 text-sm font-medium text-neutral-700 dark:text-neutral-300 ".concat(_(e.align)),style:{width:e.width},children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[e.label,e.sortable&&(0,n.jsx)("svg",{className:"w-4 h-4 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})})]})},e.key))]})}),(0,n.jsx)("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-800",children:a.config.rows.map((e,t)=>(0,n.jsxs)("tr",{className:"\n                  hover:bg-neutral-50 dark:hover:bg-neutral-800/50\n                  ".concat(e._action?"cursor-pointer":"","\n                  ").concat(l.has(t)?"bg-blue-50 dark:bg-blue-900/20":"","\n                "),onClick:()=>d(e,t),children:[g&&(0,n.jsx)("td",{className:"px-4 py-3",children:(0,n.jsx)("input",{type:"checkbox",checked:l.has(t),onChange:()=>u(t),onClick:e=>e.stopPropagation(),className:"rounded border-neutral-300"})}),a.config.columns.map(t=>(0,n.jsx)("td",{className:"px-4 py-3 text-sm text-neutral-900 dark:text-neutral-100 ".concat(_(t.align)),children:x(e[t.key],t)},t.key))]},t))})]})}),a.config.pagination&&(0,n.jsx)("div",{className:"px-4 py-3 border-t border-neutral-200 dark:border-neutral-800",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:["Showing ",(o-1)*a.config.pagination.pageSize+1," to"," ",Math.min(o*a.config.pagination.pageSize,a.config.pagination.total||0)," of"," ",a.config.pagination.total||0," results"]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>c(e=>Math.max(1,e-1)),disabled:1===o,className:"px-3 py-1 text-sm border rounded disabled:opacity-50",children:"Previous"}),(0,n.jsxs)("span",{className:"px-3 py-1 text-sm",children:["Page ",o," of ",Math.ceil((a.config.pagination.total||0)/a.config.pagination.pageSize)]}),(0,n.jsx)("button",{onClick:()=>c(e=>e+1),disabled:o>=Math.ceil((a.config.pagination.total||0)/a.config.pagination.pageSize),className:"px-3 py-1 text-sm border rounded disabled:opacity-50",children:"Next"})]})]})})]})}function L(e){var t,a;let{block:s}=e,r=s.config;return r?(0,n.jsxs)("div",{className:"card p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-4",children:r.title||"Chart"}),o(r)?(0,n.jsx)("div",{className:"h-64 flex items-center justify-center bg-neutral-100 dark:bg-neutral-800 rounded-lg",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("div",{className:"text-lg font-medium text-neutral-700 dark:text-neutral-300",children:[r.chartType.toUpperCase()," Chart"]}),(0,n.jsxs)("div",{className:"text-sm text-neutral-500 mt-1",children:[r.series.length," series • ",(null===(t=r.series[0])||void 0===t?void 0:t.data.length)||0," data points"]}),(0,n.jsxs)("div",{className:"text-xs text-neutral-400 mt-2",children:["X: ",r.xField," • Y: ",r.yField]})]})}):c(r)?(0,n.jsx)("div",{className:"h-64 flex items-center justify-center bg-neutral-100 dark:bg-neutral-800 rounded-lg",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("div",{className:"text-lg font-medium text-neutral-700 dark:text-neutral-300",children:[r.chartType.toUpperCase()," Chart"]}),(0,n.jsxs)("div",{className:"text-sm text-neutral-500 mt-1",children:[(null===(a=r.data)||void 0===a?void 0:a.length)||0," segments"]}),(0,n.jsxs)("div",{className:"text-xs text-neutral-400 mt-2",children:["Label: ",r.labelField," • Value: ",r.valueField]})]})}):(0,n.jsx)("div",{className:"h-64 flex items-center justify-center bg-neutral-100 dark:bg-neutral-800 rounded-lg",children:(0,n.jsx)("div",{className:"text-neutral-500",children:"Unknown chart type"})}),o(r)&&r.series.length>1&&(0,n.jsx)("div",{className:"flex flex-wrap gap-4 mt-4 justify-center",children:r.series.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"hsl(".concat(60*t,", 70%, 50%)")}}),(0,n.jsx)("span",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:e.name})]},t))}),(0,n.jsx)("div",{className:"text-xs text-neutral-400 mt-4 text-center",children:"Chart component placeholder - integrate with your preferred charting library"})]}):(0,n.jsx)("div",{className:"card p-6",children:(0,n.jsx)("div",{className:"h-64 flex items-center justify-center bg-neutral-100 dark:bg-neutral-800 rounded-lg",children:(0,n.jsx)("div",{className:"text-neutral-500",children:"Chart configuration missing"})})})}function I(e){let{block:t}=e;return(0,n.jsx)("div",{className:"card p-6",children:(0,n.jsx)("div",{className:"space-y-4",children:t.items.map((e,a)=>(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center",children:(0,n.jsx)("div",{className:"w-4 h-4 text-blue-600 dark:text-blue-400",children:(0,n.jsx)("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4",children:(0,n.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"})})})}),a<t.items.length-1&&(0,n.jsx)("div",{className:"w-px h-8 bg-neutral-200 dark:bg-neutral-700 mt-2"})]}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium text-neutral-900 dark:text-neutral-100",children:e.title}),e.subtitle&&(0,n.jsx)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:e.subtitle})]}),(0,n.jsx)("time",{className:"text-xs text-neutral-500 dark:text-neutral-500 whitespace-nowrap ml-4",children:new Date(e.time).toLocaleString("en-KE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.meta&&(0,n.jsx)("div",{className:"mt-2 text-xs text-neutral-400",children:Object.entries(e.meta).map(e=>{let[t,a]=e;return(0,n.jsxs)("span",{className:"mr-3",children:[t,": ",String(a)]},t)})})]})]},a))})})}function A(e){let{block:t}=e;return(0,n.jsxs)("div",{className:"card p-8 text-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 mx-auto bg-neutral-100 dark:bg-neutral-800 rounded-full flex items-center justify-center mb-4",children:(0,n.jsx)("svg",{className:"w-8 h-8 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})})}),(0,n.jsx)("h3",{className:"text-lg font-medium text-neutral-900 dark:text-neutral-100 mb-2",children:t.title}),t.hint&&(0,n.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400",children:t.hint})]})}function M(e){let{block:t}=e;return(0,n.jsx)("div",{className:"card p-6 border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/10",children:(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)("div",{className:"w-6 h-6 text-red-500 flex-shrink-0",children:(0,n.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"w-6 h-6",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-red-900 dark:text-red-100 mb-1",children:t.title}),t.detail&&(0,n.jsx)("p",{className:"text-red-700 dark:text-red-300",children:t.detail})]})]})})}function F(e){let{block:t}=e,a=!!(t.expiresAt&&new Date(t.expiresAt)<new Date);return(0,n.jsx)("div",{className:"card p-4",children:(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:(0,n.jsx)("svg",{className:"w-6 h-6 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"font-medium text-neutral-900 dark:text-neutral-100",children:t.fileName}),t.expiresAt&&(0,n.jsxs)("p",{className:"text-sm text-neutral-500 dark:text-neutral-500",children:["Expires: ",new Date(t.expiresAt).toLocaleString()]})]}),(0,n.jsx)("button",{onClick:()=>{let e=document.createElement("a");e.href=t.endpoint,e.download=t.fileName,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)},disabled:a,className:"btn-primary disabled:opacity-50",children:a?"Expired":"Download"})]})})}function D(e){let{block:t}=e;return(0,n.jsx)("div",{className:"card p-6",children:(0,n.jsx)("div",{className:"space-y-4",children:t.items.map((e,t)=>{let a=function(e){let t={ok:{bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-700 dark:text-green-300",dot:"bg-green-500"},warning:{bg:"bg-yellow-100 dark:bg-yellow-900/30",text:"text-yellow-700 dark:text-yellow-300",dot:"bg-yellow-500"},error:{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-700 dark:text-red-300",dot:"bg-red-500"},unknown:{bg:"bg-gray-100 dark:bg-gray-800",text:"text-gray-700 dark:text-gray-300",dot:"bg-gray-500"}};return t[e]||t.unknown}(e.state);return(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-neutral-50 dark:bg-neutral-800/50",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(a.dot)}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium text-neutral-900 dark:text-neutral-100",children:e.label}),e.detail&&(0,n.jsx)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:e.detail})]})]}),(0,n.jsx)("div",{className:"px-2 py-1 rounded text-xs font-medium ".concat(a.bg," ").concat(a.text),children:e.state})]},t)})})})}let R=e=>{let{button:t,onAction:a}=e,[r,l]=(0,s.useState)(!1),i=async()=>{if(!t.disabled&&!r){l(!0);try{await a(t.action)}finally{l(!1)}}},o=["btn",{primary:"btn-primary",secondary:"btn-secondary",success:"btn-success",warning:"btn-warning",danger:"btn-danger",outline:"btn-outline"}[t.variant||"primary"]||"btn-primary",{sm:"btn-sm",md:"",lg:"btn-lg"}[t.size||"md"]||"",t.disabled&&"opacity-50 cursor-not-allowed",r&&"loading"].filter(Boolean).join(" ");return(0,n.jsxs)("button",{className:o,onClick:i,disabled:t.disabled||r,children:[t.icon&&(0,n.jsx)("span",{className:"mr-2",children:(0,n.jsx)("i",{className:"icon-".concat(t.icon)})}),r?"Loading...":t.label]})},T=e=>{let{block:t,onAction:a}=e;return(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)(R,{button:t.button,onAction:a})})},U=e=>{let{block:t,onAction:a}=e,s="vertical"===t.layout?"flex flex-col gap-2":"flex flex-wrap gap-2",r={left:"justify-start",center:"justify-center",right:"justify-end"}[t.align||"left"];return(0,n.jsx)("div",{className:"mb-4 ".concat(s," ").concat(r),children:t.buttons.map((e,t)=>(0,n.jsx)(R,{button:e,onAction:a},t))})},P=e=>{let{block:t,onAction:a}=e,[r,l]=(0,s.useState)(!1),[i,o]=(0,s.useState)(!1),c=async()=>{o(!0);try{await a(t.button.action),l(!1)}finally{o(!1)}};return(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)(R,{button:{...t.button,action:{type:"confirm",payload:{}}},onAction:()=>{l(!0)}}),r&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:t.button.dialog.title}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:t.button.dialog.message}),(0,n.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,n.jsx)("button",{className:"btn btn-secondary",onClick:()=>{l(!1)},disabled:i,children:t.button.dialog.cancelLabel||"Cancel"}),(0,n.jsx)("button",{className:"btn btn-".concat(t.button.dialog.confirmVariant||"primary"," ").concat(i?"loading":""),onClick:c,disabled:i,children:i?"Processing...":t.button.dialog.confirmLabel||"Confirm"})]})]})})]})},z=e=>{let{block:t,onAction:a}=e;return(0,n.jsxs)("div",{className:"mb-6",children:[t.title&&(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:t.title}),(0,n.jsx)("div",{className:"grid gap-4 ".concat({1:"grid-cols-1",2:"grid-cols-1 md:grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3"}[t.columns||1]||"grid-cols-1"),children:t.items.map((e,t)=>(0,n.jsxs)("div",{className:"card p-4 border rounded-lg",children:[(0,n.jsx)("div",{className:"flex items-start justify-between",children:(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[e.icon&&(0,n.jsx)("i",{className:"icon-".concat(e.icon," text-blue-500")}),(0,n.jsx)("h4",{className:"font-medium",children:e.title})]}),e.description&&(0,n.jsx)("p",{className:"text-gray-600 text-sm mb-3",children:e.description})]})}),(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsx)(R,{button:e.button,onAction:a})})]},t))})]})};var B=e=>{let{blocks:t,onAction:a=()=>{}}=e;return t&&0!==t.length?(0,n.jsx)("div",{className:"space-y-4",children:t.map((e,t)=>{let s="".concat(e.type,"-").concat(t);try{if(d(e))return(0,n.jsx)(T,{block:e,onAction:a},s);if(u(e))return(0,n.jsx)(U,{block:e,onAction:a},s);if(m(e))return(0,n.jsx)(P,{block:e,onAction:a},s);if(x(e))return(0,n.jsx)(z,{block:e,onAction:a},s);if(h(e))return(0,n.jsx)(N,{block:e},s);if(g(e))return(0,n.jsx)(S,{block:e,onAction:a},s);if(b(e))return(0,n.jsx)(E,{block:e,onAction:a},s);if(p(e))return(0,n.jsx)(L,{block:e},s);if(v(e))return(0,n.jsx)(I,{block:e},s);if(f(e))return(0,n.jsx)(A,{block:e},s);if(y(e))return(0,n.jsx)(M,{block:e},s);if(j(e))return(0,n.jsx)(F,{block:e},s);if(k(e))return(0,n.jsx)(D,{block:e},s);return console.warn("Unknown block type: ".concat(e.type)),(0,n.jsx)(M,{block:{type:"error",title:"Unknown Block Type",detail:'Block type "'.concat(e.type,'" is not supported.')}},s)}catch(t){return console.error("Error rendering block ".concat(e.type,":"),t),(0,n.jsx)(M,{block:{type:"error",title:"Block Rendering Error",detail:"Failed to render ".concat(e.type," block: ").concat(t instanceof Error?t.message:"Unknown error")}},s)}})}):null},W=e=>{let{messages:t,isLoading:a=!1,onAction:r}=e,l=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(t.length>0){var e;null===(e=l.current)||void 0===e||e.scrollIntoView({behavior:"instant"})}},[0===t.length?null:t.length]);let o=async e=>{if(console.log("Block action triggered:",e),r){await r(e);return}switch(e.type){case"query":console.log("Query action:",e.payload);break;case"route":e.target&&(window.location.href=e.target);break;case"download":if(e.endpoint){var t;let a=document.createElement("a");a.href=e.endpoint,(null===(t=e.payload)||void 0===t?void 0:t.filename)&&(a.download=e.payload.filename),document.body.appendChild(a),a.click(),document.body.removeChild(a)}break;case"mutation":if(e.endpoint)try{let t=await fetch(e.endpoint,{method:e.method||"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")),"X-School-ID":localStorage.getItem("schoolId")||""},body:e.payload?JSON.stringify(e.payload):void 0});if(!t.ok)throw Error("HTTP ".concat(t.status));console.log("Mutation successful")}catch(e){console.error("Mutation failed:",e)}break;default:console.warn("Unhandled action type:",e.type)}};return(0,n.jsx)("div",{className:"flex-1 overflow-y-auto px-4 py-4",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto",children:[t.map((e,a)=>{var s;let r="user"===e.role;t.length;let l=[];e.blocks&&e.blocks.length>0?l=e.blocks:(null===(s=e.response_data)||void 0===s?void 0:s.blocks)&&e.response_data.blocks.length>0&&(l=e.response_data.blocks);let c=e.id||"".concat(e.role,"-").concat(a);return(0,n.jsx)("div",{className:"mb-6 ".concat(r?"flex justify-end":""),children:(0,n.jsxs)("div",{className:"max-w-4xl ".concat(r?"w-fit max-w-2xl":"w-full"),children:[r?(0,n.jsx)("div",{className:"inline-block rounded-2xl px-4 py-2 text-white",style:{backgroundColor:"var(--color-brand)"},children:(0,n.jsx)("div",{className:"text-sm leading-relaxed",children:e.content})}):(0,n.jsxs)("div",{className:"space-y-4",children:[e.content&&(0,n.jsx)("div",{className:"prose prose-sm max-w-none",children:(0,n.jsx)(i.UG,{components:{h1:e=>{let{children:t}=e;return(0,n.jsx)("h1",{className:"text-xl font-semibold mb-3",children:t})},h2:e=>{let{children:t}=e;return(0,n.jsx)("h2",{className:"text-lg font-semibold mb-2",children:t})},h3:e=>{let{children:t}=e;return(0,n.jsx)("h3",{className:"text-base font-semibold mb-2",children:t})},p:e=>{let{children:t}=e;return(0,n.jsx)("p",{className:"mb-2 leading-relaxed",children:t})},strong:e=>{let{children:t}=e;return(0,n.jsx)("strong",{className:"font-semibold",children:t})},em:e=>{let{children:t}=e;return(0,n.jsx)("em",{className:"italic",children:t})},code:e=>{let{children:t}=e;return(0,n.jsx)("code",{className:"bg-gray-100 px-1 py-0.5 rounded text-sm font-mono",children:t})},ul:e=>{let{children:t}=e;return(0,n.jsx)("ul",{className:"list-disc list-inside mb-2 space-y-1",children:t})},ol:e=>{let{children:t}=e;return(0,n.jsx)("ol",{className:"list-decimal list-inside mb-2 space-y-1",children:t})},li:e=>{let{children:t}=e;return(0,n.jsx)("li",{className:"leading-relaxed",children:t})}},children:e.content})}),l.length>0&&(0,n.jsx)("div",{className:"space-y-4",children:(0,n.jsx)(B,{blocks:l,onAction:o})})]}),e.intent&&!r&&(0,n.jsxs)("div",{className:"text-xs text-gray-400 mt-1 text-left",children:["• ",e.intent]})]})},c)}),a&&(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)("div",{className:"max-w-4xl w-full",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-gray-500",children:[(0,n.jsxs)("div",{className:"flex space-x-1",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,n.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,n.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,n.jsx)("span",{className:"text-sm",children:"AI is thinking..."})]})})}),(0,n.jsx)("div",{ref:l})]})})};function V(e){let{onSend:t,busy:a}=e,[r,l]=(0,s.useState)(""),i=(0,s.useRef)(null),o=async()=>{var e;let n=r.trim();if(n&&!a){l("");try{await t(n)}catch(e){console.error("Error in ChatInput:",e)}null===(e=i.current)||void 0===e||e.focus()}},c=async e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),await o())};return(0,n.jsx)("div",{className:"pt-4 pb-6 bg-gradient-to-t from-neutral-100/60 via-neutral-50/20 to-transparent dark:from-neutral-950/60 dark:via-neutral-950/20",children:(0,n.jsxs)("div",{className:"mx-auto max-w-3xl px-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 rounded-full border border-neutral-300/60 bg-white/70 dark:border-neutral-700/60 dark:bg-neutral-900/70 px-4 py-3 shadow-[var(--shadow-soft)]",children:[(0,n.jsx)("span",{className:"text-neutral-400 dark:text-neutral-500",children:"⌕"}),(0,n.jsx)("input",{ref:i,value:r,onChange:e=>l(e.target.value),onKeyDown:c,placeholder:"ask anything… e.g., create class P4 East","aria-label":"Chat message",className:"w-full bg-transparent outline-none text-[15px]  text-neutral-900 dark:text-neutral-100 placeholder:text-neutral-400 dark:placeholder:text-neutral-500",disabled:a,maxLength:2e3}),(0,n.jsx)("button",{className:"rounded-full px-4 py-2 text-sm text-white bg-[--color-brand] hover:bg-[--color-brand-dark] transition disabled:opacity-60 disabled:cursor-not-allowed",style:{backgroundColor:"var(--color-brand)"},onMouseEnter:e=>{a||(e.currentTarget.style.backgroundColor="var(--color-brand-dark)")},onMouseLeave:e=>{a||(e.currentTarget.style.backgroundColor="var(--color-brand)")},onClick:o,disabled:a||!r.trim(),children:a?(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse"}),(0,n.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"0.2s"}}),(0,n.jsx)("div",{className:"w-2 h-2 bg-white rounded-full animate-pulse",style:{animationDelay:"0.4s"}})]}):"Send"})]}),r.length>1500&&(0,n.jsxs)("div",{className:"text-xs text-neutral-500 text-right mt-1",children:[r.length,"/2000"]})]})})}var O=a(2191);function q(){let{isAuthenticated:e}=(0,O.x)(),t=(0,r.useParams)(),a=(0,r.useRouter)(),i=t.chatId,[o,c]=(0,s.useState)(null),[d,u]=(0,s.useState)([]),[m,x]=(0,s.useState)(!1),[h,g]=(0,s.useState)(!0),[p,b]=(0,s.useState)(null),v=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),f=(0,s.useCallback)(async e=>{switch(e.type){case"query":e.payload&&"message"in e.payload&&await k(e.payload.message);break;case"route":if(e.target){let[t,n]=e.target.split(":");a.push("/".concat(t).concat(n?"/".concat(n):""))}break;case"download":e.endpoint&&window.open(e.endpoint,"_blank");break;case"mutation":e.endpoint&&console.log("Mutation action:",e);break;case"confirm":console.log("Confirm action:",e);break;default:console.warn("Unhandled action type:",e)}},[a]),y=(0,s.useCallback)(async()=>{if(!i||"new"===i){g(!1),c(null),u([]);let e=sessionStorage.getItem("chat-new-initial")||sessionStorage.getItem("chat-".concat(i,"-initial"));e&&(sessionStorage.removeItem("chat-new-initial"),sessionStorage.removeItem("chat-".concat(i,"-initial")),await k(e));return}if(!v(i)){g(!1),c(null),u([]);return}try{g(!0),b(null);let e=await l.A.getConversation(i);c(e),u(e.displayMessages)}catch(s){var e,t,n;if(console.error("Failed to load conversation:",s),(null==s?void 0:null===(e=s.response)||void 0===e?void 0:e.status)===404){a.replace("/chat/new");return}if((null==s?void 0:null===(t=s.response)||void 0===t?void 0:t.status)===401||(null==s?void 0:null===(n=s.response)||void 0===n?void 0:n.status)===403){let e=window.location.pathname+window.location.search;a.replace("/login?next=".concat(encodeURIComponent(e)));return}b("Failed to load conversation")}finally{g(!1)}},[i,a]);(0,s.useEffect)(()=>{e&&y()},[e,y]);let j=(0,s.useCallback)(e=>{let t={type:"conversation_updated",conversationId:e,timestamp:Date.now()};localStorage.setItem("chat_update_event",JSON.stringify(t)),setTimeout(()=>{localStorage.removeItem("chat_update_event")},100)},[]),k=async e=>{if(m)return;x(!0);let t={role:"user",content:e};u(e=>[...e,t]);try{let t=(null==o?void 0:o.id)||("new"!==i&&v(i)?i:void 0),n=await l.A.sendMessage(e,t),s={role:"assistant",content:n.response,blocks:n.blocks};if(u(e=>[...e,s]),!o&&n.conversation_id&&("new"===i||!v(i))){j(n.conversation_id),a.replace("/chat/".concat(n.conversation_id));return}if(n.conversation_id&&!o)try{let e=await l.A.getConversation(n.conversation_id);c(e),j(n.conversation_id)}catch(e){console.error("Failed to load new conversation:",e)}else(null==o?void 0:o.id)&&j(o.id)}catch(t){var n,s;if(console.error("Failed to send message:",t),(null==t?void 0:null===(n=t.response)||void 0===n?void 0:n.status)===401||(null==t?void 0:null===(s=t.response)||void 0===s?void 0:s.status)===403){let e=window.location.pathname+window.location.search;a.replace("/login?next=".concat(encodeURIComponent(e)));return}u(e=>e.slice(0,-1));let e={role:"assistant",content:"Sorry, I encountered an error processing your message. Please try again."};u(t=>[...t,e])}finally{x(!1)}};if((0,s.useEffect)(()=>{let e=e=>{if("chat_update_event"===e.key&&e.newValue)try{let t=JSON.parse(e.newValue);"conversation_updated"===t.type&&t.conversationId===i&&y()}catch(e){console.error("Error parsing storage event:",e)}};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[i,y]),!e)return null;if(h)return(0,n.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-neutral-600 dark:text-neutral-400",children:"Loading conversation..."})]})});if(p)return(0,n.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("p",{className:"text-red-600 dark:text-red-400 mb-4",children:p}),(0,n.jsxs)("div",{className:"space-x-2",children:[(0,n.jsx)("button",{onClick:()=>y(),className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Retry"}),(0,n.jsx)("button",{onClick:()=>a.push("/chat/new"),className:"px-4 py-2 bg-neutral-600 text-white rounded hover:bg-neutral-700",children:"New Chat"})]})]})});let N=(null==o?void 0:o.title)||"New Chat";return(0,n.jsxs)("div",{className:"h-full flex flex-col",children:[(0,n.jsx)("div",{className:"flex-none px-4 py-3 border-b border-neutral-200 dark:border-neutral-800",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-lg font-semibold",children:N}),(0,n.jsx)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:"Ask me anything about your school management"})]}),(0,n.jsx)("div",{className:"flex items-center gap-4"})]})}),(0,n.jsx)("div",{className:"flex-1 overflow-auto",children:(0,n.jsx)("div",{className:"max-w-4xl mx-auto px-4 py-4",children:0===d.length?(0,n.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,n.jsxs)("div",{className:"text-center py-10",children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-neutral-900 dark:text-neutral-100 mb-2",children:"Welcome to School Chat"}),(0,n.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400 mb-4",children:"I can help you manage students, classes, fees, and more. Try asking:"}),(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsx)("button",{onClick:()=>k("Show me school overview"),disabled:m,className:"block w-full bg-neutral-100 dark:bg-neutral-800 rounded-lg p-3 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors disabled:opacity-50",children:'"Show me school overview"'}),(0,n.jsx)("button",{onClick:()=>k("List all students"),disabled:m,className:"block w-full bg-neutral-100 dark:bg-neutral-800 rounded-lg p-3 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors disabled:opacity-50",children:'"List all students"'}),(0,n.jsx)("button",{onClick:()=>k("Create class P4 East"),disabled:m,className:"block w-full bg-neutral-100 dark:bg-neutral-800 rounded-lg p-3 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors disabled:opacity-50",children:'"Create class P4 East"'})]})]})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(W,{messages:d,onAction:f}),(0,n.jsx)("div",{className:"h-32"})]})})}),(0,n.jsx)("div",{className:"flex-none",children:(0,n.jsx)(V,{onSend:k,busy:m})})]})}},857:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return i},a:function(){return o}});var n=a(7437),s=a(2265),r=a(6463);let l=(0,s.createContext)({token:null,active_school_id:null,isLoading:!0,login:async()=>{},logout:()=>{},setSchoolId:()=>{},isAuthenticated:!1});function i(e){let{children:t}=e,[a,i]=(0,s.useState)({token:null,active_school_id:null,isLoading:!0}),o=(0,r.useRouter)();(0,s.useEffect)(()=>{i({token:localStorage.getItem("token"),active_school_id:localStorage.getItem("active_school_id"),isLoading:!1})},[]);let c=async e=>{localStorage.setItem("token",e.token),i(t=>({...t,token:e.token,isLoading:!1}))},d={...a,login:c,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),i({token:null,active_school_id:null,isLoading:!1}),o.replace("/login")},setSchoolId:e=>{localStorage.setItem("active_school_id",e),i(t=>({...t,active_school_id:e}))},isAuthenticated:!!a.token&&!a.isLoading};return(0,n.jsx)(l.Provider,{value:d,children:t})}let o=()=>(0,s.useContext)(l)},2191:function(e,t,a){"use strict";a.d(t,{x:function(){return l}});var n=a(2265),s=a(6463),r=a(857);function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/login",{token:t,isLoading:a}=(0,r.a)(),l=(0,s.useRouter)();return(0,n.useEffect)(()=>{if(!a&&!t){let t=window.location.pathname+window.location.search,a="".concat(e,"?next=").concat(encodeURIComponent(t));l.replace(a)}},[t,a,l,e]),{isAuthenticated:!!t&&!a,isLoading:a}}},459:function(e,t,a){"use strict";a.d(t,{h:function(){return r}});var n=a(8472),s=a(357);let r=n.Z.create({baseURL:s.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000",timeout:2e4});r.interceptors.request.use(e=>{let t=localStorage.getItem("token"),a=localStorage.getItem("active_school_id");return t&&(e.headers.Authorization="Bearer ".concat(t)),a&&(e.headers["X-School-ID"]=a),e}),r.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(console.error("Unauthorized request detected"),localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),window.location.href="/login"),Promise.reject(e)})},6195:function(e,t,a){"use strict";a.d(t,{A:function(){return l}});var n=a(459),s=a(6575);let r=e=>e.map(e=>{var t;let a="USER"===e.message_type?"user":"assistant";return{role:a,content:e.content,blocks:"assistant"===a&&(null===(t=e.response_data)||void 0===t?void 0:t.blocks)?e.response_data.blocks:void 0}}),l={async sendMessage(e,t,a){var r;let l=null!==(r=(0,s.rc)())&&void 0!==r?r:void 0;try{let{data:r}=await n.h.post("/api/chat/message",{message:e,conversation_id:t,context:a});return r.conversation_id&&(t?s.MN.messageSent(r.conversation_id,{message:e,response:r.response},l):s.MN.conversationCreated(r.conversation_id,{title:e.slice(0,50)},l)),r}catch(e){throw console.error("Failed to send message:",e),e}},async getSuggestions(){let{data:e}=await n.h.get("/api/chat/suggestions");return e},async getConversations(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{let{data:s}=await n.h.get("/api/chat/conversations",{params:{page:e,limit:t,include_archived:a}});return s}catch(e){throw console.error("Failed to get conversations:",e),e}},async getConversation(e){try{let{data:t}=await n.h.get("/api/chat/conversations/".concat(e)),a=r(t.messages||[]);return{...t,displayMessages:a}}catch(e){throw console.error("Failed to get conversation:",e),e}},async updateConversation(e,t){var a;let r=null!==(a=(0,s.rc)())&&void 0!==a?a:void 0;try{let{data:a}=await n.h.patch("/api/chat/conversations/".concat(e),t);return s.MN.conversationUpdated(e,t,r),a}catch(e){throw console.error("Failed to update conversation:",e),e}},async deleteConversation(e){var t;let a=null!==(t=(0,s.rc)())&&void 0!==t?t:void 0;try{await n.h.delete("/api/chat/conversations/".concat(e)),s.MN.conversationDeleted(e,a)}catch(e){throw console.error("Failed to delete conversation:",e),e}},async getRecentConversations(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{let{data:a}=await n.h.get("/api/chat/conversations/recent",{params:{days:e,limit:t}});return a}catch(e){throw console.error("Failed to get recent conversations:",e),e}},async searchConversations(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;try{let{data:a}=await n.h.get("/api/chat/conversations/search",{params:{q:e,limit:t}});return a}catch(e){throw console.error("Failed to search conversations:",e),e}},forceRefresh(){var e;let t=null!==(e=(0,s.rc)())&&void 0!==e?e:void 0;s.MN.forceRefresh(t)},async list(){return(await this.getConversations(1,50)).conversations.map(e=>({id:e.id,title:e.title,is_starred:!1,created_at:e.created_at,updated_at:e.last_activity}))},async get(e){let t=await this.getConversation(e);return{chat:{id:t.id,title:t.title,is_starred:!1},messages:t.displayMessages}},create:async()=>({id:"new",title:"New Chat",messages:[]}),async update(e,t){return t.title&&await this.updateConversation(e,{title:t.title}),{id:e,...t}},async delete(e){await this.deleteConversation(e)},star:async e=>(console.warn("Starring not implemented on backend yet"),{id:e,is_starred:!0}),unstar:async e=>(console.warn("Unstarring not implemented on backend yet"),{id:e,is_starred:!1}),async rename(e,t){return await this.updateConversation(e,{title:t})}}},6575:function(e,t,a){"use strict";a.d(t,{MN:function(){return s},rc:function(){return r}}),a(2265);class n{notifyListeners(e){let t=this.listeners.get(e.type)||[],a=this.listeners.get("*")||[];t.concat(a).forEach(t=>{try{t(e)}catch(e){console.error("Error in chat event listener:",e)}})}subscribe(e,t){return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t),()=>{let a=this.listeners.get(e)||[],n=a.indexOf(t);n>-1&&a.splice(n,1)}}broadcast(e,t,a,n){let s={type:e,conversationId:t,data:a,timestamp:Date.now(),userId:n};try{localStorage.setItem("chat_event",JSON.stringify(s)),this.lastEventTimestamp=s.timestamp,setTimeout(()=>{try{let e=localStorage.getItem("chat_event");e&&JSON.parse(e).timestamp===s.timestamp&&localStorage.removeItem("chat_event")}catch(e){}},100)}catch(e){console.error("Error broadcasting chat event:",e)}}conversationCreated(e,t,a){this.broadcast("conversation_created",e,t,a)}conversationUpdated(e,t,a){this.broadcast("conversation_updated",e,t,a)}conversationDeleted(e,t){this.broadcast("conversation_deleted",e,void 0,t)}messageSent(e,t,a){this.broadcast("message_sent",e,t,a)}forceRefresh(e){this.broadcast("force_refresh",void 0,void 0,e)}destroy(){window.removeEventListener("storage",this.handleStorageEvent),window.removeEventListener("focus",this.handleWindowFocus),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.listeners.clear()}constructor(){this.listeners=new Map,this.lastEventTimestamp=0,this.handleStorageEvent=e=>{if("chat_event"===e.key&&e.newValue)try{let t=JSON.parse(e.newValue);if(t.timestamp<=this.lastEventTimestamp)return;this.lastEventTimestamp=t.timestamp,this.notifyListeners(t)}catch(e){console.error("Error parsing chat event:",e)}},this.handleWindowFocus=()=>{this.broadcast("force_refresh")},this.handleVisibilityChange=()=>{document.hidden||this.broadcast("force_refresh")},window.addEventListener("storage",this.handleStorageEvent.bind(this)),window.addEventListener("focus",this.handleWindowFocus.bind(this)),document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this))}}let s=new n;function r(){try{let e=localStorage.getItem("token");if(!e)return null;return JSON.parse(atob(e.split(".")[1])).sub||null}catch(e){return null}}}},function(e){e.O(0,[236,731,971,23,744],function(){return e(e.s=9011)}),_N_E=e.O()}]);