(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[151],{9011:function(e,t,a){Promise.resolve().then(a.bind(a,7508))},7508:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return $}});var n=a(7437),s=a(2265),l=a(6463),r=a(6195),i=a(2731);let o=e=>"bar"===e.chartType||"line"===e.chartType||"area"===e.chartType,c=e=>"pie"===e.chartType||"donut"===e.chartType,d=e=>"button"===e.type,x=e=>"button_group"===e.type,u=e=>"confirmation"===e.type,m=e=>"action_panel"===e.type,h=e=>"text"===e.type,g=e=>"kpis"===e.type,p=e=>"chart"===e.type,b=e=>"table"===e.type,f=e=>"timeline"===e.type,v=e=>"empty"===e.type,j=e=>"error"===e.type,k=e=>"file_download"===e.type,y=e=>"status"===e.type;function w(e){let{block:t}=e,a=t.text.split("\n");return(0,n.jsx)("div",{className:"text-neutral-900 dark:text-neutral-100",children:a.map((e,t)=>(0,n.jsx)("div",{className:t>0?"mt-4":"",children:""===e.trim()?(0,n.jsx)("div",{className:"h-4"}):(0,n.jsx)("div",{className:"leading-relaxed",children:e.split(/(\*\*[^*]+\*\*|\*[^*]+\*|`[^`]+`)/g).map((e,t)=>{if(e.startsWith("**")&&e.endsWith("**")){let a=e.slice(2,-2);return(0,n.jsx)("strong",{children:a},t)}if(e.startsWith("*")&&e.endsWith("*")&&!e.startsWith("**")){let a=e.slice(1,-1);return(0,n.jsx)("em",{children:a},t)}if(e.startsWith("`")&&e.endsWith("`")){let a=e.slice(1,-1);return(0,n.jsx)("code",{className:"bg-neutral-100 dark:bg-neutral-800 px-1 py-0.5 rounded text-sm font-mono",children:a},t)}return(0,n.jsx)("span",{children:e},t)})})},t))})}function N(e,t){if("string"==typeof e)return e;switch(t){case"integer":return Math.round(e).toLocaleString();case"decimal":return e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});case"currency:KES":return new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES",minimumFractionDigits:0}).format(e);case"percent":return"".concat((100*e).toFixed(1),"%");case"date":return new Date(e).toLocaleDateString("en-KE");default:return e.toLocaleString()}}function C(e){let t={primary:{bg:"bg-blue-100 dark:bg-blue-900/30",text:"text-blue-700 dark:text-blue-300",badge:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300"},secondary:{bg:"bg-gray-100 dark:bg-gray-800",text:"text-gray-700 dark:text-gray-300",badge:"bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300"},success:{bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-700 dark:text-green-300",badge:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300"},warning:{bg:"bg-yellow-100 dark:bg-yellow-900/30",text:"text-yellow-700 dark:text-yellow-300",badge:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300"},danger:{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-700 dark:text-red-300",badge:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300"},info:{bg:"bg-cyan-100 dark:bg-cyan-900/30",text:"text-cyan-700 dark:text-cyan-300",badge:"bg-cyan-100 text-cyan-800 dark:bg-cyan-900/30 dark:text-cyan-300"}};return t[e]||t.primary}function S(e){switch(e){case"center":return"text-center";case"right":return"text-right";default:return"text-left"}}var _=a(3225),E=a(9162),I=a(8002);function A(e){var t;let{block:a,onAction:s}=e,l=e=>{e&&s&&s(e)},r=e=>{if(!e)return null;let t="w-4 h-4";switch(e){case"up":return(0,n.jsx)(_.Z,{className:"".concat(t," text-green-500")});case"down":return(0,n.jsx)(E.Z,{className:"".concat(t," text-red-500")});case"neutral":return(0,n.jsx)(I.Z,{className:"".concat(t," text-neutral-500")});default:return null}};return(0,n.jsx)("div",{className:"grid gap-3 sm:gap-4 ".concat(1===(t=a.items.length)?"grid-cols-1":2===t?"grid-cols-1 sm:grid-cols-2":3===t?"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3":4===t?"grid-cols-1 sm:grid-cols-2 lg:grid-cols-4":"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"),children:a.items.map((e,t)=>{let a=!!e.action,s=C(e.variant||"primary");return(0,n.jsxs)("div",{className:"\n              bg-white dark:bg-neutral-900 \n              border border-neutral-200 dark:border-neutral-700 \n              rounded-lg sm:rounded-xl p-4 sm:p-5\n              transition-all duration-200 shadow-sm hover:shadow-md\n              ".concat(a?"cursor-pointer hover:border-neutral-300 dark:hover:border-neutral-600 hover:scale-[1.02] active:scale-[0.98]":"","\n            "),onClick:()=>l(e.action),role:a?"button":void 0,tabIndex:a?0:void 0,onKeyDown:t=>{a&&("Enter"===t.key||" "===t.key)&&(t.preventDefault(),l(e.action))},children:[(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("p",{className:"text-xs sm:text-sm text-neutral-600 dark:text-neutral-400 mb-1 sm:mb-2 font-medium uppercase tracking-wide truncate",children:e.label}),(0,n.jsxs)("div",{className:"flex items-baseline gap-2 mb-2",children:[(0,n.jsx)("p",{className:"text-xl sm:text-2xl lg:text-3xl font-bold text-neutral-900 dark:text-neutral-100 leading-none",children:N(e.value,e.format)}),r(e.trend)]}),e.change&&(0,n.jsxs)("div",{className:"flex items-center gap-1 text-xs sm:text-sm",children:[(0,n.jsx)("span",{className:"\n                      font-medium\n                      ".concat(e.change.startsWith("+")||!e.change.startsWith("-")&&parseFloat(e.change)>0?"text-green-600 dark:text-green-400":e.change.startsWith("-")||0>parseFloat(e.change)?"text-red-600 dark:text-red-400":"text-neutral-600 dark:text-neutral-400","\n                    "),children:e.change}),(0,n.jsx)("span",{className:"text-neutral-500 dark:text-neutral-400",children:e.period||"vs last period"})]})]}),e.icon&&(0,n.jsx)("div",{className:"\n                  p-2 sm:p-2.5 rounded-lg sm:rounded-xl flex-shrink-0 ml-3\n                  ".concat(s.bg,"\n                "),children:(0,n.jsx)("div",{className:"w-4 h-4 sm:w-5 sm:h-5 ".concat(s.text),children:(0,n.jsx)("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"w-full h-full",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})})})})]}),e.subtitle&&(0,n.jsx)("p",{className:"text-xs sm:text-sm text-neutral-500 dark:text-neutral-400 mt-2 line-clamp-2",children:e.subtitle}),e.status&&(0,n.jsx)("div",{className:"mt-2 sm:mt-3",children:(0,n.jsx)("span",{className:"\n                  inline-flex px-2 py-1 rounded-full text-xs font-medium\n                  ".concat("good"===e.status||"up"===e.status?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bad"===e.status||"down"===e.status?"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300":"warning"===e.status?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300":"bg-neutral-100 text-neutral-800 dark:bg-neutral-800 dark:text-neutral-300","\n                "),children:e.status})}),void 0!==e.progress&&(0,n.jsxs)("div",{className:"mt-3",children:[(0,n.jsxs)("div",{className:"flex justify-between text-xs text-neutral-600 dark:text-neutral-400 mb-1",children:[(0,n.jsx)("span",{children:"Progress"}),(0,n.jsxs)("span",{children:[e.progress,"%"]})]}),(0,n.jsx)("div",{className:"w-full bg-neutral-200 dark:bg-neutral-700 rounded-full h-1.5 sm:h-2",children:(0,n.jsx)("div",{className:"h-full rounded-full transition-all duration-300 ".concat(s.bg.replace("bg-","bg-").replace("/30","")),style:{width:"".concat(Math.min(100,Math.max(0,e.progress)),"%")}})})]}),a&&(0,n.jsxs)("div",{className:"mt-2 sm:mt-3 text-xs text-neutral-400 dark:text-neutral-500 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,n.jsx)("span",{children:"Click for details"}),(0,n.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]},t)})})}var F=a(2421),M=a(7592);function L(e){var t;let{block:a,onAction:l}=e,[r,i]=(0,s.useState)(new Set),[o,c]=(0,s.useState)(1),[d,x]=(0,s.useState)(new Set),[u,m]=(0,s.useState)("table");(0,s.useState)(()=>{let e=()=>{m(window.innerWidth<768?"cards":"table")};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)});let h=(e,t)=>{e._action&&l&&l(e._action)},g=e=>{let t=new Set(r);t.has(e)?t.delete(e):t.add(e),i(t)},p=e=>{l&&l({...e,selectedRows:Array.from(r)})},b=e=>{let t=new Set(d);t.has(e)?t.delete(e):t.add(e),x(t)},f=(e,t)=>{if(t.format)return N(e,t.format);if(t.badge&&"string"==typeof e){let a=C(t.badge.map[e]||"primary");return(0,n.jsx)("span",{className:"inline-flex px-2 py-1 rounded-full text-xs font-medium ".concat(a.badge),children:e})}return e},v=(e,t)=>{if("string"==typeof e)return(0,n.jsx)("option",{value:e,children:e},e);{let a=e.value||e.id||"",s=e.label||e.name||a;return(0,n.jsx)("option",{value:a,children:s},"".concat(a,"-").concat(t))}},j=null===(t=a.config.actions)||void 0===t?void 0:t.some(e=>e.selectionRequired),k=()=>(0,n.jsx)("div",{className:"overflow-x-auto",children:(0,n.jsxs)("table",{className:"w-full",children:[(0,n.jsx)("thead",{className:"bg-neutral-50 dark:bg-neutral-800/50",children:(0,n.jsxs)("tr",{children:[j&&(0,n.jsx)("th",{className:"px-4 py-3 text-left",children:(0,n.jsx)("input",{type:"checkbox",onChange:e=>{e.target.checked?i(new Set(Array.from({length:a.config.rows.length},(e,t)=>t))):i(new Set)},className:"rounded border-neutral-300"})}),a.config.columns.map(e=>(0,n.jsx)("th",{className:"px-4 py-3 text-sm font-medium text-neutral-700 dark:text-neutral-300 ".concat(S(e.align)),style:{width:e.width},children:(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[e.label,e.sortable&&(0,n.jsx)("svg",{className:"w-4 h-4 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"})})]})},e.key))]})}),(0,n.jsx)("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-800",children:a.config.rows.map((e,t)=>(0,n.jsxs)("tr",{className:"\n                hover:bg-neutral-50 dark:hover:bg-neutral-800/50\n                ".concat(e._action?"cursor-pointer":"","\n                ").concat(r.has(t)?"bg-blue-50 dark:bg-blue-900/20":"","\n              "),onClick:()=>h(e,t),children:[j&&(0,n.jsx)("td",{className:"px-4 py-3",children:(0,n.jsx)("input",{type:"checkbox",checked:r.has(t),onChange:()=>g(t),onClick:e=>e.stopPropagation(),className:"rounded border-neutral-300"})}),a.config.columns.map(t=>(0,n.jsx)("td",{className:"px-4 py-3 text-sm text-neutral-900 dark:text-neutral-100 ".concat(S(t.align)),children:f(e[t.key],t)},t.key))]},t))})]})});return(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("div",{className:"p-3 sm:p-4 border-b border-neutral-200 dark:border-neutral-800",children:[(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-3",children:[(0,n.jsx)("h3",{className:"text-base sm:text-lg font-semibold text-neutral-900 dark:text-neutral-100",children:a.config.title}),a.config.actions&&a.config.actions.length>0&&(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:a.config.actions.map((e,t)=>(0,n.jsx)("button",{onClick:()=>p(e),disabled:e.selectionRequired&&0===r.size,className:"btn-primary disabled:opacity-50 text-xs sm:text-sm px-2 py-1 sm:px-3 sm:py-2",children:e.label},t))})]}),a.config.filters&&a.config.filters.length>0&&(0,n.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:flex lg:flex-wrap gap-3 mt-4",children:a.config.filters.map((e,t)=>{var a;return(0,n.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,n.jsx)("label",{className:"text-xs sm:text-sm font-medium text-neutral-700 dark:text-neutral-300",children:e.label}),"select"===e.type?(0,n.jsxs)("select",{className:"input text-sm min-w-0 sm:min-w-32",children:[(0,n.jsx)("option",{value:"",children:"All"}),null===(a=e.options)||void 0===a?void 0:a.map((e,t)=>v(e,t))]}):"daterange"===e.type?(0,n.jsx)("input",{type:"date",className:"input text-sm"}):(0,n.jsx)("input",{type:"text",className:"input text-sm",placeholder:"Filter ".concat(e.label)})]},t)})})]}),(0,n.jsx)("div",{className:"sm:hidden px-3 py-2 border-b border-neutral-200 dark:border-neutral-800",children:(0,n.jsxs)("div",{className:"flex gap-1 bg-neutral-100 dark:bg-neutral-800 rounded-lg p-1",children:[(0,n.jsx)("button",{onClick:()=>m("table"),className:"flex-1 px-3 py-1 rounded text-sm transition-colors ".concat("table"===u?"bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 shadow-sm":"text-neutral-600 dark:text-neutral-400"),children:"Table"}),(0,n.jsx)("button",{onClick:()=>m("cards"),className:"flex-1 px-3 py-1 rounded text-sm transition-colors ".concat("cards"===u?"bg-white dark:bg-neutral-700 text-neutral-900 dark:text-neutral-100 shadow-sm":"text-neutral-600 dark:text-neutral-400"),children:"Cards"})]})}),(0,n.jsx)("div",{className:"sm:hidden",children:"cards"===u?(0,n.jsx)("div",{className:"p-3",children:(0,n.jsx)("div",{className:"space-y-3",children:a.config.rows.map((e,t)=>{let s=d.has(t),l=a.config.columns.slice(0,2),i=a.config.columns.slice(2);return(0,n.jsx)("div",{className:"\n              border border-neutral-200 dark:border-neutral-700 rounded-lg p-3\n              ".concat(e._action?"cursor-pointer hover:bg-neutral-50 dark:hover:bg-neutral-800/50":"","\n              ").concat(r.has(t)?"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800":"","\n            "),onClick:()=>h(e,t),children:(0,n.jsxs)("div",{className:"flex items-start gap-3",children:[j&&(0,n.jsx)("input",{type:"checkbox",checked:r.has(t),onChange:()=>g(t),onClick:e=>e.stopPropagation(),className:"mt-0.5 rounded border-neutral-300"}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("div",{className:"space-y-1",children:l.map(t=>(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-xs text-neutral-500 dark:text-neutral-400 uppercase tracking-wide",children:t.label}),(0,n.jsx)("span",{className:"text-sm font-medium text-neutral-900 dark:text-neutral-100 ".concat(S(t.align)),children:f(e[t.key],t)})]},t.key))}),i.length>0&&(0,n.jsx)("button",{onClick:e=>{e.stopPropagation(),b(t)},className:"flex items-center gap-1 mt-2 text-xs text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200",children:s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(F.Z,{size:14}),"Show less"]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(M.Z,{size:14}),"Show more (",i.length," fields)"]})}),s&&i.length>0&&(0,n.jsx)("div",{className:"mt-3 pt-3 border-t border-neutral-200 dark:border-neutral-700 space-y-2",children:i.map(t=>(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("span",{className:"text-xs text-neutral-500 dark:text-neutral-400 uppercase tracking-wide",children:t.label}),(0,n.jsx)("span",{className:"text-sm text-neutral-700 dark:text-neutral-300 ".concat(S(t.align)),children:f(e[t.key],t)})]},t.key))})]})]})},t)})})}):k()}),(0,n.jsx)("div",{className:"hidden sm:block",children:k()}),a.config.pagination&&(0,n.jsx)("div",{className:"px-3 sm:px-4 py-3 border-t border-neutral-200 dark:border-neutral-800",children:(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:[(0,n.jsxs)("div",{className:"text-xs sm:text-sm text-neutral-700 dark:text-neutral-300 text-center sm:text-left",children:["Showing ",(o-1)*a.config.pagination.pageSize+1," to"," ",Math.min(o*a.config.pagination.pageSize,a.config.pagination.total||0)," of"," ",a.config.pagination.total||0," results"]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:()=>c(e=>Math.max(1,e-1)),disabled:1===o,className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50",children:"Previous"}),(0,n.jsxs)("span",{className:"px-2 sm:px-3 py-1 text-xs sm:text-sm",children:["Page ",o," of ",Math.ceil((a.config.pagination.total||0)/a.config.pagination.pageSize)]}),(0,n.jsx)("button",{onClick:()=>c(e=>e+1),disabled:o>=Math.ceil((a.config.pagination.total||0)/a.config.pagination.pageSize),className:"px-2 sm:px-3 py-1 text-xs sm:text-sm border rounded disabled:opacity-50",children:"Next"})]})]})})]})}function D(e){var t,a;let{block:s}=e,l=s.config;return l?(0,n.jsxs)("div",{className:"card p-6",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-4",children:l.title||"Chart"}),o(l)?(0,n.jsx)("div",{className:"h-64 flex items-center justify-center bg-neutral-100 dark:bg-neutral-800 rounded-lg",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("div",{className:"text-lg font-medium text-neutral-700 dark:text-neutral-300",children:[l.chartType.toUpperCase()," Chart"]}),(0,n.jsxs)("div",{className:"text-sm text-neutral-500 mt-1",children:[l.series.length," series • ",(null===(t=l.series[0])||void 0===t?void 0:t.data.length)||0," data points"]}),(0,n.jsxs)("div",{className:"text-xs text-neutral-400 mt-2",children:["X: ",l.xField," • Y: ",l.yField]})]})}):c(l)?(0,n.jsx)("div",{className:"h-64 flex items-center justify-center bg-neutral-100 dark:bg-neutral-800 rounded-lg",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("div",{className:"text-lg font-medium text-neutral-700 dark:text-neutral-300",children:[l.chartType.toUpperCase()," Chart"]}),(0,n.jsxs)("div",{className:"text-sm text-neutral-500 mt-1",children:[(null===(a=l.data)||void 0===a?void 0:a.length)||0," segments"]}),(0,n.jsxs)("div",{className:"text-xs text-neutral-400 mt-2",children:["Label: ",l.labelField," • Value: ",l.valueField]})]})}):(0,n.jsx)("div",{className:"h-64 flex items-center justify-center bg-neutral-100 dark:bg-neutral-800 rounded-lg",children:(0,n.jsx)("div",{className:"text-neutral-500",children:"Unknown chart type"})}),o(l)&&l.series.length>1&&(0,n.jsx)("div",{className:"flex flex-wrap gap-4 mt-4 justify-center",children:l.series.map((e,t)=>(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:"hsl(".concat(60*t,", 70%, 50%)")}}),(0,n.jsx)("span",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:e.name})]},t))}),(0,n.jsx)("div",{className:"text-xs text-neutral-400 mt-4 text-center",children:"Chart component placeholder - integrate with your preferred charting library"})]}):(0,n.jsx)("div",{className:"card p-6",children:(0,n.jsx)("div",{className:"h-64 flex items-center justify-center bg-neutral-100 dark:bg-neutral-800 rounded-lg",children:(0,n.jsx)("div",{className:"text-neutral-500",children:"Chart configuration missing"})})})}function T(e){let{block:t}=e;return(0,n.jsx)("div",{className:"card p-6",children:(0,n.jsx)("div",{className:"space-y-4",children:t.items.map((e,a)=>(0,n.jsxs)("div",{className:"flex gap-4",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center",children:[(0,n.jsx)("div",{className:"w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-full flex items-center justify-center",children:(0,n.jsx)("div",{className:"w-4 h-4 text-blue-600 dark:text-blue-400",children:(0,n.jsx)("svg",{viewBox:"0 0 20 20",fill:"currentColor",className:"w-4 h-4",children:(0,n.jsx)("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"})})})}),a<t.items.length-1&&(0,n.jsx)("div",{className:"w-px h-8 bg-neutral-200 dark:bg-neutral-700 mt-2"})]}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium text-neutral-900 dark:text-neutral-100",children:e.title}),e.subtitle&&(0,n.jsx)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:e.subtitle})]}),(0,n.jsx)("time",{className:"text-xs text-neutral-500 dark:text-neutral-500 whitespace-nowrap ml-4",children:new Date(e.time).toLocaleString("en-KE",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),e.meta&&(0,n.jsx)("div",{className:"mt-2 text-xs text-neutral-400",children:Object.entries(e.meta).map(e=>{let[t,a]=e;return(0,n.jsxs)("span",{className:"mr-3",children:[t,": ",String(a)]},t)})})]})]},a))})})}function P(e){let{block:t}=e;return(0,n.jsxs)("div",{className:"card p-8 text-center",children:[(0,n.jsx)("div",{className:"w-16 h-16 mx-auto bg-neutral-100 dark:bg-neutral-800 rounded-full flex items-center justify-center mb-4",children:(0,n.jsx)("svg",{className:"w-8 h-8 text-neutral-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})})}),(0,n.jsx)("h3",{className:"text-lg font-medium text-neutral-900 dark:text-neutral-100 mb-2",children:t.title}),t.hint&&(0,n.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400",children:t.hint})]})}function W(e){let{block:t}=e;return(0,n.jsx)("div",{className:"card p-6 border-red-200 dark:border-red-800 bg-red-50 dark:bg-red-900/10",children:(0,n.jsxs)("div",{className:"flex gap-3",children:[(0,n.jsx)("div",{className:"w-6 h-6 text-red-500 flex-shrink-0",children:(0,n.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"w-6 h-6",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"text-lg font-medium text-red-900 dark:text-red-100 mb-1",children:t.title}),t.detail&&(0,n.jsx)("p",{className:"text-red-700 dark:text-red-300",children:t.detail})]})]})})}function R(e){let{block:t}=e,a=!!(t.expiresAt&&new Date(t.expiresAt)<new Date);return(0,n.jsx)("div",{className:"card p-4",children:(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center",children:(0,n.jsx)("svg",{className:"w-6 h-6 text-blue-600 dark:text-blue-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"font-medium text-neutral-900 dark:text-neutral-100",children:t.fileName}),t.expiresAt&&(0,n.jsxs)("p",{className:"text-sm text-neutral-500 dark:text-neutral-500",children:["Expires: ",new Date(t.expiresAt).toLocaleString()]})]}),(0,n.jsx)("button",{onClick:()=>{let e=document.createElement("a");e.href=t.endpoint,e.download=t.fileName,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)},disabled:a,className:"btn-primary disabled:opacity-50",children:a?"Expired":"Download"})]})})}function z(e){let{block:t}=e;return(0,n.jsx)("div",{className:"card p-6",children:(0,n.jsx)("div",{className:"space-y-4",children:t.items.map((e,t)=>{let a=function(e){let t={ok:{bg:"bg-green-100 dark:bg-green-900/30",text:"text-green-700 dark:text-green-300",dot:"bg-green-500"},warning:{bg:"bg-yellow-100 dark:bg-yellow-900/30",text:"text-yellow-700 dark:text-yellow-300",dot:"bg-yellow-500"},error:{bg:"bg-red-100 dark:bg-red-900/30",text:"text-red-700 dark:text-red-300",dot:"bg-red-500"},unknown:{bg:"bg-gray-100 dark:bg-gray-800",text:"text-gray-700 dark:text-gray-300",dot:"bg-gray-500"}};return t[e]||t.unknown}(e.state);return(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-neutral-50 dark:bg-neutral-800/50",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(a.dot)}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium text-neutral-900 dark:text-neutral-100",children:e.label}),e.detail&&(0,n.jsx)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:e.detail})]})]}),(0,n.jsx)("div",{className:"px-2 py-1 rounded text-xs font-medium ".concat(a.bg," ").concat(a.text),children:e.state})]},t)})})})}let B=e=>{let{button:t,onAction:a}=e,[l,r]=(0,s.useState)(!1),i=async()=>{if(!t.disabled&&!l){r(!0);try{await a(t.action)}finally{r(!1)}}},o=["btn",{primary:"btn-primary",secondary:"btn-secondary",success:"btn-success",warning:"btn-warning",danger:"btn-danger",outline:"btn-outline"}[t.variant||"primary"]||"btn-primary",{sm:"btn-sm",md:"",lg:"btn-lg"}[t.size||"md"]||"",t.disabled&&"opacity-50 cursor-not-allowed",l&&"loading"].filter(Boolean).join(" ");return(0,n.jsxs)("button",{className:o,onClick:i,disabled:t.disabled||l,children:[t.icon&&(0,n.jsx)("span",{className:"mr-2",children:(0,n.jsx)("i",{className:"icon-".concat(t.icon)})}),l?"Loading...":t.label]})},U=e=>{let{block:t,onAction:a}=e;return(0,n.jsx)("div",{className:"mb-4",children:(0,n.jsx)(B,{button:t.button,onAction:a})})},O=e=>{let{block:t,onAction:a}=e,s="vertical"===t.layout?"flex flex-col gap-2":"flex flex-wrap gap-2",l={left:"justify-start",center:"justify-center",right:"justify-end"}[t.align||"left"];return(0,n.jsx)("div",{className:"mb-4 ".concat(s," ").concat(l),children:t.buttons.map((e,t)=>(0,n.jsx)(B,{button:e,onAction:a},t))})},H=e=>{let{block:t,onAction:a}=e,[l,r]=(0,s.useState)(!1),[i,o]=(0,s.useState)(!1),c=async()=>{o(!0);try{await a(t.button.action),r(!1)}finally{o(!1)}};return(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)(B,{button:{...t.button,action:{type:"confirm",payload:{}}},onAction:()=>{r(!0)}}),l&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,n.jsx)("h3",{className:"text-lg font-semibold mb-2",children:t.button.dialog.title}),(0,n.jsx)("p",{className:"text-gray-600 mb-6",children:t.button.dialog.message}),(0,n.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,n.jsx)("button",{className:"btn btn-secondary",onClick:()=>{r(!1)},disabled:i,children:t.button.dialog.cancelLabel||"Cancel"}),(0,n.jsx)("button",{className:"btn btn-".concat(t.button.dialog.confirmVariant||"primary"," ").concat(i?"loading":""),onClick:c,disabled:i,children:i?"Processing...":t.button.dialog.confirmLabel||"Confirm"})]})]})})]})},G=e=>{let{block:t,onAction:a}=e;return(0,n.jsxs)("div",{className:"mb-6",children:[t.title&&(0,n.jsx)("h3",{className:"text-lg font-semibold mb-4",children:t.title}),(0,n.jsx)("div",{className:"grid gap-4 ".concat({1:"grid-cols-1",2:"grid-cols-1 md:grid-cols-2",3:"grid-cols-1 md:grid-cols-2 lg:grid-cols-3"}[t.columns||1]||"grid-cols-1"),children:t.items.map((e,t)=>(0,n.jsxs)("div",{className:"card p-4 border rounded-lg",children:[(0,n.jsx)("div",{className:"flex items-start justify-between",children:(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[e.icon&&(0,n.jsx)("i",{className:"icon-".concat(e.icon," text-blue-500")}),(0,n.jsx)("h4",{className:"font-medium",children:e.title})]}),e.description&&(0,n.jsx)("p",{className:"text-gray-600 text-sm mb-3",children:e.description})]})}),(0,n.jsx)("div",{className:"mt-3",children:(0,n.jsx)(B,{button:e.button,onAction:a})})]},t))})]})};var V=e=>{let{blocks:t,onAction:a=()=>{}}=e;return t&&0!==t.length?(0,n.jsx)("div",{className:"space-y-4",children:t.map((e,t)=>{let s="".concat(e.type,"-").concat(t);try{if(d(e))return(0,n.jsx)(U,{block:e,onAction:a},s);if(x(e))return(0,n.jsx)(O,{block:e,onAction:a},s);if(u(e))return(0,n.jsx)(H,{block:e,onAction:a},s);if(m(e))return(0,n.jsx)(G,{block:e,onAction:a},s);if(h(e))return(0,n.jsx)(w,{block:e},s);if(g(e))return(0,n.jsx)(A,{block:e,onAction:a},s);if(b(e))return(0,n.jsx)(L,{block:e,onAction:a},s);if(p(e))return(0,n.jsx)(D,{block:e},s);if(f(e))return(0,n.jsx)(T,{block:e},s);if(v(e))return(0,n.jsx)(P,{block:e},s);if(j(e))return(0,n.jsx)(W,{block:e},s);if(k(e))return(0,n.jsx)(R,{block:e},s);if(y(e))return(0,n.jsx)(z,{block:e},s);return console.warn("Unknown block type: ".concat(e.type)),(0,n.jsx)(W,{block:{type:"error",title:"Unknown Block Type",detail:'Block type "'.concat(e.type,'" is not supported.')}},s)}catch(t){return console.error("Error rendering block ".concat(e.type,":"),t),(0,n.jsx)(W,{block:{type:"error",title:"Block Rendering Error",detail:"Failed to render ".concat(e.type," block: ").concat(t instanceof Error?t.message:"Unknown error")}},s)}})}):null};a(8604);var Z=a(2023),q=a(3787),K=a(7164),J=e=>{let{messages:t,isLoading:a=!1,onAction:l}=e,r=(0,s.useRef)(null),o=(0,s.useRef)(null),[c,d]=(0,s.useState)(!0),[x,u]=(0,s.useState)(null),m=(0,s.useRef)(t.length);(0,s.useEffect)(()=>{let e=t.length;if(c&&e>0)setTimeout(()=>{h(),d(!1)},100);else if(e>m.current&&!c){let e=t[t.length-1];(null==e?void 0:e.role)==="user"?(u(t.length-1),h()):(null==e?void 0:e.role)==="assistant"&&null!==x&&setTimeout(()=>{g(x),u(null)},150)}m.current=e},[t.length,c,x]);let h=()=>{let e=r.current;e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})},g=e=>{let t=r.current,a=o.current;if(!t||!a)return;let n=a.querySelector('[data-message-index="'.concat(e,'"]'));if(n){let e=document.querySelector("header"),a=e?e.getBoundingClientRect().height:60,s=n.getBoundingClientRect(),l=t.getBoundingClientRect(),r=t.scrollTop,i=s.top-l.top;t.scrollTo({top:Math.max(0,r+i-(a+16)),behavior:"smooth"})}},p=async e=>{if(console.log("Block action triggered:",e),l){await l(e);return}switch(e.type){case"query":console.log("Query action:",e.payload);break;case"route":e.target&&(window.location.href=e.target);break;case"download":if(e.endpoint){var t;let a=document.createElement("a");a.href=e.endpoint,(null===(t=e.payload)||void 0===t?void 0:t.filename)&&(a.download=e.payload.filename),document.body.appendChild(a),a.click(),document.body.removeChild(a)}break;case"mutation":if(e.endpoint)try{let t=await fetch(e.endpoint,{method:e.method||"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")),"X-School-ID":localStorage.getItem("schoolId")||""},body:e.payload?JSON.stringify(e.payload):void 0});if(!t.ok)throw Error("HTTP ".concat(t.status));console.log("Mutation successful")}catch(e){console.error("Mutation failed:",e)}break;default:console.warn("Unhandled action type:",e.type)}},b=e=>e.startsWith("image/"),f=e=>{let{attachments:t}=e,[a,l]=(0,s.useState)(null);if(!t||0===t.length)return null;let r=e=>{l(e)},i=()=>{l(null)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"flex flex-wrap gap-2 justify-end",children:t.map((e,t)=>(0,n.jsxs)("div",{className:"relative group cursor-pointer",onClick:()=>{b(e.content_type)?r(e.cloudinary_url):window.open(e.cloudinary_url,"_blank")},children:[b(e.content_type)?(0,n.jsx)("div",{className:"w-32 h-24 xs:w-40 xs:h-28 sm:w-48 sm:h-32 md:w-56 md:h-36 lg:w-64 lg:h-40 rounded-lg overflow-hidden border border-neutral-300 dark:border-neutral-600 hover:border-neutral-400 dark:hover:border-neutral-500 transition-colors",children:(0,n.jsx)("img",{src:e.cloudinary_url,alt:e.original_filename,className:"w-full h-full object-cover"})}):(0,n.jsxs)("div",{className:"w-24 h-24 xs:w-28 xs:h-28 sm:w-32 sm:h-32 md:w-36 md:h-36 lg:w-40 lg:h-40 rounded-lg bg-neutral-100 dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-600 hover:border-neutral-400 dark:hover:border-neutral-500 transition-colors flex flex-col items-center justify-center",children:[(0,n.jsx)(Z.Z,{size:24,className:"xs:w-6 xs:h-6 sm:w-8 sm:h-8 text-neutral-500 dark:text-neutral-400 mb-2"}),(0,n.jsx)("span",{className:"text-xs text-neutral-600 dark:text-neutral-400 font-medium",children:"application/pdf"===e.content_type?"PDF":"DOC"})]}),(0,n.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-all duration-200 rounded-lg flex items-center justify-center opacity-0 group-hover:opacity-100",children:(0,n.jsxs)("div",{className:"flex gap-1 xs:gap-2",children:[(0,n.jsx)("button",{onClick:t=>{t.stopPropagation(),b(e.content_type)?r(e.cloudinary_url):window.open(e.cloudinary_url,"_blank")},className:"p-1.5 xs:p-2 bg-white dark:bg-neutral-800 rounded-full shadow-lg hover:bg-neutral-50 dark:hover:bg-neutral-700 transition-colors",title:"View",children:(0,n.jsx)(q.Z,{size:12,className:"xs:w-3.5 xs:h-3.5 text-neutral-700 dark:text-neutral-300"})}),(0,n.jsx)("button",{onClick:t=>{t.stopPropagation();let a=document.createElement("a");a.href=e.cloudinary_url,a.download=e.original_filename,document.body.appendChild(a),a.click(),document.body.removeChild(a)},className:"p-1.5 xs:p-2 bg-white dark:bg-neutral-800 rounded-full shadow-lg hover:bg-neutral-50 dark:hover:bg-neutral-700 transition-colors",title:"Download",children:(0,n.jsx)(K.Z,{size:12,className:"xs:w-3.5 xs:h-3.5 text-neutral-700 dark:text-neutral-300"})})]})}),e.ocr_processed&&(0,n.jsx)("div",{className:"absolute top-1 right-1 xs:top-2 xs:right-2 w-1.5 h-1.5 xs:w-2 xs:h-2 bg-green-500 rounded-full shadow-sm",title:"OCR Processed"})]},e.attachment_id||t))}),a&&(0,n.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4",onClick:i,children:(0,n.jsxs)("div",{className:"relative max-w-full max-h-full w-full h-full flex items-center justify-center",children:[(0,n.jsx)("img",{src:a,alt:"Preview",className:"max-w-full max-h-full object-contain rounded-lg",onClick:e=>e.stopPropagation()}),(0,n.jsx)("button",{onClick:i,className:"absolute top-4 right-4 w-10 h-10 bg-black bg-opacity-50 hover:bg-opacity-75 text-white rounded-full flex items-center justify-center transition-colors",title:"Close",children:(0,n.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,n.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,n.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]})})]})};return(0,n.jsx)("div",{ref:r,className:"flex-1 overflow-y-auto overflow-x-hidden h-full",style:{height:"100%",maxHeight:"100%"},children:(0,n.jsx)("div",{ref:o,className:"min-h-full px-3 xs:px-4 sm:px-6 pt-4 pb-6 xs:pb-8 w-full",children:(0,n.jsxs)("div",{className:"max-w-4xl mx-auto w-full",children:[t.map((e,t)=>{var a,s,l,r,o;let c="user"===e.role;((null===(a=e.response_data)||void 0===a?void 0:a.attachments)||e.attachments)&&(console.log("=== MESSAGE WITH ATTACHMENTS DEBUG ==="),console.log("Message role:",e.role),console.log("Message content:",e.content),console.log("response_data:",e.response_data),console.log("response_data.attachments:",null===(s=e.response_data)||void 0===s?void 0:s.attachments),console.log("Direct attachments:",e.attachments),console.log("isUser:",c),console.log("Will show attachments:",c&&(null===(l=e.response_data)||void 0===l?void 0:l.attachments)),console.log("====================================="));let d=[];!c&&(e.blocks&&e.blocks.length>0?d=e.blocks:(null===(r=e.response_data)||void 0===r?void 0:r.blocks)&&e.response_data.blocks.length>0&&(d=e.response_data.blocks));let x=null;c&&((null===(o=e.response_data)||void 0===o?void 0:o.attachments)?x=e.response_data.attachments:e.attachments&&(x=e.attachments)),x&&console.log("Found attachments for display:",x.length,x);let u=e.id||"".concat(e.role,"-").concat(t);return(0,n.jsx)("div",{className:"mb-6 xs:mb-8 ".concat(c?"flex justify-end":""),"data-message-index":t,children:(0,n.jsxs)("div",{className:"w-full ".concat(c?"max-w-full xs:max-w-md sm:max-w-lg md:max-w-xl lg:max-w-2xl":"max-w-full"),children:[c?(0,n.jsx)("div",{className:"space-y-3 w-full",children:(0,n.jsxs)("div",{className:"flex flex-col items-end space-y-3 w-full",children:[x&&x.length>0&&(0,n.jsx)("div",{className:"flex justify-end w-full",children:(0,n.jsx)("div",{className:"max-w-full overflow-hidden",children:(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)(f,{attachments:x})})})}),(0,n.jsx)("div",{className:"inline-block rounded-2xl px-3 xs:px-4 py-2 xs:py-3 text-white max-w-full break-words",style:{backgroundColor:"var(--color-brand)"},children:(0,n.jsx)("div",{className:"text-sm xs:text-[15px] leading-relaxed",children:e.content})})]})}):(0,n.jsxs)("div",{className:"space-y-3 xs:space-y-4 w-full",children:[e.content&&(0,n.jsx)("div",{className:"prose prose-sm max-w-none text-neutral-900 dark:text-neutral-100 break-words",children:(0,n.jsx)(i.UG,{components:{h1:e=>{let{children:t}=e;return(0,n.jsx)("h1",{className:"text-lg xs:text-xl font-semibold mb-2 xs:mb-3 text-neutral-900 dark:text-neutral-100",children:t})},h2:e=>{let{children:t}=e;return(0,n.jsx)("h2",{className:"text-base xs:text-lg font-semibold mb-2 text-neutral-900 dark:text-neutral-100",children:t})},h3:e=>{let{children:t}=e;return(0,n.jsx)("h3",{className:"text-sm xs:text-base font-semibold mb-2 text-neutral-900 dark:text-neutral-100",children:t})},p:e=>{let{children:t}=e;return(0,n.jsx)("p",{className:"mb-2 leading-relaxed text-neutral-900 dark:text-neutral-100 break-words",children:t})},strong:e=>{let{children:t}=e;return(0,n.jsx)("strong",{className:"font-semibold text-neutral-900 dark:text-neutral-100",children:t})},em:e=>{let{children:t}=e;return(0,n.jsx)("em",{className:"italic text-neutral-900 dark:text-neutral-100",children:t})},code:e=>{let{children:t}=e;return(0,n.jsx)("code",{className:"bg-neutral-100 dark:bg-neutral-800 px-1 py-0.5 rounded text-xs xs:text-sm font-mono text-neutral-900 dark:text-neutral-100 break-all",children:t})},ul:e=>{let{children:t}=e;return(0,n.jsx)("ul",{className:"list-disc list-inside mb-2 space-y-1 text-neutral-900 dark:text-neutral-100 break-words",children:t})},ol:e=>{let{children:t}=e;return(0,n.jsx)("ol",{className:"list-decimal list-inside mb-2 space-y-1 text-neutral-900 dark:text-neutral-100 break-words",children:t})},li:e=>{let{children:t}=e;return(0,n.jsx)("li",{className:"leading-relaxed text-neutral-900 dark:text-neutral-100 break-words",children:t})}},children:e.content})}),d.length>0&&(0,n.jsx)("div",{className:"space-y-3 xs:space-y-4 w-full overflow-hidden",children:(0,n.jsx)(V,{blocks:d,onAction:p})})]}),e.intent&&!c&&(0,n.jsxs)("div",{className:"text-xs text-neutral-400 mt-2 text-left break-words",children:["• ",e.intent]})]})},u)}),a&&(0,n.jsx)("div",{className:"mb-4 xs:mb-6",children:(0,n.jsx)("div",{className:"max-w-4xl w-full",children:(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-neutral-500",children:[(0,n.jsxs)("div",{className:"flex space-x-1",children:[(0,n.jsx)("div",{className:"w-2 h-2 bg-neutral-400 rounded-full animate-bounce"}),(0,n.jsx)("div",{className:"w-2 h-2 bg-neutral-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,n.jsx)("div",{className:"w-2 h-2 bg-neutral-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,n.jsx)("span",{className:"text-xs xs:text-sm",children:"AI is thinking..."})]})})})]})})})},X=a(422),Q=a(2191),Y=a(1806);function $(){let{isAuthenticated:e}=(0,Q.x)(),t=(0,l.useParams)(),a=(0,l.useRouter)(),i=t.chatId,[o,c]=(0,s.useState)(null),[d,x]=(0,s.useState)([]),[u,m]=(0,s.useState)(!1),[h,g]=(0,s.useState)(!0),[p,b]=(0,s.useState)(null),f=e=>/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e),v=(0,s.useCallback)(async e=>{switch(e.type){case"query":e.payload&&"message"in e.payload&&await w(e.payload.message);break;case"route":if(e.target){let[t,n]=e.target.split(":");a.push("/".concat(t).concat(n?"/".concat(n):""))}break;case"download":e.endpoint&&window.open(e.endpoint,"_blank");break;case"mutation":e.endpoint&&console.log("Mutation action:",e);break;case"confirm":console.log("Confirm action:",e);break;default:console.warn("Unhandled action type:",e)}},[a]),j=(0,s.useCallback)(async()=>{if(!i||"new"===i){g(!1),c(null),x([]);let e=sessionStorage.getItem("chat-new-initial")||sessionStorage.getItem("chat-".concat(i,"-initial"));e&&(sessionStorage.removeItem("chat-new-initial"),sessionStorage.removeItem("chat-".concat(i,"-initial")),await w(e));return}if(!f(i)){g(!1),c(null),x([]);return}try{g(!0),b(null);let e=await r.A.getConversation(i);c(e),x(e.displayMessages)}catch(s){var e,t,n;if(console.error("Failed to load conversation:",s),(null==s?void 0:null===(e=s.response)||void 0===e?void 0:e.status)===404){a.replace("/chat/new");return}if((null==s?void 0:null===(t=s.response)||void 0===t?void 0:t.status)===401||(null==s?void 0:null===(n=s.response)||void 0===n?void 0:n.status)===403){let e=window.location.pathname+window.location.search;a.replace("/login?next=".concat(encodeURIComponent(e)));return}b("Failed to load conversation")}finally{g(!1)}},[i,a]);(0,s.useEffect)(()=>{e&&j()},[e,j]),(0,s.useEffect)(()=>{let e=(null==o?void 0:o.title)||"New Chat";return Y.U.send({type:"set",title:e,subtitle:"Ask me anything about your school management"}),()=>{Y.U.send({type:"clear"})}},[null==o?void 0:o.title]);let k=(0,s.useCallback)(e=>{let t={type:"conversation_updated",conversationId:e,timestamp:Date.now()};localStorage.setItem("chat_update_event",JSON.stringify(t)),setTimeout(()=>{localStorage.removeItem("chat_update_event")},100)},[]),y=(0,s.useCallback)(()=>(null==o?void 0:o.id)||("new"!==i&&f(i)?i:void 0),[o,i]),w=async e=>{var t,n,s;if(u)return;m(!0),console.log("=== SENDING TEXT MESSAGE ==="),console.log("Message:",e),console.log("Current conversation ID:",y());let l={role:"user",content:e};x(e=>[...e,l]);try{let n=y(),s=await r.A.sendMessage(e,n);console.log("Text message response:",{conversation_id:s.conversation_id,intent:s.intent,blocks_count:(null===(t=s.blocks)||void 0===t?void 0:t.length)||0});let l={role:"assistant",content:s.response,blocks:s.blocks};if(x(e=>[...e,l]),!o&&s.conversation_id&&("new"===i||!f(i))){console.log("New conversation created, redirecting to:",s.conversation_id),k(s.conversation_id),a.replace("/chat/".concat(s.conversation_id));return}if(s.conversation_id&&!o)try{let e=await r.A.getConversation(s.conversation_id);c(e),k(s.conversation_id)}catch(e){console.error("Failed to load new conversation:",e)}else(null==o?void 0:o.id)&&k(o.id)}catch(t){if(console.error("Failed to send message:",t),(null==t?void 0:null===(n=t.response)||void 0===n?void 0:n.status)===401||(null==t?void 0:null===(s=t.response)||void 0===s?void 0:s.status)===403){let e=window.location.pathname+window.location.search;a.replace("/login?next=".concat(encodeURIComponent(e)));return}x(e=>e.slice(0,-1));let e={role:"assistant",content:"Sorry, I encountered an error processing your message. Please try again."};x(t=>[...t,e])}finally{m(!1)}},N=async(e,t,n)=>{var s,l,d;if(u)return;m(!0),console.log("=== SENDING MESSAGE WITH FILES ==="),console.log("Message:",e),console.log("Files count:",t.length),console.log("Provided conversation ID:",n),console.log("Current conversation ID:",y());let h={role:"user",content:e};x(e=>[...e,h]);try{let l=n||y();console.log("Using conversation ID for files:",l);let d=await r.A.sendMessageWithFiles(e,t,l);console.log("File message response:",{conversation_id:d.conversation_id,intent:d.intent,attachment_processed:d.attachment_processed,blocks_count:(null===(s=d.blocks)||void 0===s?void 0:s.length)||0});let u={role:"assistant",content:d.response,blocks:d.blocks};if(x(e=>[...e,u]),!o&&d.conversation_id&&("new"===i||!f(i))){console.log("New conversation created with files, redirecting to:",d.conversation_id),k(d.conversation_id),a.replace("/chat/".concat(d.conversation_id));return}if(d.conversation_id&&!o)try{let e=await r.A.getConversation(d.conversation_id);c(e),k(d.conversation_id)}catch(e){console.error("Failed to load new conversation:",e)}else(null==o?void 0:o.id)&&k(o.id)}catch(t){if(console.error("Failed to send message with files:",t),(null==t?void 0:null===(l=t.response)||void 0===l?void 0:l.status)===401||(null==t?void 0:null===(d=t.response)||void 0===d?void 0:d.status)===403){let e=window.location.pathname+window.location.search;a.replace("/login?next=".concat(encodeURIComponent(e)));return}x(e=>e.slice(0,-1));let e={role:"assistant",content:"Sorry, I encountered an error processing your files. Please try again."};x(t=>[...t,e])}finally{m(!1)}},C=async e=>{if(console.log("=== FILE PROCESSING COMPLETE ==="),console.log("File processing complete for conversation:",e),console.log("Current chat ID:",i),console.log("Current conversation ID:",null==o?void 0:o.id),!o&&e&&("new"===i||!f(i))){console.log("Redirecting to new conversation:",e),k(e),a.replace("/chat/".concat(e));return}(e===(null==o?void 0:o.id)||e===i)&&(console.log("Reloading conversation:",e),await j(),k(e))};return((0,s.useEffect)(()=>{let e=e=>{if("chat_update_event"===e.key&&e.newValue)try{let t=JSON.parse(e.newValue);"conversation_updated"===t.type&&t.conversationId===i&&j()}catch(e){console.error("Error parsing storage event:",e)}};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[i,j]),e)?h?(0,n.jsx)("div",{className:"h-full flex items-center justify-center px-4",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,n.jsx)("p",{className:"mt-2 text-sm text-neutral-600 dark:text-neutral-400",children:"Loading conversation..."})]})}):p?(0,n.jsx)("div",{className:"h-full flex items-center justify-center px-4",children:(0,n.jsxs)("div",{className:"text-center max-w-sm",children:[(0,n.jsx)("p",{className:"text-red-600 dark:text-red-400 mb-4 text-sm",children:p}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 sm:flex-row sm:gap-3 justify-center",children:[(0,n.jsx)("button",{onClick:()=>j(),className:"px-4 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700",children:"Retry"}),(0,n.jsx)("button",{onClick:()=>a.push("/chat/new"),className:"px-4 py-2 bg-neutral-600 text-white rounded text-sm hover:bg-neutral-700",children:"New Chat"})]})]})}):(null==o||o.title,(0,n.jsxs)("div",{className:"h-full flex flex-col overflow-hidden",children:[0===d.length?(0,n.jsx)("div",{className:"flex-1 flex items-center justify-center px-3 sm:px-6 overflow-y-auto",children:(0,n.jsxs)("div",{className:"text-center py-6 sm:py-10 max-w-md mx-auto",children:[(0,n.jsx)("h3",{className:"text-base sm:text-lg font-medium text-neutral-900 dark:text-neutral-100 mb-2",children:"Welcome to School Chat"}),(0,n.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400 mb-4 text-sm sm:text-base",children:"I can help you manage students, classes, fees, and more. Try asking:"}),(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsx)("button",{onClick:()=>w("Show me school overview"),disabled:u,className:"block w-full bg-neutral-100 dark:bg-neutral-800 rounded-lg p-3 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors disabled:opacity-50 text-left",children:'"Show me school overview"'}),(0,n.jsx)("button",{onClick:()=>w("List all students"),disabled:u,className:"block w-full bg-neutral-100 dark:bg-neutral-800 rounded-lg p-3 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors disabled:opacity-50 text-left",children:'"List all students"'}),(0,n.jsx)("button",{onClick:()=>w("Create class P4 East"),disabled:u,className:"block w-full bg-neutral-100 dark:bg-neutral-800 rounded-lg p-3 hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors disabled:opacity-50 text-left",children:'"Create class P4 East"'})]})]})}):(0,n.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden",children:(0,n.jsx)(J,{messages:d,isLoading:u,onAction:v})}),(0,n.jsx)("div",{className:"flex-none",children:(0,n.jsx)(X.Z,{onSend:w,onSendWithFiles:N,onFileProcessingComplete:C,onNewMessage:e=>{var t;console.log("=== NEW MESSAGE FROM FILE PROCESSING ==="),console.log("New message received from file processing:",{conversation_id:e.conversation_id,intent:e.intent,response_preview:null===(t=e.response)||void 0===t?void 0:t.substring(0,100)})},busy:u,conversationId:y()})})]})):null}}},function(e){e.O(0,[236,48,845,728,581,422,971,23,744],function(){return e(e.s=9011)}),_N_E=e.O()}]);