(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[136],{8618:function(e,t,r){Promise.resolve().then(r.bind(r,2911))},2911:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return L}});var a=r(7437),s=r(2265),n=r(6463),i=r(6195),l=r(857),o=r(6575),c=r(7138),d=r(8030);let u=(0,d.Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),h=(0,d.Z)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);var v=r(6198);let m=(0,d.Z)("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);var f=r(6706);let p=(0,d.Z)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),x=(0,d.Z)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);var g=r(599);let b=(0,d.Z)("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]),y=(0,d.Z)("archive-restore",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h2",key:"tvwodi"}],["path",{d:"M20 8v11a2 2 0 0 1-2 2h-2",key:"1gkqxj"}],["path",{d:"m9 15 3-3 3 3",key:"1pd0qc"}],["path",{d:"M12 12v9",key:"192myk"}]]),w=(0,d.Z)("archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),k=(0,d.Z)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);var j=r(883);function N(e){let{chat:t,onUpdate:r,onDelete:n,forceVisible:l=!1}=e,[o,c]=(0,s.useState)(!1),[d,u]=(0,s.useState)(!1),[h,v]=(0,s.useState)(t.title),[m,f]=(0,s.useState)(!1),p=(0,s.useRef)(null),x=(0,s.useRef)(null);(0,s.useEffect)(()=>{function e(e){p.current&&!p.current.contains(e.target)&&c(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,s.useEffect)(()=>{d&&x.current&&(x.current.focus(),x.current.select())},[d]);let g=async e=>{if(e.preventDefault(),e.stopPropagation(),!m){f(!0);try{let e=await i.A.updateConversation(t.id,{is_archived:!t.is_archived});r(t.id,e)}catch(e){console.error("Failed to toggle archive:",e)}finally{f(!1),c(!1)}}},N=async e=>{if(e.preventDefault(),e.stopPropagation(),m)return;let a=h.trim();if(a&&a!==t.title){f(!0);try{let e=await i.A.updateConversation(t.id,{title:a});r(t.id,e)}catch(e){console.error("Failed to rename chat:",e),v(t.title)}finally{f(!1)}}u(!1)},_=()=>{v(t.title),u(!1)},C=async e=>{if(e.preventDefault(),e.stopPropagation(),!m){if(confirm('Are you sure you want to delete "'.concat(t.title,'"? This action cannot be undone.'))){f(!0);try{await i.A.deleteConversation(t.id),n(t.id)}catch(e){console.error("Failed to delete chat:",e)}finally{f(!1),c(!1)}}else c(!1)}};return d?(0,a.jsx)("form",{onSubmit:N,className:"flex-1 mr-2",children:(0,a.jsx)("input",{ref:x,type:"text",value:h,onChange:e=>v(e.target.value),onBlur:_,onKeyDown:e=>{"Escape"===e.key&&_()},className:"w-full px-2 py-1 text-sm bg-white dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:e=>e.stopPropagation(),disabled:m,maxLength:255})}):(0,a.jsxs)("div",{className:"relative",ref:p,children:[(0,a.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),c(!o)},className:"p-1 rounded-md hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-opacity disabled:opacity-50 ".concat(l?"opacity-100":"opacity-0 group-hover:opacity-100"),title:"Chat options",disabled:m,children:(0,a.jsx)(b,{size:16})}),o&&(0,a.jsxs)("div",{className:"absolute right-0 top-full mt-1 bg-white dark:bg-neutral-800 rounded-lg shadow-xl border border-neutral-200 dark:border-neutral-700 py-1 z-50 min-w-[160px]",children:[(0,a.jsx)("button",{onClick:g,disabled:m,className:"w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2 transition-colors disabled:opacity-50",children:t.is_archived?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y,{size:16}),"Unarchive"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w,{size:16}),"Archive"]})}),(0,a.jsxs)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),u(!0),c(!1)},disabled:m,className:"w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2 transition-colors disabled:opacity-50",children:[(0,a.jsx)(k,{size:16}),"Rename"]}),(0,a.jsxs)("button",{onClick:C,disabled:m,className:"w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2 text-red-600 dark:text-red-400 transition-colors disabled:opacity-50",children:[(0,a.jsx)(j.Z,{size:16}),"Delete"]})]})]})}function _(e){let{collapsed:t,onCollapse:r}=e,[d,b]=(0,s.useState)([]),[y,w]=(0,s.useState)(!1),[k,j]=(0,s.useState)(!0),[_,C]=(0,s.useState)(!1),[S,E]=(0,s.useState)(null),M=(0,s.useRef)(null),{token:I,logout:L,isAuthenticated:z}=(0,l.a)(),R=(0,n.usePathname)(),A=(0,n.useRouter)(),Z=(0,s.useMemo)(()=>{let e=R.match(/\/chat\/([^/]+)/);return e?e[1]:null},[R]),U=(0,s.useMemo)(()=>(function(e){if(!e)return null;try{var t;let r=null===(t=e.split(".")[1])||void 0===t?void 0:t.replace(/-/g,"+").replace(/_/g,"/"),a=atob(r);return JSON.parse(a)}catch(e){return null}})(I||void 0),[I]),F=null==U?void 0:U.full_name,D=null==U?void 0:U.email,P=null==U?void 0:U.active_school_id,T=F||D||"Guest",O=function(e,t){var r;let a=(e||"").trim();return a?a.split(/\s+/).slice(0,2).map(e=>{var t;return(null===(t=e[0])||void 0===t?void 0:t.toUpperCase())||""}).join("")||"U":t&&(null===(r=t[0])||void 0===r?void 0:r.toUpperCase())||"U"}(F,D);(0,s.useEffect)(()=>{function e(e){M.current&&!M.current.contains(e.target)&&w(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let V=(0,s.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(z)try{e?C(!0):j(!0),E(null);let t=(await i.A.getConversations(1,50,!1)).conversations.map(e=>({id:e.id,title:e.title,is_starred:!1,last_activity:e.last_activity,message_count:e.message_count,is_archived:e.is_archived}));b(t)}catch(e){console.error("Failed to load chats:",e),E("Failed to load chats"),b([])}finally{j(!1),C(!1)}},[z]);!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e4;(function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{onConversationCreated:r,onConversationUpdated:a,onConversationDeleted:n,onMessageSent:i,onForceRefresh:l,enableAutoRefresh:c=!0,refreshInterval:d=3e4}=t,u=null!==(e=(0,o.rc)())&&void 0!==e?e:void 0,h=(0,s.useRef)();(0,s.useEffect)(()=>{if(!c)return;let e=()=>{h.current=setTimeout(()=>{!document.hidden&&l&&l(),e()},d)};return e(),()=>{h.current&&clearTimeout(h.current)}},[c,d,l]),(0,s.useEffect)(()=>{let e=[],t=e=>!e||e!==u;return r&&e.push(o.MN.subscribe("conversation_created",e=>{t(e.userId)&&e.conversationId&&r(e.conversationId,e.data)})),a&&e.push(o.MN.subscribe("conversation_updated",e=>{t(e.userId)&&e.conversationId&&a(e.conversationId,e.data)})),n&&e.push(o.MN.subscribe("conversation_deleted",e=>{t(e.userId)&&e.conversationId&&n(e.conversationId)})),i&&e.push(o.MN.subscribe("message_sent",e=>{t(e.userId)&&e.conversationId&&i(e.conversationId,e.data)})),l&&e.push(o.MN.subscribe("force_refresh",e=>{t(e.userId)&&l()})),()=>{e.forEach(e=>e())}},[u,r,a,n,i,l]),(0,s.useCallback)(()=>{o.MN.forceRefresh(u)},[u]),(0,s.useCallback)((e,t)=>{o.MN.conversationCreated(e,t,u)},[u]),(0,s.useCallback)((e,t)=>{o.MN.conversationUpdated(e,t,u)},[u]),(0,s.useCallback)(e=>{o.MN.conversationDeleted(e,u)},[u]),(0,s.useCallback)((e,t)=>{o.MN.messageSent(e,t,u)},[u])})({onConversationCreated:e,onConversationUpdated:e,onConversationDeleted:e,onMessageSent:e,onForceRefresh:e,enableAutoRefresh:!0,refreshInterval:t})}((0,s.useCallback)(()=>V(!0),[V]),3e4),(0,s.useEffect)(()=>{V()},[V]),(0,s.useEffect)(()=>{if(R.includes("/chat/")&&Z&&"new"!==Z){let e=setTimeout(()=>V(!0),1e3);return()=>clearTimeout(e)}},[Z,V]),(0,s.useEffect)(()=>{if(!z)return;let e=setInterval(()=>{document.hidden||V(!0)},3e4);return()=>clearInterval(e)},[z,V]),(0,s.useEffect)(()=>{let e=()=>{z&&V(!0)},t=()=>{!document.hidden&&z&&V(!0)};return window.addEventListener("focus",e),document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("focus",e),document.removeEventListener("visibilitychange",t)}},[z,V]);let W=(e,t)=>{b(r=>r.map(r=>r.id===e?{...r,title:t.title||r.title,is_starred:void 0===t.is_archived&&r.is_starred,is_archived:void 0!==t.is_archived?t.is_archived:r.is_archived}:r).sort((e,t)=>e.is_starred!==t.is_starred?(t.is_starred?1:0)-(e.is_starred?1:0):new Date(t.last_activity).getTime()-new Date(e.last_activity).getTime()))},B=e=>{b(t=>t.filter(t=>t.id!==e)),Z===e&&A.replace("/chat/new")},q=()=>{V(!0)};return z?(0,a.jsxs)("aside",{className:"\n        border-r border-neutral-200/70 dark:border-white/10 \n        bg-white/70 dark:bg-neutral-900/60 backdrop-blur \n        flex flex-col h-full transition-all duration-300\n        ".concat(t?"w-[70px] cursor-pointer":"w-[260px]","\n      "),onClick:t?()=>r(!1):void 0,children:[(0,a.jsx)("div",{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"flex items-center",children:t?(0,a.jsx)(g.K7,{size:"sm"}):(0,a.jsx)(g.ZP,{size:"sm",href:"/"})}),!t&&(0,a.jsx)("div",{className:"flex items-center gap-1",children:(0,a.jsx)("button",{onClick:()=>r(!0),className:"p-1 rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-800",title:"Collapse sidebar",children:(0,a.jsx)(u,{size:18})})})]})}),(0,a.jsx)("div",{className:"p-3",onClick:t?e=>e.stopPropagation():void 0,children:(0,a.jsxs)("button",{className:"w-full rounded-xl py-2.5 px-3 flex items-center font-medium transition-colors duration-200 hover:bg-neutral-100 dark:hover:bg-neutral-800",style:{color:"var(--color-brand)"},onClick:()=>{A.push("/chat/new")},title:"New Chat",children:[(0,a.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0",style:{backgroundColor:"var(--color-brand)"},children:(0,a.jsx)(h,{size:14,className:"text-white"})}),!t&&(0,a.jsx)("div",{className:"ml-3 overflow-hidden",children:(0,a.jsx)("span",{className:"whitespace-nowrap block",children:"New Chat"})})]})}),P&&(0,a.jsx)("div",{className:"px-3 pb-3",onClick:t?e=>e.stopPropagation():void 0,children:(0,a.jsxs)(c.default,{href:"/school/".concat(P),className:"flex items-center px-3 py-2.5 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors text-neutral-700 dark:text-neutral-200",title:t?"My School":void 0,children:[(0,a.jsx)(v.Z,{size:18,className:"flex-shrink-0"}),!t&&(0,a.jsx)("div",{className:"ml-3 overflow-hidden",children:(0,a.jsx)("span",{className:"text-sm font-medium whitespace-nowrap block",children:"My School"})})]})}),!t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"px-3 py-2 flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-xs uppercase tracking-wide text-neutral-500 dark:text-neutral-400 font-medium",children:"Recents"}),(_||k)&&(0,a.jsx)("div",{className:"w-3 h-3 border border-neutral-300 dark:border-neutral-600 border-t-transparent rounded-full animate-spin"})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto px-2",children:(0,a.jsx)("div",{className:"space-y-1",children:k&&!_?(0,a.jsx)("div",{className:"px-3 py-2 text-sm text-neutral-500",children:"Loading chats..."}):S?(0,a.jsxs)("div",{className:"px-3 py-2 text-sm text-red-500",children:[S,(0,a.jsx)("button",{onClick:q,className:"block mt-1 text-xs text-blue-500 hover:underline",children:"Retry"})]}):0===d.length?(0,a.jsxs)("div",{className:"px-3 py-2 text-sm text-neutral-500",children:["No chats yet.",(0,a.jsx)("button",{onClick:q,className:"block mt-1 text-xs text-blue-500 hover:underline",children:"Refresh"})]}):d.map(e=>{let t=Z===e.id;return(0,a.jsxs)("div",{className:"\n                        group flex items-center rounded-lg transition-colors\n                        ".concat(t?"bg-neutral-200 dark:bg-neutral-700":"hover:bg-neutral-100 dark:hover:bg-neutral-800","\n                      "),children:[(0,a.jsxs)(c.default,{href:"/chat/".concat(e.id),className:"flex items-center flex-1 px-3 py-2.5 min-w-0",children:[e.is_starred&&(0,a.jsx)(m,{size:14,className:"mr-2 text-yellow-400 fill-yellow-400 flex-shrink-0"}),(0,a.jsx)("div",{className:"flex-1 min-w-0",children:(0,a.jsx)("span",{className:"block truncate text-sm text-neutral-700 dark:text-neutral-200",children:e.title})})]}),(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(N,{chat:{id:e.id,title:e.title,first_message:"",last_activity:e.last_activity,message_count:e.message_count,is_archived:e.is_archived,created_at:e.last_activity},onUpdate:(e,t)=>W(e,t),onDelete:B,forceVisible:t})})]},e.id)})})})]}),t&&(0,a.jsx)("div",{className:"flex-1"}),I&&(0,a.jsx)("div",{className:"border-t border-neutral-200/70 dark:border-white/10 p-3 mt-auto",onClick:t?e=>e.stopPropagation():void 0,children:(0,a.jsxs)("div",{className:"relative",ref:M,children:[(0,a.jsxs)("button",{onClick:()=>w(!y),className:"\n                w-full flex items-center gap-3 p-2 rounded-lg \n                hover:bg-neutral-100 dark:hover:bg-neutral-800 \n                transition-all duration-200 ease-out\n                ".concat(t?"justify-center":"","\n              "),title:t?"".concat(T).concat(D?" - ".concat(D):""):void 0,"aria-label":"User menu",children:[(0,a.jsx)("div",{className:" inline-flex h-8 w-8 items-center justify-center  rounded-full text-white font-semibold text-sm shadow-md hover:shadow-lg ring-2 ring-blue-500/20 dark:ring-blue-400/30 border border-blue-300/30 hover:scale-105 active:scale-95 transition-all duration-200 ease-out flex-shrink-0 ",style:{backgroundColor:"var(--color-brand)"},children:O}),!t&&(0,a.jsxs)("div",{className:"flex-1 text-left min-w-0",children:[(0,a.jsx)("div",{className:"text-sm font-medium truncate",children:T}),D&&(0,a.jsx)("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 truncate",children:D})]})]}),y&&(0,a.jsxs)("div",{className:"\n                  absolute bottom-full mb-2 bg-white dark:bg-neutral-900 rounded-lg \n                  shadow-xl border border-neutral-200 dark:border-neutral-700 py-1 z-50\n                  backdrop-blur-sm\n                  ".concat(t?"left-full ml-2 w-48":"left-0 right-0","\n                "),children:[t&&(0,a.jsxs)("div",{className:"px-3 py-2 border-b border-neutral-200 dark:border-neutral-700",children:[(0,a.jsx)("div",{className:"font-medium text-sm truncate",children:T}),D&&(0,a.jsx)("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 truncate",children:D})]}),(0,a.jsxs)("button",{onClick:()=>{w(!1),q()},className:"w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2 transition-colors",children:[(0,a.jsx)(f.Z,{size:16}),"Refresh Chats"]}),(0,a.jsxs)("button",{onClick:()=>{w(!1),A.push("/settings/profile")},className:"w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2 transition-colors",children:[(0,a.jsx)(p,{size:16}),"Settings"]}),(0,a.jsxs)("button",{onClick:()=>{L(),w(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2 text-red-600 dark:text-red-400 transition-colors",children:[(0,a.jsx)(x,{size:16}),"Logout"]})]})]})})]}):null}function C(e){let{open:t,width:r,onResize:n,onRequestClose:i}=e,[l,o]=(0,s.useState)(!1),c=(0,s.useRef)(0),d=(0,s.useRef)(r);return((0,s.useEffect)(()=>{d.current=r},[r]),(0,s.useEffect)(()=>{function e(e){if(!l)return;let t=c.current-e.clientX;n(Math.max(320,Math.min(800,d.current+t)))}function t(){o(!1)}return l&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[l,n]),t)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"absolute inset-0 z-[45]",onClick:i}),(0,a.jsxs)("div",{className:"relative z-[50] h-[calc(100svh-48px)] border-l border-neutral-200/70 dark:border-white/10 bg-white/80 dark:bg-neutral-900/70 backdrop-blur",style:{width:r},onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("div",{onMouseDown:e=>{o(!0),c.current=e.clientX},className:"absolute left-0 top-0 h-full w-1 cursor-col-resize bg-transparent",title:"Drag to resize",children:(0,a.jsx)("div",{className:"absolute left-[-2px] top-1/2 -translate-y-1/2 h-10 w-[3px] rounded-full bg-neutral-300/70 dark:bg-neutral-700/70"})}),(0,a.jsxs)("div",{className:"h-full overflow-auto p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,a.jsx)("div",{className:"font-medium",children:"Canvas"}),(0,a.jsx)("button",{onClick:i,className:"btn rounded-lg px-3 py-1.5 hover:bg-neutral-100 dark:hover:bg-neutral-800",children:"Close"})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("p",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:"This area can show context, notes, inspector panels, or AI tools. Use the shell’s “Show Canvas” button or call the bus:"}),(0,a.jsx)("pre",{className:"mt-3 rounded-xl bg-neutral-100 dark:bg-neutral-800 p-3 text-xs overflow-auto",children:"import { CanvasBus } from '@/components/layout/WorkspaceShell'\n\n// Open with a custom width\nCanvasBus.send({ type: 'open', width: 520 })\n\n// Toggle\nCanvasBus.send({ type: 'toggle' })\n"})]})]})]})]}):(0,a.jsx)("div",{style:{width:0}})}let S=new Set,E={send(e){S.forEach(t=>t(e))},on:e=>(S.add(e),()=>{S.delete(e)})};function M(e){let{children:t}=e,[r,n]=(0,s.useState)(!0);(0,s.useEffect)(()=>{let e=localStorage.getItem("sidebar_collapsed");null===e?localStorage.setItem("sidebar_collapsed","1"):n("1"===e)},[]);let[i,l]=(0,s.useState)(!1),[o,c]=(0,s.useState)(420);return(0,s.useEffect)(()=>{let e=localStorage.getItem("canvas_open"),t=localStorage.getItem("canvas_width");return e&&l("1"===e),t&&c(Math.max(320,Math.min(800,parseInt(t,10)||420))),E.on(e=>{"open"===e.type&&l(!0),"close"===e.type&&l(!1),"toggle"===e.type&&l(e=>!e),e.width&&c(Math.max(320,Math.min(800,e.width)))})},[]),(0,s.useEffect)(()=>{localStorage.setItem("canvas_open",i?"1":"0")},[i]),(0,s.useEffect)(()=>{localStorage.setItem("canvas_width",String(o))},[o]),(0,a.jsx)("div",{className:"h-svh w-full overflow-hidden",children:(0,a.jsxs)("div",{className:"relative flex overflow-hidden h-full",children:[(0,a.jsx)("div",{className:"relative z-10",children:(0,a.jsx)(_,{collapsed:r,onCollapse:n})}),(0,a.jsx)("div",{className:"flex-1 min-w-0 overflow-hidden",children:t}),(0,a.jsx)(C,{open:i,width:o,onResize:c,onRequestClose:()=>l(!1)})]})})}var I=r(2191);function L(e){let{children:t}=e,{isAuthenticated:r,isLoading:s}=(0,I.x)();return s?(0,a.jsx)("div",{className:"h-svh flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-neutral-500",children:"Loading..."})}):r?(0,a.jsx)(M,{children:t}):(0,a.jsx)("div",{className:"h-svh flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-neutral-500",children:"Redirecting to login..."})})}},599:function(e,t,r){"use strict";r.d(t,{K7:function(){return m},D2:function(){return v},ZP:function(){return h}});var a=r(7437),s=r(7138),n=r(4839);let i=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,l=n.W,o=(e,t)=>r=>{var a;if((null==t?void 0:t.variants)==null)return l(e,null==r?void 0:r.class,null==r?void 0:r.className);let{variants:s,defaultVariants:n}=t,o=Object.keys(s).map(e=>{let t=null==r?void 0:r[e],a=null==n?void 0:n[e];if(null===t)return null;let l=i(t)||i(a);return s[e][l]}),c=r&&Object.entries(r).reduce((e,t)=>{let[r,a]=t;return void 0===a||(e[r]=a),e},{});return l(e,o,null==t?void 0:null===(a=t.compoundVariants)||void 0===a?void 0:a.reduce((e,t)=>{let{class:r,className:a,...s}=t;return Object.entries(s).every(e=>{let[t,r]=e;return Array.isArray(r)?r.includes({...n,...c}[t]):({...n,...c})[t]===r})?[...e,r,a]:e},[]),null==r?void 0:r.class,null==r?void 0:r.className)},c=o("flex items-center gap-3",{variants:{size:{sm:"",md:"",lg:""}},defaultVariants:{size:"sm"}}),d=o("relative rounded-xl bg-gradient-to-br from-[#1f7daf] to-[#104f73] grid place-items-center text-white font-bold shadow-lg ring-2 ring-[#1f7daf]/20",{variants:{size:{sm:"h-9 w-9 text-lg",md:"h-12 w-12 text-xl",lg:"h-16 w-16 text-2xl"}},defaultVariants:{size:"sm"}}),u=o("font-semibold bg-gradient-to-r from-[#1f7daf] to-[#104f73] bg-clip-text text-transparent",{variants:{size:{sm:"text-xl",md:"text-2xl",lg:"text-3xl"}},defaultVariants:{size:"sm"}});function h(e){let{size:t="sm",href:r="/",className:i,showText:l=!0}=e,o=(0,a.jsxs)("div",{className:(0,n.Z)(c({size:t}),i),children:[(0,a.jsx)("div",{className:d({size:t}),children:(0,a.jsx)("span",{className:"drop-shadow-sm",children:"O"})}),l&&(0,a.jsx)("span",{className:u({size:t}),children:"Olaji"})]});return r?(0,a.jsx)(s.default,{href:r,children:o}):o}function v(e){let{className:t}=e;return(0,a.jsx)(h,{size:"sm",className:t})}function m(e){let{size:t="sm",className:r}=e;return(0,a.jsx)(h,{size:t,showText:!1,href:void 0,className:r})}},857:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return l},a:function(){return o}});var a=r(7437),s=r(2265),n=r(6463);let i=(0,s.createContext)({token:null,active_school_id:null,isLoading:!0,login:async()=>{},logout:()=>{},setSchoolId:()=>{},isAuthenticated:!1});function l(e){let{children:t}=e,[r,l]=(0,s.useState)({token:null,active_school_id:null,isLoading:!0}),o=(0,n.useRouter)();(0,s.useEffect)(()=>{l({token:localStorage.getItem("token"),active_school_id:localStorage.getItem("active_school_id"),isLoading:!1})},[]);let c=async e=>{localStorage.setItem("token",e.token),l(t=>({...t,token:e.token,isLoading:!1}))},d={...r,login:c,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),l({token:null,active_school_id:null,isLoading:!1}),o.replace("/login")},setSchoolId:e=>{localStorage.setItem("active_school_id",e),l(t=>({...t,active_school_id:e}))},isAuthenticated:!!r.token&&!r.isLoading};return(0,a.jsx)(i.Provider,{value:d,children:t})}let o=()=>(0,s.useContext)(i)},2191:function(e,t,r){"use strict";r.d(t,{x:function(){return i}});var a=r(2265),s=r(6463),n=r(857);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/login",{token:t,isLoading:r}=(0,n.a)(),i=(0,s.useRouter)();return(0,a.useEffect)(()=>{if(!r&&!t){let t=window.location.pathname+window.location.search,r="".concat(e,"?next=").concat(encodeURIComponent(t));i.replace(r)}},[t,r,i,e]),{isAuthenticated:!!t&&!r,isLoading:r}}},8030:function(e,t,r){"use strict";r.d(t,{Z:function(){return u}});var a=r(2265);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),i=e=>{let t=n(e);return t.charAt(0).toUpperCase()+t.slice(1)},l=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()},o=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:n=2,absoluteStrokeWidth:i,className:d="",children:u,iconNode:h,...v}=e;return(0,a.createElement)("svg",{ref:t,...c,width:s,height:s,stroke:r,strokeWidth:i?24*Number(n)/Number(s):n,className:l("lucide",d),...!u&&!o(v)&&{"aria-hidden":"true"},...v},[...h.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(u)?u:[u]])}),u=(e,t)=>{let r=(0,a.forwardRef)((r,n)=>{let{className:o,...c}=r;return(0,a.createElement)(d,{ref:n,iconNode:t,className:l("lucide-".concat(s(i(e))),"lucide-".concat(e),o),...c})});return r.displayName=i(e),r}},6198:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(8030).Z)("graduation-cap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]])},6706:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(8030).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},883:function(e,t,r){"use strict";r.d(t,{Z:function(){return a}});let a=(0,r(8030).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},459:function(e,t,r){"use strict";r.d(t,{h:function(){return n}});var a=r(8472),s=r(357);let n=a.Z.create({baseURL:s.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000",timeout:2e4});n.interceptors.request.use(e=>{let t=localStorage.getItem("token"),r=localStorage.getItem("active_school_id");return t&&(e.headers.Authorization="Bearer ".concat(t)),r&&(e.headers["X-School-ID"]=r),e}),n.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(console.error("Unauthorized request detected"),localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),window.location.href="/login"),Promise.reject(e)})},6195:function(e,t,r){"use strict";r.d(t,{A:function(){return i}});var a=r(459),s=r(6575);let n=e=>e.map(e=>{var t;let r="USER"===e.message_type?"user":"assistant";return{role:r,content:e.content,blocks:"assistant"===r&&(null===(t=e.response_data)||void 0===t?void 0:t.blocks)?e.response_data.blocks:void 0}}),i={async sendMessage(e,t,r){var n;let i=null!==(n=(0,s.rc)())&&void 0!==n?n:void 0;try{let{data:n}=await a.h.post("/api/chat/message",{message:e,conversation_id:t,context:r});return n.conversation_id&&(t?s.MN.messageSent(n.conversation_id,{message:e,response:n.response},i):s.MN.conversationCreated(n.conversation_id,{title:e.slice(0,50)},i)),n}catch(e){throw console.error("Failed to send message:",e),e}},async getSuggestions(){let{data:e}=await a.h.get("/api/chat/suggestions");return e},async getConversations(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{let{data:s}=await a.h.get("/api/chat/conversations",{params:{page:e,limit:t,include_archived:r}});return s}catch(e){throw console.error("Failed to get conversations:",e),e}},async getConversation(e){try{let{data:t}=await a.h.get("/api/chat/conversations/".concat(e)),r=n(t.messages||[]);return{...t,displayMessages:r}}catch(e){throw console.error("Failed to get conversation:",e),e}},async updateConversation(e,t){var r;let n=null!==(r=(0,s.rc)())&&void 0!==r?r:void 0;try{let{data:r}=await a.h.patch("/api/chat/conversations/".concat(e),t);return s.MN.conversationUpdated(e,t,n),r}catch(e){throw console.error("Failed to update conversation:",e),e}},async deleteConversation(e){var t;let r=null!==(t=(0,s.rc)())&&void 0!==t?t:void 0;try{await a.h.delete("/api/chat/conversations/".concat(e)),s.MN.conversationDeleted(e,r)}catch(e){throw console.error("Failed to delete conversation:",e),e}},async getRecentConversations(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;try{let{data:r}=await a.h.get("/api/chat/conversations/recent",{params:{days:e,limit:t}});return r}catch(e){throw console.error("Failed to get recent conversations:",e),e}},async searchConversations(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;try{let{data:r}=await a.h.get("/api/chat/conversations/search",{params:{q:e,limit:t}});return r}catch(e){throw console.error("Failed to search conversations:",e),e}},forceRefresh(){var e;let t=null!==(e=(0,s.rc)())&&void 0!==e?e:void 0;s.MN.forceRefresh(t)},async list(){return(await this.getConversations(1,50)).conversations.map(e=>({id:e.id,title:e.title,is_starred:!1,created_at:e.created_at,updated_at:e.last_activity}))},async get(e){let t=await this.getConversation(e);return{chat:{id:t.id,title:t.title,is_starred:!1},messages:t.displayMessages}},create:async()=>({id:"new",title:"New Chat",messages:[]}),async update(e,t){return t.title&&await this.updateConversation(e,{title:t.title}),{id:e,...t}},async delete(e){await this.deleteConversation(e)},star:async e=>(console.warn("Starring not implemented on backend yet"),{id:e,is_starred:!0}),unstar:async e=>(console.warn("Unstarring not implemented on backend yet"),{id:e,is_starred:!1}),async rename(e,t){return await this.updateConversation(e,{title:t})}}},6575:function(e,t,r){"use strict";r.d(t,{MN:function(){return s},rc:function(){return n}}),r(2265);class a{notifyListeners(e){let t=this.listeners.get(e.type)||[],r=this.listeners.get("*")||[];t.concat(r).forEach(t=>{try{t(e)}catch(e){console.error("Error in chat event listener:",e)}})}subscribe(e,t){return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t),()=>{let r=this.listeners.get(e)||[],a=r.indexOf(t);a>-1&&r.splice(a,1)}}broadcast(e,t,r,a){let s={type:e,conversationId:t,data:r,timestamp:Date.now(),userId:a};try{localStorage.setItem("chat_event",JSON.stringify(s)),this.lastEventTimestamp=s.timestamp,setTimeout(()=>{try{let e=localStorage.getItem("chat_event");e&&JSON.parse(e).timestamp===s.timestamp&&localStorage.removeItem("chat_event")}catch(e){}},100)}catch(e){console.error("Error broadcasting chat event:",e)}}conversationCreated(e,t,r){this.broadcast("conversation_created",e,t,r)}conversationUpdated(e,t,r){this.broadcast("conversation_updated",e,t,r)}conversationDeleted(e,t){this.broadcast("conversation_deleted",e,void 0,t)}messageSent(e,t,r){this.broadcast("message_sent",e,t,r)}forceRefresh(e){this.broadcast("force_refresh",void 0,void 0,e)}destroy(){window.removeEventListener("storage",this.handleStorageEvent),window.removeEventListener("focus",this.handleWindowFocus),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.listeners.clear()}constructor(){this.listeners=new Map,this.lastEventTimestamp=0,this.handleStorageEvent=e=>{if("chat_event"===e.key&&e.newValue)try{let t=JSON.parse(e.newValue);if(t.timestamp<=this.lastEventTimestamp)return;this.lastEventTimestamp=t.timestamp,this.notifyListeners(t)}catch(e){console.error("Error parsing chat event:",e)}},this.handleWindowFocus=()=>{this.broadcast("force_refresh")},this.handleVisibilityChange=()=>{document.hidden||this.broadcast("force_refresh")},window.addEventListener("storage",this.handleStorageEvent.bind(this)),window.addEventListener("focus",this.handleWindowFocus.bind(this)),document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this))}}let s=new a;function n(){try{let e=localStorage.getItem("token");if(!e)return null;return JSON.parse(atob(e.split(".")[1])).sub||null}catch(e){return null}}},4839:function(e,t,r){"use strict";function a(){for(var e,t,r=0,a="",s=arguments.length;r<s;r++)(e=arguments[r])&&(t=function e(t){var r,a,s="";if("string"==typeof t||"number"==typeof t)s+=t;else if("object"==typeof t){if(Array.isArray(t)){var n=t.length;for(r=0;r<n;r++)t[r]&&(a=e(t[r]))&&(s&&(s+=" "),s+=a)}else for(a in t)t[a]&&(s&&(s+=" "),s+=a)}return s}(e))&&(a&&(a+=" "),a+=t);return a}r.d(t,{W:function(){return a}}),t.Z=a}},function(e){e.O(0,[236,138,971,23,744],function(){return e(e.s=8618)}),_N_E=e.O()}]);