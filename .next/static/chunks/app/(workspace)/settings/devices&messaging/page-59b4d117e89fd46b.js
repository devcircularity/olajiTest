(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[71],{2548:function(e,t,r){Promise.resolve().then(r.bind(r,841))},841:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return S}});var s=r(7437),a=r(2265),n=r(857),l=r(6957),c=r(459);let o={async getStatus(){let{data:e}=await c.h.get("/api/whatsapp/status");return e},async initiateConnection(){try{console.log("=== INITIATING WHATSAPP CONNECTION ===");let{data:e}=await c.h.post("/api/whatsapp/connect");if(console.log("Connect response:",e),!e.success)throw Error(e.error||"Failed to initialize connection");console.log("Fetching QR code...");let{data:t}=await c.h.get("/api/whatsapp/qr");if(console.log("QR response:",t),t.success&&t.qr_code)return console.log("QR code received (length: ".concat(t.qr_code.length,")")),{qr_code:t.qr_code};if("already_connected"===t.status)return{error:"WhatsApp is already connected"};throw Error(t.message||"No QR code received")}catch(s){var e,t,r;throw console.error("=== CONNECTION INITIATION ERROR ==="),console.error("Error:",s),console.error("Response:",null===(e=s.response)||void 0===e?void 0:e.data),Error((null===(r=s.response)||void 0===r?void 0:null===(t=r.data)||void 0===t?void 0:t.detail)||s.message||"Failed to initiate connection")}},async getQRCode(){try{console.log("Getting QR code directly...");let{data:e}=await c.h.get("/api/whatsapp/qr");return console.log("QR response:",e),e}catch(e){throw console.error("QR fetch error:",e),e}},async checkConnection(){try{let{data:e}=await c.h.post("/api/whatsapp/check-connection");return e}catch(e){throw console.error("Connection check error:",e),e}},async disconnect(){await c.h.post("/api/whatsapp/disconnect")},async sendMessage(e,t,r){let s={phone_number:e,message:t,student_id:r};console.log("=== WHATSAPP API REQUEST ==="),console.log("URL: /api/whatsapp/send"),console.log("Data being sent:",s);try{let{data:e}=await c.h.post("/api/whatsapp/send",s);return console.log("=== WHATSAPP API SUCCESS ==="),console.log("Response data:",e),e}catch(e){var a,n;throw console.error("=== WHATSAPP API ERROR ==="),console.error("Request data that failed:",s),console.error("Error response:",null===(a=e.response)||void 0===a?void 0:a.data),console.error("Error status:",null===(n=e.response)||void 0===n?void 0:n.status),e}},async verifyNumber(e){let{data:t}=await c.h.get("/api/whatsapp/verify/".concat(encodeURIComponent(e)));return t},async sendBulkReminder(e){let{data:t}=await c.h.post("/api/whatsapp/bulk-reminder",e);return t},async getNotifications(){let{data:e}=await c.h.get("/api/whatsapp/notifications");return e},async getStats(){let{data:e}=await c.h.get("/api/whatsapp/stats");return e},async debugBridgeTest(){let{data:e}=await c.h.get("/api/whatsapp/debug/bridge-test");return e},async debugConnectionInfo(){let{data:e}=await c.h.get("/api/whatsapp/debug/connection-info");return e}};function i(e){var t;let{schoolId:r}=e,[n,l]=(0,a.useState)("disconnected"),[c,i]=(0,a.useState)(null),[h,x]=(0,a.useState)(null),[m,g]=(0,a.useState)(null),[p,v]=(0,a.useState)(null),b=(0,a.useRef)(null);(0,a.useEffect)(()=>{r&&f()},[r]),(0,a.useEffect)(()=>()=>{b.current&&clearInterval(b.current)},[]);let f=async()=>{try{console.log("Checking connection status...");let e=await o.getStatus();console.log("Status result:",e),e.connected&&e.ready?(l("connected"),y()):(e.status,l("disconnected"))}catch(e){console.error("Failed to check WhatsApp status:",e),l("error"),x("Failed to check connection status")}},y=async()=>{try{let e=await o.getStats();g(e)}catch(e){console.error("Failed to load WhatsApp stats:",e)}},k=async()=>{try{let e=await o.debugBridgeTest();v(e),console.log("Debug info:",e)}catch(e){console.error("Failed to load debug info:",e)}},j=async()=>{try{console.log("=== STARTING CONNECTION PROCESS ==="),l("connecting"),x(null),i(null),await k();let e=await o.initiateConnection();if(console.log("Initiation result:",e),e.error){if(e.error.includes("already connected")){await f();return}throw Error(e.error)}if(e.qr_code)console.log("QR code received (".concat(e.qr_code.length," characters)")),i(e.qr_code),l("scanning"),N();else throw Error("No QR code received from server")}catch(e){console.error("=== CONNECTION INITIATION FAILED ==="),console.error("Error:",e),l("error"),x(e.message||"Failed to initiate connection")}},N=()=>{console.log("Starting connection polling..."),b.current&&clearInterval(b.current),b.current=setInterval(async()=>{try{console.log("Polling connection status...");let e=await o.checkConnection();console.log("Poll result:",e),e.connected&&e.ready&&(console.log("Connection established!"),l("connected"),i(null),y(),b.current&&(clearInterval(b.current),b.current=null))}catch(e){console.error("Status poll failed:",e)}},3e3),setTimeout(()=>{b.current&&(clearInterval(b.current),b.current=null,"scanning"===n&&(l("error"),x("Connection timeout. QR code may have expired. Please try again."),i(null)))},12e4)},w=async()=>{try{x(null),console.log("Retrying QR code fetch...");let e=await o.getQRCode();if(console.log("QR retry result:",e),e.success&&e.qr_code)i(e.qr_code),l("scanning"),N();else throw Error(e.message||"Failed to get QR code")}catch(e){x(e.message||"Failed to retry QR code")}},S=async()=>{try{await o.disconnect(),l("disconnected"),g(null),i(null),x(null),b.current&&(clearInterval(b.current),b.current=null)}catch(e){x(e.message||"Failed to disconnect")}},_=async()=>{try{let e="+254714179051",t="Test message from School Management System - ".concat(new Date().toLocaleTimeString());console.log("=== SENDING TEST MESSAGE ==="),console.log("Phone:",e),console.log("Message:",t),console.log("School ID:",r);let s=await o.sendMessage(e,t);if(console.log("Result:",s),s.success)alert("Test message sent successfully!");else throw Error(s.error||"Message send failed")}catch(s){var e,t;console.error("=== TEST MESSAGE ERROR ==="),console.error("Error:",s);let r=(null===(t=s.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.detail)||s.message||"Unknown error";alert("Failed to send test message: ".concat(r))}};return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{className:"p-4 rounded-xl border ".concat(function(e){switch(e){case"connected":return"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800";case"scanning":case"connecting":return"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800";case"error":return"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800";default:return"bg-neutral-50 dark:bg-neutral-900/20 border-neutral-200 dark:border-neutral-700"}}(n)),children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center flex-shrink-0",children:(0,s.jsx)("svg",{className:"w-6 h-6 text-white",fill:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{d:"M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.890-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.486"})})}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("h4",{className:"font-medium text-neutral-900 dark:text-neutral-100",children:"WhatsApp Business Connection"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d,{status:n}),(0,s.jsx)("span",{className:"text-sm font-medium capitalize",children:"disconnected"===n?"Not Connected":n})]})]}),(0,s.jsx)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400 mb-4",children:"Connect your WhatsApp Business account to send automated notifications to parents"}),"connected"===n&&m&&(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-4 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"font-semibold text-green-800 dark:text-green-200",children:m.total_sent||0}),(0,s.jsx)("div",{className:"text-xs text-green-600 dark:text-green-300",children:"Messages Sent"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"font-semibold text-green-800 dark:text-green-200",children:(null===(t=m.by_type)||void 0===t?void 0:t.length)||0}),(0,s.jsx)("div",{className:"text-xs text-green-600 dark:text-green-300",children:"Message Types"})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"font-semibold text-green-800 dark:text-green-200",children:"Active"}),(0,s.jsx)("div",{className:"text-xs text-green-600 dark:text-green-300",children:"Status"})]})]}),h&&(0,s.jsxs)("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:[(0,s.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200",children:h}),"error"===n&&(0,s.jsx)("button",{onClick:w,className:"mt-2 text-sm text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-200 underline",children:"Retry QR Code"})]}),p&&(0,s.jsxs)("details",{className:"mb-4 p-3 bg-neutral-50 dark:bg-neutral-900/50 rounded-lg",children:[(0,s.jsx)("summary",{className:"text-sm font-medium text-neutral-700 dark:text-neutral-300 cursor-pointer",children:"Debug Information"}),(0,s.jsx)("pre",{className:"mt-2 text-xs text-neutral-600 dark:text-neutral-400 overflow-x-auto",children:JSON.stringify(p,null,2)})]})]})]})}),"scanning"===n&&c&&(0,s.jsxs)("div",{className:"text-center p-6 bg-white dark:bg-neutral-900 border-2 border-dashed border-neutral-300 dark:border-neutral-600 rounded-xl",children:[(0,s.jsx)("h4",{className:"font-medium text-neutral-900 dark:text-neutral-100 mb-4",children:"Scan QR Code with WhatsApp"}),(0,s.jsx)("div",{className:"inline-block p-4 bg-white rounded-xl shadow-lg",children:c.startsWith("data:image")?(0,s.jsx)("img",{src:c,alt:"WhatsApp QR Code",className:"w-64 h-64",onError:()=>{console.error("QR code image failed to load"),x("QR code image failed to load")}}):c.startsWith("<svg")?(0,s.jsx)("div",{dangerouslySetInnerHTML:{__html:c},className:"w-64 h-64 flex items-center justify-center"}):(0,s.jsx)("div",{className:"w-64 h-64 flex items-center justify-center bg-neutral-100 p-4 rounded",children:(0,s.jsxs)("div",{className:"text-xs font-mono break-all text-center text-neutral-700",children:["QR Code: ",c.substring(0,100),"..."]})})}),(0,s.jsxs)("div",{className:"mt-4 space-y-2 text-sm text-neutral-600 dark:text-neutral-400",children:[(0,s.jsx)("p",{children:"1. Open WhatsApp on your phone"}),(0,s.jsx)("p",{children:"2. Go to Settings → Linked Devices"}),(0,s.jsx)("p",{children:'3. Tap "Link a Device" and scan this code'})]}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-center gap-2 text-sm text-neutral-500",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-500"}),"Waiting for scan..."]})})]}),(0,s.jsxs)("div",{className:"flex gap-3",children:["disconnected"===n&&(0,s.jsx)("button",{onClick:j,className:"btn-primary",children:"Connect WhatsApp Web"}),"connecting"===n&&(0,s.jsx)("button",{disabled:!0,className:"btn-primary opacity-50 cursor-not-allowed",children:"Connecting..."}),"scanning"===n&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:w,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Refresh QR Code"}),(0,s.jsx)("button",{onClick:()=>{l("disconnected"),i(null),x(null),b.current&&(clearInterval(b.current),b.current=null)},className:"px-4 py-2 bg-neutral-200 dark:bg-neutral-700 text-neutral-700 dark:text-neutral-300 rounded-lg hover:bg-neutral-300 dark:hover:bg-neutral-600 transition-colors",children:"Cancel"})]}),"connected"===n&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:_,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:"Send Test Message"}),(0,s.jsx)("button",{onClick:S,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Disconnect"})]}),"error"===n&&(0,s.jsx)("button",{onClick:()=>{l("disconnected"),x(null),i(null)},className:"btn-primary",children:"Try Again"}),(0,s.jsx)("button",{onClick:k,className:"px-3 py-2 text-sm bg-neutral-100 dark:bg-neutral-800 text-neutral-600 dark:text-neutral-400 rounded-lg hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors",children:"Debug"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(u,{title:"Fee Reminders",description:"Automatically send payment reminders to parents via WhatsApp",enabled:"connected"===n}),(0,s.jsx)(u,{title:"Attendance Alerts",description:"Notify parents when students are absent or late",enabled:"connected"===n}),(0,s.jsx)(u,{title:"School Announcements",description:"Broadcast important school news and events to all parents",enabled:"connected"===n}),(0,s.jsx)(u,{title:"Report Cards",description:"Share student progress reports directly with parents",enabled:"connected"===n})]})]})}function d(e){let{status:t}=e;switch(t){case"connected":return(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"});case"scanning":case"connecting":return(0,s.jsx)("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"});case"error":return(0,s.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"});default:return(0,s.jsx)("div",{className:"w-2 h-2 bg-neutral-400 rounded-full"})}}function u(e){let{title:t,description:r,enabled:a}=e;return(0,s.jsxs)("div",{className:"p-4 border border-neutral-200 dark:border-neutral-700 rounded-xl ".concat(a?"":"opacity-50"),children:[(0,s.jsxs)("h4",{className:"font-medium text-neutral-900 dark:text-neutral-100 mb-2 flex items-center gap-2",children:[t,!a&&(0,s.jsx)("span",{className:"text-xs bg-neutral-200 dark:bg-neutral-700 px-2 py-1 rounded",children:"Requires Connection"})]}),(0,s.jsx)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:r})]})}o.sendMessage,o.getStatus,o.sendBulkReminder;var h=r(1010),x=r(8030);let m=(0,x.Z)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var g=r(6127);let p=(0,x.Z)("circle-x",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var v=r(6706);let b=(0,x.Z)("smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),f=(0,x.Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),y=(0,x.Z)("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),k=(0,x.Z)("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),j=(0,x.Z)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);var N=r(883);function w(e){let{schoolId:t}=e,[r,n]=(0,a.useState)([]),[l,c]=(0,a.useState)(0),[o,i]=(0,a.useState)(0),[d,u]=(0,a.useState)(0),[x,w]=(0,a.useState)(!0),[S,_]=(0,a.useState)(!1),[M,I]=(0,a.useState)(null),C=async()=>{try{let e=await h.Yu.getMobileDevices(t);n(e.devices),c(e.total_count),i(e.connected_count),u(e.healthy_count),I(null)}catch(e){console.error("Failed to load mobile devices:",e),I("Failed to load device status")}},R=async()=>{_(!0),await C(),_(!1)},A=async e=>{try{await h.Yu.removeMobileDevice(t,e),await C()}catch(e){console.error("Failed to remove device:",e)}};(0,a.useEffect)(()=>{let e=async()=>{w(!0),await C(),w(!1)};if(t){e();let t=setInterval(C,12e4);return()=>clearInterval(t)}},[t]);let E=e=>{switch(e.status_summary){case"connected":return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200 rounded-full",children:[(0,s.jsx)(m,{size:12}),"Connected"]});case"issues":return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200 rounded-full",children:[(0,s.jsx)(g.Z,{size:12}),"Issues"]});case"offline":return(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 px-2 py-1 text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 rounded-full",children:[(0,s.jsx)(p,{size:12}),"Offline"]})}},T=e=>{let t=[];return e.notification_access||t.push("Notification access disabled"),e.sms_permission||t.push("SMS permission missing"),e.listener_connected||t.push("Listener disconnected"),!e.last_forward_ok&&e.last_error&&t.push("Last forward failed: ".concat(e.last_error)),e.is_online||t.push("No heartbeat in last 5 minutes"),t},z=e=>{let t=new Date(e),r=Math.floor((new Date().getTime()-t.getTime())/6e4);return r<1?"Just now":r<60?"".concat(r,"m ago"):r<1440?"".concat(Math.floor(r/60),"h ago"):"".concat(Math.floor(r/1440),"d ago")};return t?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-neutral-900 dark:text-neutral-100",children:"SMS Forwarder Devices"}),(0,s.jsxs)("button",{onClick:R,disabled:S,className:"inline-flex items-center gap-2 px-3 py-1.5 text-sm font-medium text-neutral-600 dark:text-neutral-400 hover:text-neutral-900 dark:hover:text-neutral-100 border border-neutral-200 dark:border-neutral-700 rounded-lg hover:bg-neutral-50 dark:hover:bg-neutral-800 transition-colors disabled:opacity-50",children:[(0,s.jsx)(v.Z,{size:14,className:S?"animate-spin":""}),S?"Refreshing...":"Refresh"]})]}),x?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-neutral-600 dark:text-neutral-400",children:"Loading device status..."})]}):M?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("p",{className:"text-red-600 dark:text-red-400",children:M}),(0,s.jsx)("button",{onClick:R,className:"mt-2 text-sm text-blue-600 dark:text-blue-400 hover:underline",children:"Try again"})]}):0===r.length?(0,s.jsxs)("div",{className:"text-center py-8 border-2 border-dashed border-neutral-200 dark:border-neutral-700 rounded-xl",children:[(0,s.jsx)(b,{size:48,className:"mx-auto text-neutral-400 mb-4"}),(0,s.jsx)("h4",{className:"font-medium text-neutral-900 dark:text-neutral-100 mb-2",children:"No mobile devices connected"}),(0,s.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400 max-w-md mx-auto",children:"Install the Olaji Helper Android app and log in to see your SMS forwarder devices here."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6",children:[(0,s.jsx)("div",{className:"bg-neutral-50 dark:bg-neutral-900 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-neutral-600 dark:text-neutral-400",children:"Total Devices"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-neutral-900 dark:text-neutral-100",children:l})]}),(0,s.jsx)(b,{size:24,className:"text-neutral-400"})]})}),(0,s.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-green-600 dark:text-green-400",children:"Connected"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:d})]}),(0,s.jsx)(m,{size:24,className:"text-green-500"})]})}),(0,s.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-yellow-600 dark:text-yellow-400",children:"With Issues"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:l-d})]}),(0,s.jsx)(g.Z,{size:24,className:"text-yellow-500"})]})})]}),(0,s.jsx)("div",{className:"space-y-3",children:r.map(e=>{let t=T(e);return(0,s.jsx)("div",{className:"border border-neutral-200 dark:border-neutral-700 rounded-xl p-4 hover:border-neutral-300 dark:hover:border-neutral-600 transition-colors",children:(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"p-2 bg-neutral-100 dark:bg-neutral-800 rounded-lg",children:(0,s.jsx)(b,{size:20,className:"text-neutral-600 dark:text-neutral-400"})}),(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,s.jsx)("h4",{className:"font-medium text-neutral-900 dark:text-neutral-100",children:e.device_model||e.device_id}),E(e)]}),(0,s.jsxs)("div",{className:"flex items-center gap-4 text-sm text-neutral-600 dark:text-neutral-400 mb-2",children:[(0,s.jsxs)("span",{children:["ID: ",e.device_id]}),e.app_version&&(0,s.jsxs)("span",{children:["v",e.app_version]}),(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(f,{size:12}),"Last seen ",z(e.last_heartbeat_at)]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 text-xs mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 ".concat(e.notification_access?"text-green-600":"text-red-600"),children:[e.notification_access?(0,s.jsx)(m,{size:12}):(0,s.jsx)(p,{size:12}),"Notifications"]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 ".concat(e.sms_permission?"text-green-600":"text-red-600"),children:[e.sms_permission?(0,s.jsx)(m,{size:12}):(0,s.jsx)(p,{size:12}),"SMS"]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 ".concat(e.listener_connected?"text-green-600":"text-red-600"),children:[e.listener_connected?(0,s.jsx)(y,{size:12}):(0,s.jsx)(k,{size:12}),"Listener"]}),e.last_sms_received_at&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-blue-600",children:[(0,s.jsx)(j,{size:12}),"Last SMS ",z(e.last_sms_received_at)]})]}),t.length>0&&(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsx)("ul",{className:"text-sm text-red-600 dark:text-red-400 space-y-1",children:t.map((e,t)=>(0,s.jsxs)("li",{className:"flex items-center gap-1",children:[(0,s.jsx)("span",{className:"w-1 h-1 bg-red-500 rounded-full flex-shrink-0"}),e]},t))})})]})]}),(0,s.jsx)("button",{onClick:()=>A(e.device_id),className:"p-1.5 text-neutral-400 hover:text-red-600 dark:hover:text-red-400 rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors",title:"Remove device",children:(0,s.jsx)(N.Z,{size:16})})]})},e.device_id)})})]}),(0,s.jsx)("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 mt-4",children:'Device status updates automatically every 2 minutes. Devices are considered "Connected" when they report within the last 5 minutes with all permissions granted.'})]}):null}function S(){let{token:e,isAuthenticated:t,active_school_id:r,setSchoolId:c}=(0,n.a)(),[o,d]=(0,a.useState)([]),[u,x]=(0,a.useState)(null),[m,g]=(0,a.useState)(!0),[p,v]=(0,a.useState)(null);if((0,a.useEffect)(()=>{(async()=>{if(t)try{g(!0);let e=await h.Yu.mine();d(e);let t=e.find(e=>e.id===r);x(t||null)}catch(e){console.error("Failed to load schools:",e)}finally{g(!1)}})()},[t,r]),!t)return(0,s.jsx)(l.Z,{title:"Settings",subtitle:"Manage your account and preferences",children:(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Please log in to access your school settings."})})});if(m)return(0,s.jsx)(l.Z,{title:"Settings",subtitle:"Manage your account and preferences",children:(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-2 text-sm text-neutral-600 dark:text-neutral-400",children:"Loading schools..."})]})});let b=u?u.name:"Settings",f=u?"Manage your school settings and preferences":"Manage your account and preferences";return(0,s.jsx)(l.Z,{title:b,subtitle:f,children:(0,s.jsxs)("div",{className:"space-y-8",children:[u&&(0,s.jsx)("div",{className:"border-t border-neutral-200 dark:border-neutral-700 pt-6",children:(0,s.jsx)(w,{schoolId:u.id})}),u&&(0,s.jsxs)("div",{className:"border-t border-neutral-200 dark:border-neutral-700 pt-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-neutral-900 dark:text-neutral-100 mb-4",children:"WhatsApp Integration"}),(0,s.jsx)(i,{schoolId:u.id})]})]})})}},6957:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var s=r(7437),a=r(6463),n=r(7138),l=r(8030);let c=(0,l.Z)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),o=[{href:"/settings/profile",label:"Profile",icon:c},{href:"/settings/account",label:"Account",icon:(0,l.Z)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},{href:"/settings/devices&messaging",label:"Devices & Messaging",icon:(0,l.Z)("building-2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},{href:"/settings/notifications",label:"Notifications",icon:(0,l.Z)("bell",[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]])}];function i(e){let{children:t,title:r="Settings",subtitle:l="Manage your account and preferences"}=e,c=(0,a.usePathname)();return(0,s.jsx)("div",{className:"min-h-screen bg-neutral-50 dark:bg-neutral-950",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-neutral-900 dark:text-neutral-100",children:r}),(0,s.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400 mt-2",children:l})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8 h-[calc(100vh-200px)]",children:[(0,s.jsx)("div",{className:"lg:col-span-1",children:(0,s.jsx)("nav",{className:"space-y-1 sticky top-8",children:o.map(e=>{let t=e.icon,r=c===e.href;return(0,s.jsxs)(n.default,{href:e.href,className:"\n                      flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors\n                      ".concat(r?"bg-neutral-200 dark:bg-neutral-800 text-neutral-900 dark:text-neutral-100":"text-neutral-600 dark:text-neutral-400 hover:bg-neutral-100 dark:hover:bg-neutral-800 hover:text-neutral-900 dark:hover:text-neutral-100","\n                    "),children:[(0,s.jsx)(t,{size:18,className:"flex-shrink-0"}),(0,s.jsx)("span",{children:e.label})]},e.href)})})}),(0,s.jsx)("div",{className:"lg:col-span-3 h-full overflow-hidden",children:(0,s.jsx)("div",{className:"card h-full overflow-y-auto",children:(0,s.jsx)("div",{className:"p-6",children:t})})})]})]})})}},857:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return c},a:function(){return o}});var s=r(7437),a=r(2265),n=r(6463);let l=(0,a.createContext)({token:null,active_school_id:null,isLoading:!0,login:async()=>{},logout:()=>{},setSchoolId:()=>{},isAuthenticated:!1});function c(e){let{children:t}=e,[r,c]=(0,a.useState)({token:null,active_school_id:null,isLoading:!0}),o=(0,n.useRouter)();(0,a.useEffect)(()=>{c({token:localStorage.getItem("token"),active_school_id:localStorage.getItem("active_school_id"),isLoading:!1})},[]);let i=async e=>{localStorage.setItem("token",e.token),c(t=>({...t,token:e.token,isLoading:!1}))},d={...r,login:i,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),c({token:null,active_school_id:null,isLoading:!1}),o.replace("/login")},setSchoolId:e=>{localStorage.setItem("active_school_id",e),c(t=>({...t,active_school_id:e}))},isAuthenticated:!!r.token&&!r.isLoading};return(0,s.jsx)(l.Provider,{value:d,children:t})}let o=()=>(0,a.useContext)(l)},6706:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(8030).Z)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},883:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(8030).Z)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},6127:function(e,t,r){"use strict";r.d(t,{Z:function(){return s}});let s=(0,r(8030).Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},459:function(e,t,r){"use strict";r.d(t,{h:function(){return s}});let s=r(8472).Z.create({baseURL:"http://localhost:8000",timeout:2e4});s.interceptors.request.use(e=>{let t=localStorage.getItem("token"),r=localStorage.getItem("active_school_id");return t&&(e.headers.Authorization="Bearer ".concat(t)),r&&(e.headers["X-School-ID"]=r),e}),s.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(console.error("Unauthorized request detected"),localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),window.location.href="/login"),Promise.reject(e)})},1010:function(e,t,r){"use strict";r.d(t,{TX:function(){return n},Yu:function(){return a}});var s=r(459);let a={async list(){let{data:e}=await s.h.get("/api/schools");return e},async mine(){let{data:e}=await s.h.get("/api/schools/mine");return e},async getActive(){let{data:e}=await s.h.get("/api/schools/active");return e},async create(e){let{data:t}=await s.h.post("/api/schools",e);return t},async get(e){let{data:t}=await s.h.get("/api/schools/".concat(e));return t},async getOverview(e){let{data:t}=await s.h.get("/api/schools/overview",{headers:{"X-School-ID":e}});return t},async update(e,t){let{data:r}=await s.h.put("/api/schools/".concat(e),t);return r},async getMobileDevices(e){let{data:t}=await s.h.get("/api/mobile/status",{headers:{"X-School-ID":e}});return t},async removeMobileDevice(e,t){let{data:r}=await s.h.delete("/api/mobile/status/".concat(t),{headers:{"X-School-ID":e}});return r},async getAllSchoolDevices(e){let{data:t}=await s.h.get("/api/mobile/debug/all-devices",{headers:{"X-School-ID":e}});return t}},n=a.create;a.list,a.get,a.getOverview,a.update,a.getMobileDevices,a.removeMobileDevice,a.getAllSchoolDevices}},function(e){e.O(0,[236,48,971,23,744],function(){return e(e.s=2548)}),_N_E=e.O()}]);