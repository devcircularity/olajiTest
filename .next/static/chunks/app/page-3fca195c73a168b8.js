(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{9995:function(e,t,o){Promise.resolve().then(o.bind(o,6774))},6774:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return i}});var s=o(7437),r=o(6463),n=o(2265),a=o(857);function i(){let{user:e,isAuthenticated:t,isLoading:o}=(0,a.a)(),i=(0,r.useRouter)();return(0,n.useEffect)(()=>{var s,r,n;if(!o){if(!t||!e){i.replace("/login");return}(null===(s=e.roles)||void 0===s?void 0:s.includes("TESTER"))?i.replace("/tester"):(null===(r=e.permissions)||void 0===r?void 0:r.is_admin)||(null===(n=e.permissions)||void 0===n?void 0:n.is_super_admin)?i.replace("/admin"):i.replace("/dashboard")}},[e,t,o,i]),(0,s.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Redirecting..."})]})})}},857:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return l},a:function(){return c}});var s=o(7437),r=o(2265),n=o(6463),a=o(1785);let i=(0,r.createContext)({token:null,active_school_id:null,user:null,isLoading:!0,login:async()=>{},logout:()=>{},setSchoolId:()=>{},isAuthenticated:!1});function l(e){let{children:t}=e,[o,l]=(0,r.useState)({token:null,active_school_id:null,user:null,isLoading:!0}),c=(0,n.useRouter)();(0,r.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("active_school_id");if(e){a.O.storeToken(e);try{let o=await a.O.getCurrentUser();l({token:e,active_school_id:t,user:o,isLoading:!1})}catch(e){console.error("Failed to fetch user data:",e),localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),l({token:null,active_school_id:null,user:null,isLoading:!1})}}else l({token:null,active_school_id:null,user:null,isLoading:!1})})()},[]);let u=async e=>{localStorage.setItem("token",e.token),a.O.storeToken(e.token);try{var t,o,s;let r=await a.O.getCurrentUser();l(t=>({...t,token:e.token,user:r,isLoading:!1})),(null===(t=r.roles)||void 0===t?void 0:t.includes("TESTER"))?c.replace("/tester"):(null===(o=r.permissions)||void 0===o?void 0:o.is_admin)||(null===(s=r.permissions)||void 0===s?void 0:s.is_super_admin)?c.replace("/admin"):c.replace("/dashboard")}catch(t){throw console.error("Failed to fetch user data after login:",t),l(t=>({...t,token:e.token,user:null,isLoading:!1})),t}},d={...o,login:u,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),a.O.logout(),l({token:null,active_school_id:null,user:null,isLoading:!1}),c.replace("/login")},setSchoolId:e=>{localStorage.setItem("active_school_id",e),a.O.storeSchoolId(e),l(t=>({...t,active_school_id:e}))},isAuthenticated:!!o.token&&!!o.user&&!o.isLoading};return(0,s.jsx)(i.Provider,{value:d,children:t})}let c=()=>(0,r.useContext)(i)},459:function(e,t,o){"use strict";o.d(t,{x:function(){return a}});var s=o(8472),r=o(357);class n{handleApiError(e){if(console.error("❌ API Error:",e),e.response){let t=e.response.status,o=e.response.data;switch(t){case 401:localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),window.location.pathname.includes("/login")||window.location.pathname.includes("/signup")||window.location.pathname.includes("/public")||(window.location.href="/login");break;case 403:console.warn("⚠️ Access forbidden:",(null==o?void 0:o.detail)||"Insufficient permissions");break;case 404:console.warn("⚠️ Resource not found:",(null==o?void 0:o.detail)||"Resource not found");break;case 422:console.warn("⚠️ Validation error:",(null==o?void 0:o.detail)||"Invalid request data");break;case 500:console.error("\uD83D\uDCA5 Server error:",(null==o?void 0:o.detail)||"Internal server error");break;default:console.error("\uD83D\uDCA5 HTTP ".concat(t,":"),(null==o?void 0:o.detail)||e.message)}}else e.request?console.error("\uD83C\uDF10 Network error - no response received:",e.message):console.error("⚙️ Request setup error:",e.message)}async get(e,t){return this.client.get(e,{params:t})}async post(e,t){return this.client.post(e,t)}async put(e,t){return this.client.put(e,t)}async patch(e,t){return this.client.patch(e,t)}async delete(e){return this.client.delete(e)}async uploadFile(e,t,o){let s=new FormData;return s.append("file",t),o&&Object.keys(o).forEach(e=>{s.append(e,o[e])}),this.client.post(e,s,{headers:{"Content-Type":"multipart/form-data"}})}async healthCheck(){try{let e=await this.client.get("/healthz");return 200===e.status}catch(e){return console.error("Health check failed:",e),!1}}getBaseURL(){return this.baseURL}setAuthToken(e){this.client.defaults.headers.common.Authorization="Bearer ".concat(e)}clearAuthToken(){delete this.client.defaults.headers.common.Authorization}static isSuccess(e){return e.status>=200&&e.status<300}static getErrorMessage(e){var t;if(null===(t=e.response)||void 0===t?void 0:t.data){let t=e.response.data;return t.detail||t.message||"An error occurred"}return e.message||"Network error"}constructor(){this.baseURL=r.env.NEXT_PUBLIC_API_URL||"http://localhost:8000",this.client=s.Z.create({baseURL:this.baseURL,timeout:3e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>(console.error("❌ Request interceptor error:",e),Promise.reject(e))),this.client.interceptors.response.use(e=>e,e=>(this.handleApiError(e),Promise.reject(e)))}}let a=new n},1785:function(e,t,o){"use strict";o.d(t,{O:function(){return n}});var s=o(459);class r{async login(e){return(await s.x.post("/api/auth/login",e)).data}async register(e){return(await s.x.post("/api/auth/register",e)).data}async switchSchool(e){return(await s.x.post("/api/auth/switch-school",e)).data}async getCurrentUser(){return(await s.x.get("/api/auth/me")).data}async getUserPermissions(){return(await s.x.get("/api/auth/permissions")).data}hasRole(e,t){var o,s;return null!==(s=null==e?void 0:null===(o=e.roles)||void 0===o?void 0:o.includes(t))&&void 0!==s&&s}hasAnyRole(e,t){return null!=e&&!!e.roles&&t.some(t=>e.roles.includes(t))}isAdmin(e){return this.hasAnyRole(e,["ADMIN","SUPER_ADMIN"])}isSuperAdmin(e){return this.hasRole(e,"SUPER_ADMIN")}isTester(e){return this.hasRole(e,"TESTER")}getPrimaryRole(e){var t;return null!==(t=null==e?void 0:e.primary_role)&&void 0!==t?t:"PARENT"}formatRoleName(e){return({SUPER_ADMIN:"Super Admin",ADMIN:"Administrator",TESTER:"Tester",TEACHER:"Teacher",ACCOUNTANT:"Accountant",PARENT:"Parent"})[e]||e}getAvailableActions(e){let t=[];return e&&(e.can_manage_students&&t.push("manage_students"),e.can_manage_classes&&t.push("manage_classes"),e.can_manage_fees&&t.push("manage_fees"),e.can_manage_payments&&t.push("manage_payments"),e.can_manage_school&&t.push("manage_school"),e.can_manage_users&&t.push("manage_users"),e.can_view_logs&&t.push("view_logs"),e.can_manage_intent_config&&t.push("manage_intent_config"),e.can_access_tester_queue&&t.push("access_tester_queue"),e.can_submit_suggestions&&t.push("submit_suggestions"),e.can_manage_all_schools&&t.push("manage_all_schools"),e.can_access_system_settings&&t.push("access_system_settings")),t}logout(){localStorage.removeItem("token"),localStorage.removeItem("active_school_id")}getStoredToken(){return localStorage.getItem("token")}getStoredSchoolId(){return localStorage.getItem("active_school_id")}storeToken(e){localStorage.setItem("token",e)}storeSchoolId(e){localStorage.setItem("active_school_id",e)}}let n=new r}},function(e){e.O(0,[236,971,23,744],function(){return e(e.s=9995)}),_N_E=e.O()}]);