(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[605],{9690:function(e,t,a){Promise.resolve().then(a.bind(a,8261))},8261:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var s=a(7437),l=a(6463),n=a(2265),i=a(1010),o=a(857);function r(){let e=(0,l.useRouter)(),t=(0,l.useSearchParams)().get("next")||"/",{setSchoolId:a}=(0,o.a)(),r=new Date().getFullYear(),[c,d]=(0,n.useState)({name:"",short_code:"",email:"",phone:"",address:"",currency:"KES",academic_year_start:"".concat(r,"-01-01")}),[u,m]=(0,n.useState)(!1),[h,v]=(0,n.useState)(null);async function p(s){if(s.preventDefault(),v(null),!c.name.trim())return v("School name is required");if(!c.academic_year_start)return v("Academic year start date is required");m(!0);try{let s=await (0,i.TX)({name:c.name.trim(),short_code:c.short_code||void 0,email:c.email||void 0,phone:c.phone||void 0,address:c.address||void 0,currency:c.currency||void 0,academic_year_start:c.academic_year_start});a(s.id.toString()),e.push(t)}catch(e){var l,n;v((null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(l=n.data)||void 0===l?void 0:l.detail)||"Failed to create school")}finally{m(!1)}}return(0,s.jsx)("div",{className:"min-h-screen grid place-items-center p-6",children:(0,s.jsxs)("div",{className:"w-full max-w-2xl card p-6 space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-xl font-semibold",children:"Create your school"}),(0,s.jsx)("p",{className:"text-sm opacity-70",children:"Let's set up the basics before you start managing students and fees."})]}),(0,s.jsxs)("form",{onSubmit:p,className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"School name *"}),(0,s.jsx)("input",{className:"input mt-1",value:c.name,onChange:e=>d({...c,name:e.target.value}),placeholder:"e.g., Imara Primary School",required:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Short code"}),(0,s.jsx)("input",{className:"input mt-1",value:c.short_code,onChange:e=>d({...c,short_code:e.target.value.toUpperCase()}),placeholder:"IMARA",maxLength:10}),(0,s.jsx)("p",{className:"text-xs opacity-60 mt-1",children:"Used for reports and student IDs"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Official email"}),(0,s.jsx)("input",{type:"email",className:"input mt-1",value:c.email,onChange:e=>d({...c,email:e.target.value}),placeholder:"admin@school.ke"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Phone"}),(0,s.jsx)("input",{type:"tel",className:"input mt-1",value:c.phone,onChange:e=>d({...c,phone:e.target.value}),placeholder:"+254..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Currency"}),(0,s.jsxs)("select",{className:"input mt-1",value:c.currency,onChange:e=>d({...c,currency:e.target.value}),children:[(0,s.jsx)("option",{value:"KES",children:"KES - Kenyan Shilling"}),(0,s.jsx)("option",{value:"USD",children:"USD - US Dollar"}),(0,s.jsx)("option",{value:"UGX",children:"UGX - Ugandan Shilling"}),(0,s.jsx)("option",{value:"TZS",children:"TZS - Tanzanian Shilling"})]})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Address"}),(0,s.jsx)("input",{className:"input mt-1",value:c.address,onChange:e=>d({...c,address:e.target.value}),placeholder:"School address / Location"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"text-sm font-medium",children:"Academic year start date *"}),(0,s.jsx)("input",{type:"date",className:"input mt-1",value:c.academic_year_start,onChange:e=>d({...c,academic_year_start:e.target.value}),required:!0}),(0,s.jsx)("p",{className:"text-xs opacity-60 mt-1",children:"This sets up your academic calendar and determines when terms begin. Most Kenyan schools start in January."})]}),(0,s.jsx)("div",{className:"md:col-span-2",children:(0,s.jsx)("button",{type:"submit",className:"btn-primary w-full",disabled:u||!c.name.trim()||!c.academic_year_start,children:u?"Creating school & setting up academic calendarâ€¦":"Create school"})}),h&&(0,s.jsx)("div",{className:"md:col-span-2 text-sm text-red-600 dark:text-red-400 bg-red-50 dark:bg-red-900/20 p-3 rounded",children:h})]})]})})}function c(){return(0,s.jsx)(n.Suspense,{fallback:(0,s.jsx)("div",{children:"Loading..."}),children:(0,s.jsx)(r,{})})}},857:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return o},a:function(){return r}});var s=a(7437),l=a(2265),n=a(6463);let i=(0,l.createContext)({token:null,active_school_id:null,isLoading:!0,login:async()=>{},logout:()=>{},setSchoolId:()=>{},isAuthenticated:!1});function o(e){let{children:t}=e,[a,o]=(0,l.useState)({token:null,active_school_id:null,isLoading:!0}),r=(0,n.useRouter)();(0,l.useEffect)(()=>{o({token:localStorage.getItem("token"),active_school_id:localStorage.getItem("active_school_id"),isLoading:!1})},[]);let c=async e=>{localStorage.setItem("token",e.token),o(t=>({...t,token:e.token,isLoading:!1}))},d={...a,login:c,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),o({token:null,active_school_id:null,isLoading:!1}),r.replace("/login")},setSchoolId:e=>{localStorage.setItem("active_school_id",e),o(t=>({...t,active_school_id:e}))},isAuthenticated:!!a.token&&!a.isLoading};return(0,s.jsx)(i.Provider,{value:d,children:t})}let r=()=>(0,l.useContext)(i)},459:function(e,t,a){"use strict";a.d(t,{h:function(){return n}});var s=a(8472),l=a(357);let n=s.Z.create({baseURL:l.env.NEXT_PUBLIC_API_BASE_URL||"http://localhost:8000",timeout:2e4});n.interceptors.request.use(e=>{let t=localStorage.getItem("token"),a=localStorage.getItem("active_school_id");return t&&(e.headers.Authorization="Bearer ".concat(t)),a&&(e.headers["X-School-ID"]=a),e}),n.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(console.error("Unauthorized request detected"),localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),window.location.href="/login"),Promise.reject(e)})},1010:function(e,t,a){"use strict";a.d(t,{TX:function(){return n},Yu:function(){return l}});var s=a(459);let l={async list(){let{data:e}=await s.h.get("/api/schools");return e},async mine(){let{data:e}=await s.h.get("/api/schools/mine");return e},async getActive(){let{data:e}=await s.h.get("/api/schools/active");return e},async create(e){let{data:t}=await s.h.post("/api/schools",e);return t},async get(e){let{data:t}=await s.h.get("/api/schools/".concat(e));return t},async getOverview(e){let{data:t}=await s.h.get("/api/schools/overview",{headers:{"X-School-ID":e}});return t},async update(e,t){let{data:a}=await s.h.put("/api/schools/".concat(e),t);return a},async getMobileDevices(e){let{data:t}=await s.h.get("/api/mobile/status",{headers:{"X-School-ID":e}});return t},async removeMobileDevice(e,t){let{data:a}=await s.h.delete("/api/mobile/status/".concat(t),{headers:{"X-School-ID":e}});return a},async getAllSchoolDevices(e){let{data:t}=await s.h.get("/api/mobile/debug/all-devices",{headers:{"X-School-ID":e}});return t}},n=l.create;l.list,l.get,l.getOverview,l.update,l.getMobileDevices,l.removeMobileDevice,l.getAllSchoolDevices}},function(e){e.O(0,[236,971,23,744],function(){return e(e.s=9690)}),_N_E=e.O()}]);