(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[232],{819:function(e,s,t){Promise.resolve().then(t.bind(t,1007))},1007:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return f}});var a=t(7437),n=t(2265),l=t(857),r=t(459);class i{async getRecentMessages(e){let s=new URLSearchParams;return(null==e?void 0:e.limit)&&s.append("limit",e.limit.toString()),(null==e?void 0:e.school_id)&&s.append("school_id",e.school_id),(null==e?void 0:e.user_id)&&s.append("user_id",e.user_id),(null==e?void 0:e.has_rating)&&s.append("has_rating","true"),(null==e?void 0:e.message_type)&&s.append("message_type",e.message_type),(null==e?void 0:e.hours_back)&&s.append("hours_back",e.hours_back.toString()),(await r.x.get("/api/admin/chat/messages?".concat(s.toString()))).data}async getActiveConversations(e){let s=new URLSearchParams;return(null==e?void 0:e.school_id)&&s.append("school_id",e.school_id),(null==e?void 0:e.limit)&&s.append("limit",e.limit.toString()),(null==e?void 0:e.problems_only)&&s.append("problems_only","true"),(await r.x.get("/api/admin/chat/conversations?".concat(s.toString()))).data}async getRealtimeStats(e){return(await r.x.get("/api/admin/chat/stats/realtime".concat(e?"?school_id=".concat(e):""))).data}async getConversationDetails(e){return(await r.x.get("/api/admin/chat/conversations/".concat(e))).data}async flagConversation(e,s){return(await r.x.post("/api/admin/chat/conversations/".concat(e,"/flag"),{reason:s})).data}async getChatAnalytics(e){let s=new URLSearchParams;return(null==e?void 0:e.start_date)&&s.append("start_date",e.start_date),(null==e?void 0:e.end_date)&&s.append("end_date",e.end_date),(null==e?void 0:e.school_id)&&s.append("school_id",e.school_id),(null==e?void 0:e.group_by)&&s.append("group_by",e.group_by),(await r.x.get("/api/admin/chat/analytics?".concat(s.toString()))).data}}let c=new i;var d=t(7886),o=t(5733),m=t(1240),x=t(7390),u=t(933),h=t(3225),p=t(6127),g=t(4308);function f(){var e,s,t,r;let{user:i}=(0,l.a)(),[f,v]=(0,n.useState)(null),[j,N]=(0,n.useState)([]),[y,b]=(0,n.useState)(!0),[k,_]=(0,n.useState)(!0),[w,C]=(0,n.useState)(null);(0,n.useEffect)(()=>{if(Z(),k){let e=setInterval(Z,3e4);return()=>clearInterval(e)}},[k]);let Z=async()=>{try{b(!0);let[e,s]=await Promise.all([c.getRealtimeStats(),c.getRecentMessages({limit:50,hours_back:24})]);v(e),N(s)}catch(e){console.error("Failed to load monitoring data:",e)}finally{b(!1)}},D=async e=>{try{let s=await c.getConversationDetails(e.conversation_id);console.log("Conversation details:",s),C(e)}catch(e){console.error("Failed to load conversation:",e)}},M=[{key:"created_at",label:"Time",render:e=>{let s=new Date(e),t=Math.floor((new Date().getTime()-s.getTime())/6e4);return t<1?(0,a.jsx)("span",{className:"text-xs sm:text-sm",children:"Just now"}):t<60?(0,a.jsxs)("span",{className:"text-xs sm:text-sm",children:[t,"m ago"]}):t<1440?(0,a.jsxs)("span",{className:"text-xs sm:text-sm",children:[Math.floor(t/60),"h ago"]}):(0,a.jsx)("span",{className:"text-xs sm:text-sm",children:s.toLocaleDateString()})},width:"100px"},{key:"message_type",label:"Type",render:e=>(0,a.jsx)("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ".concat("user"===e?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200":"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200"),children:"user"===e?"User":"Assistant"}),width:"80px"},{key:"content",label:"Message",render:e=>(0,a.jsx)("div",{className:"max-w-xs sm:max-w-md truncate text-xs sm:text-sm break-words",title:e,children:e})},{key:"intent",label:"Intent",render:e=>e?(0,a.jsx)("code",{className:"text-xs bg-gray-100 dark:bg-gray-800 px-2 py-1 rounded break-all",children:e}):"-",width:"120px"},{key:"rating",label:"Rating",render:(e,s)=>"user"===s.message_type?(0,a.jsx)("span",{className:"text-xs sm:text-sm",children:"-"}):1===e?(0,a.jsx)("span",{className:"text-green-600",children:"\uD83D\uDC4D"}):-1===e?(0,a.jsx)("span",{className:"text-red-600",children:"\uD83D\uDC4E"}):(0,a.jsx)("span",{className:"text-gray-400",children:"-"}),width:"60px"},{key:"processing_time_ms",label:"Response Time",render:e=>(0,a.jsx)("span",{className:"text-xs sm:text-sm",children:e?"".concat(e,"ms"):"-"}),width:"100px"}],A=[{label:"View Conversation",icon:(0,a.jsx)(o.Z,{size:14}),onClick:D,variant:"secondary"}];return(null==i?void 0:null===(e=i.permissions)||void 0===e?void 0:e.is_admin)||(null==i?void 0:null===(s=i.permissions)||void 0===s?void 0:s.is_super_admin)?(0,a.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4 sm:mb-6 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl sm:text-2xl font-bold mb-2",children:"Chat Monitoring"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-neutral-600",children:"Real-time monitoring of chat interactions and system performance"})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",checked:k,onChange:e=>_(e.target.checked),className:"rounded"}),(0,a.jsx)("span",{className:"text-xs sm:text-sm",children:"Auto-refresh"})]}),(0,a.jsx)(g.default,{onClick:Z,className:"btn-secondary text-sm",children:"Refresh Now"})]})]}),f&&(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3 sm:gap-4 mb-4 sm:mb-6",children:[(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(m.Z,{size:14,className:"text-blue-600 flex-shrink-0"}),(0,a.jsx)("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Active Chats"})]}),(0,a.jsx)("p",{className:"text-lg sm:text-2xl font-bold",children:f.active_conversations})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(x.Z,{size:14,className:"text-green-600 flex-shrink-0"}),(0,a.jsx)("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Messages Today"})]}),(0,a.jsx)("p",{className:"text-lg sm:text-2xl font-bold",children:f.messages_today})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(u.Z,{size:14,className:"text-purple-600 flex-shrink-0"}),(0,a.jsx)("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Avg Response"})]}),(0,a.jsxs)("p",{className:"text-lg sm:text-2xl font-bold",children:[f.average_response_time,"ms"]})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(h.Z,{size:14,className:"text-green-600 flex-shrink-0"}),(0,a.jsx)("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Satisfaction"})]}),(0,a.jsxs)("p",{className:"text-lg sm:text-2xl font-bold",children:[(100*f.satisfaction_rate).toFixed(1),"%"]})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(p.Z,{size:14,className:"text-orange-600 flex-shrink-0"}),(0,a.jsx)("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Fallback Rate"})]}),(0,a.jsxs)("p",{className:"text-lg sm:text-2xl font-bold",children:[(100*f.fallback_rate).toFixed(1),"%"]})]}),(0,a.jsxs)("div",{className:"card p-3 sm:p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsx)(h.Z,{size:14,className:"text-blue-600 flex-shrink-0"}),(0,a.jsx)("h3",{className:"text-xs sm:text-sm font-medium text-neutral-600 truncate",children:"Top Intent"})]}),(0,a.jsx)("p",{className:"text-sm sm:text-lg font-bold truncate",children:(null===(t=f.top_intents_today[0])||void 0===t?void 0:t.intent)||"N/A"}),(0,a.jsxs)("p",{className:"text-xs text-neutral-500",children:[(null===(r=f.top_intents_today[0])||void 0===r?void 0:r.count)||0," uses"]})]})]}),(0,a.jsxs)("div",{className:"mb-4 sm:mb-6",children:[(0,a.jsx)("h2",{className:"text-base sm:text-lg font-semibold mb-3 sm:mb-4",children:"Recent Messages (Last 24 Hours)"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)(d.Z,{data:j,columns:M,actions:A,loading:y,searchable:!0,searchPlaceholder:"Search messages...",emptyMessage:"No recent messages found",className:"text-xs sm:text-sm"})})]}),w&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:()=>C(null)}),(0,a.jsx)("div",{className:"relative bg-white dark:bg-neutral-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-4 sm:p-6",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start mb-4 sm:mb-6 gap-3",children:[(0,a.jsx)("h2",{className:"text-lg sm:text-xl font-bold",children:"Conversation Details"}),(0,a.jsx)(g.default,{onClick:()=>C(null),className:"btn-secondary text-sm",children:"Close"})]}),(0,a.jsxs)("div",{className:"space-y-3 sm:space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-sm",children:"Message Type:"}),(0,a.jsx)("span",{className:"ml-2 text-sm",children:w.message_type})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-sm",children:"Intent:"}),(0,a.jsx)("span",{className:"ml-2 text-sm",children:w.intent||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-sm",children:"User ID:"}),(0,a.jsx)("span",{className:"ml-2 text-sm font-mono break-all",children:w.user_id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-sm",children:"Conversation ID:"}),(0,a.jsx)("span",{className:"ml-2 text-sm font-mono break-all",children:w.conversation_id})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-sm",children:"Message Content:"}),(0,a.jsx)("div",{className:"mt-2 p-3 sm:p-4 bg-neutral-50 dark:bg-neutral-700 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm whitespace-pre-wrap break-words",children:w.content})})]}),w.processing_time_ms&&(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-sm",children:"Processing Time:"}),(0,a.jsxs)("span",{className:"ml-2 text-sm",children:[w.processing_time_ms,"ms"]})]}),w.rating&&(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{className:"text-sm",children:"User Rating:"}),(0,a.jsx)("span",{className:"ml-2 text-sm ".concat(1===w.rating?"text-green-600":"text-red-600"),children:1===w.rating?" \uD83D\uDC4D Positive":" \uD83D\uDC4E Negative"})]})]})]})})]})]}):(0,a.jsx)("div",{className:"p-4 sm:p-6",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-xl sm:text-2xl font-bold mb-4",children:"Access Denied"}),(0,a.jsx)("p",{className:"text-neutral-600",children:"You don't have permission to view chat monitoring."})]})})}},8030:function(e,s,t){"use strict";t.d(s,{Z:function(){return m}});var a=t(2265);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),l=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,s,t)=>t?t.toUpperCase():s.toLowerCase()),r=e=>{let s=l(e);return s.charAt(0).toUpperCase()+s.slice(1)},i=function(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return s.filter((e,s,t)=>!!e&&""!==e.trim()&&t.indexOf(e)===s).join(" ").trim()},c=e=>{for(let s in e)if(s.startsWith("aria-")||"role"===s||"title"===s)return!0};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var d={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let o=(0,a.forwardRef)((e,s)=>{let{color:t="currentColor",size:n=24,strokeWidth:l=2,absoluteStrokeWidth:r,className:o="",children:m,iconNode:x,...u}=e;return(0,a.createElement)("svg",{ref:s,...d,width:n,height:n,stroke:t,strokeWidth:r?24*Number(l)/Number(n):l,className:i("lucide",o),...!m&&!c(u)&&{"aria-hidden":"true"},...u},[...x.map(e=>{let[s,t]=e;return(0,a.createElement)(s,t)}),...Array.isArray(m)?m:[m]])}),m=(e,s)=>{let t=(0,a.forwardRef)((t,l)=>{let{className:c,...d}=t;return(0,a.createElement)(o,{ref:l,iconNode:s,className:i("lucide-".concat(n(r(e))),"lucide-".concat(e),c),...d})});return t.displayName=r(e),t}},518:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(8030).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},7592:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(8030).Z)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},933:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(8030).Z)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]])},5733:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(8030).Z)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},7390:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(8030).Z)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]])},4817:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(8030).Z)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},3225:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(8030).Z)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]])},6127:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(8030).Z)("triangle-alert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]])},1240:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(8030).Z)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},4839:function(e,s,t){"use strict";function a(){for(var e,s,t=0,a="",n=arguments.length;t<n;t++)(e=arguments[t])&&(s=function e(s){var t,a,n="";if("string"==typeof s||"number"==typeof s)n+=s;else if("object"==typeof s){if(Array.isArray(s)){var l=s.length;for(t=0;t<l;t++)s[t]&&(a=e(s[t]))&&(n&&(n+=" "),n+=a)}else for(a in s)s[a]&&(n&&(n+=" "),n+=a)}return n}(e))&&(a&&(a+=" "),a+=s);return a}t.d(s,{W:function(){return a}}),s.Z=a}},function(e){e.O(0,[236,745,971,23,744],function(){return e(e.s=819)}),_N_E=e.O()}]);