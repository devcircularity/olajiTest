(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[91],{42:function(e,l,s){Promise.resolve().then(s.bind(s,3003))},3003:function(e,l,s){"use strict";s.r(l),s.d(l,{default:function(){return f}});var t=s(7437),r=s(2265),n=s(857),a=s(6463),i=s(234),d=s(7138);let o=(0,s(8030).Z)("menu",[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]]);function c(e){let{open:l,onClose:s,onLogout:n,userLabel:a,email:i,schoolId:d}=e;if((0,r.useEffect)(()=>{function e(e){"Escape"===e.key&&s()}return l&&document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[l,s]),!l)return null;let o=(a||i||"U").slice(0,1).toUpperCase();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-[90] bg-black/40 backdrop-blur-[2px]",onClick:s}),(0,t.jsxs)("div",{className:"fixed right-4 top-16 z-[100] w-[360px] sm:w-[380px] rounded-[1.25rem] card border border-neutral-200/60 overflow-hidden shadow-[var(--shadow-soft)]",onClick:e=>e.stopPropagation(),role:"dialog","aria-modal":"true",children:[(0,t.jsxs)("div",{className:"relative px-4 py-3 bg-neutral-900/5 dark:bg-white/5",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-[--color-brand] text-white font-semibold",children:o}),(0,t.jsxs)("div",{className:"min-w-0",children:[i&&(0,t.jsx)("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 truncate",children:i}),(0,t.jsx)("div",{className:"text-sm font-medium truncate",children:a||"User"})]})]}),(0,t.jsx)("button",{onClick:s,className:"absolute right-3 top-3 text-neutral-500 hover:text-neutral-800 dark:hover:text-neutral-200","aria-label":"Close",children:"✕"})]}),(0,t.jsxs)("div",{className:"px-5 pt-4 pb-3",children:[(0,t.jsxs)("div",{className:"text-lg font-semibold",children:["Hi",a?", ".concat(a.split(" ")[0],"!"):"!"]}),(0,t.jsx)("button",{className:"mt-3 btn-primary w-full rounded-xl py-2.5",onClick:()=>alert("Manage account (stub)"),children:"Manage your Account"})]}),(0,t.jsx)("div",{className:"mx-4 mb-3 rounded-2xl bg-neutral-100 dark:bg-neutral-800 p-4",children:(0,t.jsxs)("div",{className:"flex items-start gap-3",children:[(0,t.jsx)("div",{className:"text-xl leading-none",children:"\uD83C\uDFE0"}),(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("div",{className:"font-medium",children:"Set your school & year"}),(0,t.jsx)("div",{className:"text-neutral-600 dark:text-neutral-400",children:"Pick active school and academic year for better results."}),(0,t.jsxs)("div",{className:"mt-2 flex gap-3",children:[(0,t.jsx)("button",{className:"btn rounded-lg px-3 py-1.5 hover:bg-neutral-200 dark:hover:bg-neutral-700",children:"Dismiss"}),(0,t.jsx)("button",{className:"link-subtle",children:"Open settings"})]})]})]})}),(0,t.jsx)("div",{className:"px-4",children:(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsx)("button",{className:"btn rounded-xl px-3 py-2 bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700",onClick:()=>alert("Add account (stub)"),children:"+ Add account"}),(0,t.jsx)("button",{className:"btn rounded-xl px-3 py-2 bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700",onClick:()=>{s(),n()},children:"Sign out"})]})}),(0,t.jsx)("div",{className:"mt-3 px-2 pb-2",children:(0,t.jsxs)("ul",{className:"grid gap-2",children:[(0,t.jsx)("li",{children:(0,t.jsxs)("button",{className:"w-full text-left rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800",children:["\uD83D\uDD0E ",(0,t.jsx)("span",{className:"ml-2",children:"Search history"}),(0,t.jsx)("span",{className:"float-right text-xs text-neutral-500",children:"Not saving"})]})}),(0,t.jsx)("li",{children:(0,t.jsxs)("button",{className:"w-full text-left rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800",children:["\uD83D\uDCC1 ",(0,t.jsx)("span",{className:"ml-2",children:"Saves & Collections"})]})}),(0,t.jsx)("li",{children:(0,t.jsxs)("button",{className:"w-full text-left rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800",children:["✨ ",(0,t.jsx)("span",{className:"ml-2",children:"Search personalization"})]})}),(0,t.jsxs)("li",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("button",{className:"rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 text-left",children:["\uD83D\uDEE1️ ",(0,t.jsx)("span",{className:"ml-2",children:"SafeSearch"}),(0,t.jsx)("div",{className:"text-xs text-neutral-500 ml-7 -mt-1",children:"Blurring on"})]}),(0,t.jsxs)("button",{className:"rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 text-left",children:["\uD83C\uDF10 ",(0,t.jsx)("span",{className:"ml-2",children:"Language"}),(0,t.jsx)("div",{className:"text-xs text-neutral-500 ml-7 -mt-1",children:"English"})]})]}),(0,t.jsxs)("li",{className:"grid grid-cols-2 gap-2",children:[(0,t.jsxs)("button",{className:"rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 text-left",children:["⚙️ ",(0,t.jsx)("span",{className:"ml-2",children:"More settings"})]}),(0,t.jsxs)("button",{className:"rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 text-left",children:["❔ ",(0,t.jsx)("span",{className:"ml-2",children:"Help"})]})]})]})}),(0,t.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between text-xs text-neutral-600 dark:text-neutral-400 border-t border-neutral-200/70 dark:border-white/10",children:[(0,t.jsx)("div",{children:"Privacy Policy"}),(0,t.jsx)("div",{children:"Terms of Service"})]})]})]})}let u=new Set,x={send(e){u.forEach(l=>l(e))},on:e=>(u.add(e),()=>{u.delete(e)})};function m(){let{token:e,active_school_id:l,logout:s}=(0,n.a)(),[a,i]=(0,r.useState)(!1),[u,m]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!1),[f,b]=(0,r.useState)(""),[g,j]=(0,r.useState)(""),N=(0,r.useRef)(null),k=(0,r.useMemo)(()=>(function(e){if(!e)return null;try{var l;let s=null===(l=e.split(".")[1])||void 0===l?void 0:l.replace(/-/g,"+").replace(/_/g,"/"),t=atob(s);return JSON.parse(t)}catch(e){return null}})(e||void 0),[e]),w=null==k?void 0:k.full_name,y=null==k?void 0:k.email,E=w||y||"Guest",S=function(e,l){var s;let t=(e||"").trim();return t?t.split(/\s+/).slice(0,2).map(e=>{var l;return(null===(l=e[0])||void 0===l?void 0:l.toUpperCase())||""}).join("")||"U":l&&(null===(s=l[0])||void 0===s?void 0:s.toUpperCase())||"U"}(w,y),D=null!=l?l:null==k?void 0:k.active_school_id;return(0,r.useEffect)(()=>{let e=()=>{p(window.innerWidth<1024)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,r.useEffect)(()=>x.on(e=>{"set"===e.type?(b(e.title),j(e.subtitle||"")):"clear"===e.type&&(b(""),j(""))}),[]),(0,r.useEffect)(()=>{function e(e){N.current&&!N.current.contains(e.target)&&m(!1)}return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),(0,t.jsxs)("header",{className:"flex items-center justify-between px-4 py-3 border-b border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-900",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[h&&(0,t.jsx)("button",{onClick:()=>{v.send({type:"toggle"})},className:"p-2 -ml-2 rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors","aria-label":"Toggle sidebar",children:(0,t.jsx)(o,{size:20,className:"text-neutral-600 dark:text-neutral-400"})}),f&&(0,t.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,t.jsx)("h1",{className:"text-base sm:text-lg font-semibold text-neutral-900 dark:text-neutral-100 truncate",children:f}),g&&(0,t.jsx)("p",{className:"text-xs sm:text-sm text-neutral-600 dark:text-neutral-400 truncate",children:g})]})]}),(0,t.jsx)("div",{className:"flex items-center flex-shrink-0",children:e?(0,t.jsxs)("div",{className:"relative",ref:N,children:[(0,t.jsx)("button",{onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),onClick:()=>i(!0),className:"inline-flex h-10 w-10 items-center justify-center  rounded-full bg-[--color-brand] text-white font-semibold text-sm shadow-lg hover:shadow-xl ring-2 ring-[--color-brand]/30 dark:ring-[--color-brand]/40 border-2 border-[--color-brand-light]/50 hover:scale-105 active:scale-95 transition-all duration-200 ease-out","aria-label":"User menu",title:E,children:S}),u&&(0,t.jsxs)("div",{className:"absolute right-0 mt-2 card px-3 py-2 text-xs min-w-[200px] z-50",onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:[(0,t.jsx)("div",{className:"font-medium truncate",children:E}),y&&(0,t.jsx)("div",{className:"text-neutral-600 dark:text-neutral-400 truncate",children:y})]}),(0,t.jsx)(c,{open:a,onClose:()=>i(!1),onLogout:s,userLabel:E,email:y||void 0,schoolId:D})]}):(0,t.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,t.jsx)(d.default,{className:"link-subtle",href:"/login",children:"Login"}),(0,t.jsx)(d.default,{className:"link-subtle",href:"/signup",children:"Sign up"})]})})]})}let h=new Set,v={send(e){h.forEach(l=>l(e))},on:e=>(h.add(e),()=>{h.delete(e)})};function p(e){let{children:l}=e,[s,n]=(0,r.useState)(!0),[a,d]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=()=>{let e=window.innerWidth<1024;d(e),e&&n(!0)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,r.useEffect)(()=>{"0"!==localStorage.getItem("sidebar_collapsed")||a||n(!1)},[a]);let o=e=>{console.log("Toggle sidebar called:",{newState:e,currentCollapsed:s,isMobile:a}),n(l=>{let s=void 0!==e?e:!l;return console.log("Sidebar state changing from",l,"to",s),a||localStorage.setItem("sidebar_collapsed",s?"1":"0"),s})};return(0,r.useEffect)(()=>v.on(e=>{console.log("SidebarBus command received:",e,{isMobile:a,collapsed:s}),"toggle"===e.type&&o(),"open"===e.type&&o(!1),"close"===e.type&&o(!0),"auto-collapse"!==e.type||a||s||(console.log("Auto-collapsing sidebar after user action"),o(!0))}),[o,a,s]),(0,t.jsx)("div",{className:"h-svh w-full overflow-hidden",children:(0,t.jsxs)("div",{className:"flex-1 overflow-hidden relative h-full",children:[a&&!s&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 z-30",onClick:()=>o(!0)}),(0,t.jsxs)("div",{className:"relative flex overflow-hidden h-full",children:[(0,t.jsx)("div",{className:"\n            transition-all duration-300 ease-in-out\n            ".concat(a?"fixed left-0 top-0 h-full w-80 z-40 ".concat(s?"-translate-x-full":"translate-x-0"):"relative z-10 ".concat(s?"w-16":"w-auto"),"\n          "),children:(0,t.jsx)(i.Z,{collapsed:s&&!a,onCollapse:o,isMobile:a})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-hidden",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(m,{})}),(0,t.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden",children:l})]})]})]})})}function f(e){var l,s,i,d;let{children:o}=e,{user:c,isLoading:u,isAuthenticated:x}=(0,n.a)(),m=(0,a.useRouter)();return((0,r.useEffect)(()=>{var e,l,s,t,r;if(!u){if(!x||!c){m.replace("/login");return}if(!((null===(e=c.roles)||void 0===e?void 0:e.includes("ADMIN"))||(null===(l=c.roles)||void 0===l?void 0:l.includes("SUPER_ADMIN"))||(null===(s=c.permissions)||void 0===s?void 0:s.is_admin)||(null===(t=c.permissions)||void 0===t?void 0:t.is_super_admin))){console.log("\uD83D\uDD0D User lacks admin permissions, redirecting...",{userRoles:c.roles,userPermissions:c.permissions}),(null===(r=c.roles)||void 0===r?void 0:r.includes("TESTER"))?m.replace("/tester"):m.replace("/dashboard");return}}},[c,u,x,m]),u)?(0,t.jsx)("div",{className:"flex items-center justify-center h-screen",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Loading..."})]})}):x&&c&&((null===(l=c.roles)||void 0===l?void 0:l.includes("ADMIN"))||(null===(s=c.roles)||void 0===s?void 0:s.includes("SUPER_ADMIN"))||(null===(i=c.permissions)||void 0===i?void 0:i.is_admin)||(null===(d=c.permissions)||void 0===d?void 0:d.is_super_admin))?(0,t.jsx)(p,{children:o}):null}}},function(e){e.O(0,[236,787,322,971,23,744],function(){return e(e.s=42)}),_N_E=e.O()}]);