(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7],{2542:function(e,t,n){Promise.resolve().then(n.bind(n,250))},250:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return c}});var s=n(7437),r=n(2265),o=n(857),a=n(6463),i=n(7109),l=n(1806);function c(e){var t,n,c,u,d,h;let{children:m}=e,{user:p,isLoading:g,isAuthenticated:v}=(0,o.a)(),_=(0,a.useRouter)();return((0,r.useEffect)(()=>(l.U.send({type:"set",title:"Tester Dashboard",subtitle:"Monitor and improve AI responses"}),()=>l.U.send({type:"clear"})),[]),(0,r.useEffect)(()=>{var e,t,n,s,r,o,a,i;if(!g){if(!v||!p){_.replace("/login");return}if(!((null===(e=p.permissions)||void 0===e?void 0:e.is_tester)||(null===(t=p.permissions)||void 0===t?void 0:t.is_admin)||(null===(n=p.permissions)||void 0===n?void 0:n.is_super_admin)||(null===(s=p.roles)||void 0===s?void 0:s.includes("TESTER"))||(null===(r=p.roles)||void 0===r?void 0:r.includes("ADMIN"))||(null===(o=p.roles)||void 0===o?void 0:o.includes("SUPER_ADMIN")))){console.log("User lacks tester permissions, redirecting...",{userRoles:p.roles,userPermissions:p.permissions}),(null===(a=p.roles)||void 0===a?void 0:a.includes("ADMIN"))||(null===(i=p.roles)||void 0===i?void 0:i.includes("SUPER_ADMIN"))?_.replace("/admin"):_.replace("/dashboard");return}}},[p,g,v,_]),g)?(0,s.jsx)("div",{className:"flex items-center justify-center h-screen bg-white dark:bg-neutral-900",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400",children:"Loading..."})]})}):v&&p&&((null===(t=p.permissions)||void 0===t?void 0:t.is_tester)||(null===(n=p.permissions)||void 0===n?void 0:n.is_admin)||(null===(c=p.permissions)||void 0===c?void 0:c.is_super_admin)||(null===(u=p.roles)||void 0===u?void 0:u.includes("TESTER"))||(null===(d=p.roles)||void 0===d?void 0:d.includes("ADMIN"))||(null===(h=p.roles)||void 0===h?void 0:h.includes("SUPER_ADMIN")))?(0,s.jsx)(i.Z,{children:m}):null}},857:function(e,t,n){"use strict";n.d(t,{AuthProvider:function(){return l},a:function(){return c}});var s=n(7437),r=n(2265),o=n(6463),a=n(1785);let i=(0,r.createContext)({token:null,active_school_id:null,user:null,isLoading:!0,login:async()=>({}),logout:()=>{},setSchoolId:()=>{},isAuthenticated:!1,hasValidRole:!1});function l(e){var t,n,l,c;let{children:u}=e,[d,h]=(0,r.useState)({token:null,active_school_id:null,user:null,isLoading:!0}),m=(0,o.useRouter)();(0,r.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("active_school_id");if(e){a.O.storeToken(e);try{let n=await a.O.getCurrentUser();h({token:e,active_school_id:t,user:n,isLoading:!1})}catch(e){localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),h({token:null,active_school_id:null,user:null,isLoading:!1})}}else h({token:null,active_school_id:null,user:null,isLoading:!1})})()},[]);let p=async e=>{localStorage.setItem("token",e.token),a.O.storeToken(e.token);try{let t=await a.O.getCurrentUser();return h(n=>({...n,token:e.token,user:t,isLoading:!1})),t}catch(t){throw h(t=>({...t,token:e.token,user:null,isLoading:!1})),t}},g=!!(t=d.user)&&!!((null===(n=t.roles)||void 0===n?void 0:n.includes("TESTER"))||(null===(l=t.permissions)||void 0===l?void 0:l.is_admin)||(null===(c=t.permissions)||void 0===c?void 0:c.is_super_admin)),v={...d,login:p,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),a.O.logout(),h({token:null,active_school_id:null,user:null,isLoading:!1}),m.replace("/login")},setSchoolId:e=>{localStorage.setItem("active_school_id",e),a.O.storeSchoolId(e),h(t=>({...t,active_school_id:e}))},isAuthenticated:!!d.token&&!!d.user&&!d.isLoading,hasValidRole:g};return(0,s.jsx)(i.Provider,{value:v,children:u})}let c=()=>(0,r.useContext)(i)},8030:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var s=n(2265);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),o=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),a=e=>{let t=o(e);return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim()},l=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let u=(0,s.forwardRef)((e,t)=>{let{color:n="currentColor",size:r=24,strokeWidth:o=2,absoluteStrokeWidth:a,className:u="",children:d,iconNode:h,...m}=e;return(0,s.createElement)("svg",{ref:t,...c,width:r,height:r,stroke:n,strokeWidth:a?24*Number(o)/Number(r):o,className:i("lucide",u),...!d&&!l(m)&&{"aria-hidden":"true"},...m},[...h.map(e=>{let[t,n]=e;return(0,s.createElement)(t,n)}),...Array.isArray(d)?d:[d]])}),d=(e,t)=>{let n=(0,s.forwardRef)((n,o)=>{let{className:l,...c}=n;return(0,s.createElement)(u,{ref:o,iconNode:t,className:i("lucide-".concat(r(a(e))),"lucide-".concat(e),l),...c})});return n.displayName=a(e),n}},4207:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(8030).Z)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]])},518:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(8030).Z)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},6780:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(8030).Z)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},7589:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(8030).Z)("database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]])},2023:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(8030).Z)("file-text",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]])},9896:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(8030).Z)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]])},2873:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(8030).Z)("menu",[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]])},7390:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(8030).Z)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]])},4258:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(8030).Z)("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},500:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(8030).Z)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},497:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(8030).Z)("test-tube",[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]])},1240:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});let s=(0,n(8030).Z)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},459:function(e,t,n){"use strict";n.d(t,{x:function(){return o}});var s=n(8472);class r{handleApiError(e){!e.response||401!==e.response.status||(localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),window.location.pathname.includes("/login")||window.location.pathname.includes("/signup")||window.location.pathname.includes("/public")||(window.location.href="/login"))}async get(e,t){return this.client.get(e,{params:t})}async post(e,t){return this.client.post(e,t)}async put(e,t){return this.client.put(e,t)}async patch(e,t){return this.client.patch(e,t)}async delete(e){return this.client.delete(e)}async uploadFile(e,t,n){let s=new FormData;return s.append("file",t),n&&Object.keys(n).forEach(e=>{s.append(e,n[e])}),this.client.post(e,s,{headers:{"Content-Type":"multipart/form-data"}})}async healthCheck(){try{let e=await this.client.get("/healthz");return 200===e.status}catch(e){return!1}}getBaseURL(){return this.baseURL}setAuthToken(e){this.client.defaults.headers.common.Authorization="Bearer ".concat(e)}clearAuthToken(){delete this.client.defaults.headers.common.Authorization}static isSuccess(e){return e.status>=200&&e.status<300}static getErrorMessage(e){var t;if(null===(t=e.response)||void 0===t?void 0:t.data){let t=e.response.data;return t.detail||t.message||"An error occurred"}return e.message||"Network error"}constructor(){this.baseURL="http://localhost:8000",this.client=s.Z.create({baseURL:this.baseURL,timeout:3e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,e=>(this.handleApiError(e),Promise.reject(e)))}}let o=new r},1785:function(e,t,n){"use strict";n.d(t,{O:function(){return o}});var s=n(459);class r{async login(e){return(await s.x.post("/api/auth/login",e)).data}async register(e){return(await s.x.post("/api/auth/register",e)).data}async switchSchool(e){return(await s.x.post("/api/auth/switch-school",e)).data}async getCurrentUser(){return(await s.x.get("/api/auth/me")).data}async getUserPermissions(){return(await s.x.get("/api/auth/permissions")).data}hasRole(e,t){var n,s;return null!==(s=null==e?void 0:null===(n=e.roles)||void 0===n?void 0:n.includes(t))&&void 0!==s&&s}hasAnyRole(e,t){return null!=e&&!!e.roles&&t.some(t=>e.roles.includes(t))}isAdmin(e){return this.hasAnyRole(e,["ADMIN","SUPER_ADMIN"])}isSuperAdmin(e){return this.hasRole(e,"SUPER_ADMIN")}isTester(e){return this.hasRole(e,"TESTER")}getPrimaryRole(e){var t;return null!==(t=null==e?void 0:e.primary_role)&&void 0!==t?t:"PARENT"}formatRoleName(e){return({SUPER_ADMIN:"Super Admin",ADMIN:"Administrator",TESTER:"Tester",TEACHER:"Teacher",ACCOUNTANT:"Accountant",PARENT:"Parent"})[e]||e}getAvailableActions(e){let t=[];return e&&(e.can_manage_students&&t.push("manage_students"),e.can_manage_classes&&t.push("manage_classes"),e.can_manage_fees&&t.push("manage_fees"),e.can_manage_payments&&t.push("manage_payments"),e.can_manage_school&&t.push("manage_school"),e.can_manage_users&&t.push("manage_users"),e.can_view_logs&&t.push("view_logs"),e.can_manage_intent_config&&t.push("manage_intent_config"),e.can_access_tester_queue&&t.push("access_tester_queue"),e.can_submit_suggestions&&t.push("submit_suggestions"),e.can_manage_all_schools&&t.push("manage_all_schools"),e.can_access_system_settings&&t.push("access_system_settings")),t}logout(){localStorage.removeItem("token"),localStorage.removeItem("active_school_id")}getStoredToken(){return localStorage.getItem("token")}getStoredSchoolId(){return localStorage.getItem("active_school_id")}storeToken(e){localStorage.setItem("token",e)}storeSchoolId(e){localStorage.setItem("active_school_id",e)}}let o=new r}},function(e){e.O(0,[236,964,140,971,23,744],function(){return e(e.s=2542)}),_N_E=e.O()}]);