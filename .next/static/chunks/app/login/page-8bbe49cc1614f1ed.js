(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{6476:function(e,t,s){Promise.resolve().then(s.bind(s,8104))},8104:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return _}});var a=s(7437),r=s(6463),n=s(857),o=s(1785),l=s(2265),i=s(7138),c=s(9581);function u(){return(0,a.jsx)("nav",{className:"w-full",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex items-center h-16",children:[(0,a.jsx)("div",{className:"w-full md:w-auto flex justify-center md:justify-start",children:(0,a.jsx)(c.D2,{})}),(0,a.jsx)("div",{className:"hidden md:flex items-center space-x-4 ml-auto"})]})})})}function d(e){let{children:t,title:s,subtitle:r}=e;return(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 z-10",children:(0,a.jsx)(u,{})}),(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center px-6 py-12",children:(0,a.jsxs)("div",{className:"w-full max-w-md",children:[(0,a.jsxs)("div",{className:"mb-8 text-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-semibold mb-2",children:s}),r&&(0,a.jsx)("p",{className:"text-lg text-neutral-600 dark:text-neutral-400",children:r})]}),(0,a.jsx)("div",{className:"card p-6",children:t})]})})]})}var h=s(4839);function m(e){let{id:t,label:s,type:r="text",value:n,onChange:o,placeholder:l,required:i,error:c,helperText:u,autoComplete:d}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:t,className:"label",children:s}),(0,a.jsx)("input",{id:t,type:r,value:n,onChange:o,placeholder:l,autoComplete:d,required:i,"aria-invalid":!!c,"aria-describedby":c?"".concat(t,"-error"):u?"".concat(t,"-help"):void 0,className:(0,h.Z)("input",c&&"input-invalid")}),c?(0,a.jsx)("p",{id:"".concat(t,"-error"),role:"alert",className:"error-text mt-1",children:c}):u?(0,a.jsx)("p",{id:"".concat(t,"-help"),className:"helper mt-1",children:u}):null]})}let p=(0,s(8030).Z)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var g=s(5733);function v(e){let[t,s]=(0,l.useState)(!1);return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(m,{...e,type:t?"text":"password"}),(0,a.jsx)("button",{type:"button",onClick:()=>s(e=>!e),"aria-label":t?"Hide password":"Show password",className:"absolute right-3 top-[38px] text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200 transition-colors",children:t?(0,a.jsx)(p,{size:18}):(0,a.jsx)(g.Z,{size:18})})]})}var f=s(4308);function x(){let e=(0,r.useRouter)(),t=(0,r.useSearchParams)().get("next")||"/",{login:s,setSchoolId:c}=(0,n.a)(),[u,h]=(0,l.useState)(""),[p,g]=(0,l.useState)(""),[x,_]=(0,l.useState)(null),[w,j]=(0,l.useState)(!1);async function k(a){a.preventDefault(),_(null),j(!0);try{let a=await o.O.login({email:u,password:p}),r=null==a?void 0:a.access_token;if(!r)throw console.error("Login response:",a),Error("No access token in response");await s({token:r});let n=null==a?void 0:a.school_id;n?(c(n.toString()),e.replace(t)):e.replace("/onboarding/school?next=".concat(encodeURIComponent(t)))}catch(e){var r,n;console.error("Login error:",e),_((null==e?void 0:null===(n=e.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:r.detail)||(null==e?void 0:e.message)||"Login failed")}finally{j(!1)}}return(0,a.jsxs)(d,{title:"Welcome back",subtitle:"Sign in to manage your school",children:[(0,a.jsxs)("form",{onSubmit:k,className:"space-y-4",noValidate:!0,children:[(0,a.jsx)(m,{id:"email",label:"Email",type:"email",value:u,onChange:e=>h(e.target.value),placeholder:"email address",autoComplete:"email",required:!0}),(0,a.jsx)(v,{id:"password",label:"Password",value:p,onChange:e=>g(e.target.value),placeholder:"Password",autoComplete:"current-password",required:!0}),(0,a.jsx)(f.Z,{className:"w-full",disabled:w,children:w?"Signing in…":"Continue"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm mt-4",children:[(0,a.jsx)(i.default,{href:"/forgot-password",className:"link",children:"Forgot password?"}),(0,a.jsxs)("span",{className:"opacity-80",children:["Don't have an account? ",(0,a.jsx)(i.default,{href:"/signup",className:"link",children:"Create one"})]})]}),x&&(0,a.jsx)("p",{className:"error-text mt-3",role:"alert","aria-live":"polite",children:x})]})}function _(){return(0,a.jsx)(l.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(x,{})})}},4308:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var a=s(7437),r=s(4839);function n(e){let{className:t,children:s,...n}=e;return(0,a.jsx)("button",{className:(0,r.Z)("btn-primary",t),...n,children:s})}},9581:function(e,t,s){"use strict";s.d(t,{D2:function(){return d},K7:function(){return h},ZP:function(){return u}});var a=s(7437),r=s(7138),n=s(3027),o=s(4839);let l=(0,n.j)("flex items-center gap-3",{variants:{size:{sm:"",md:"",lg:""}},defaultVariants:{size:"sm"}}),i=(0,n.j)("relative rounded-xl bg-gradient-to-br from-[#1f7daf] to-[#104f73] grid place-items-center text-white font-bold shadow-lg ring-2 ring-[#1f7daf]/20",{variants:{size:{sm:"h-9 w-9 text-lg",md:"h-12 w-12 text-xl",lg:"h-16 w-16 text-2xl"}},defaultVariants:{size:"sm"}}),c=(0,n.j)("font-semibold bg-gradient-to-r from-[#1f7daf] to-[#104f73] bg-clip-text text-transparent",{variants:{size:{sm:"text-xl",md:"text-2xl",lg:"text-3xl"}},defaultVariants:{size:"sm"}});function u(e){let{size:t="sm",href:s="/",className:n,showText:u=!0}=e,d=(0,a.jsxs)("div",{className:(0,o.Z)(l({size:t}),n),children:[(0,a.jsx)("div",{className:i({size:t}),children:(0,a.jsx)("span",{className:"drop-shadow-sm",children:"O"})}),u&&(0,a.jsx)("span",{className:c({size:t}),children:"Olaji"})]});return s?(0,a.jsx)(r.default,{href:s,children:d}):d}function d(e){let{className:t}=e;return(0,a.jsx)(u,{size:"sm",className:t})}function h(e){let{size:t="sm",className:s}=e;return(0,a.jsx)(u,{size:t,showText:!1,href:void 0,className:s})}},857:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return i},a:function(){return c}});var a=s(7437),r=s(2265),n=s(6463),o=s(1785);let l=(0,r.createContext)({token:null,active_school_id:null,user:null,isLoading:!0,login:async()=>{},logout:()=>{},setSchoolId:()=>{},isAuthenticated:!1});function i(e){let{children:t}=e,[s,i]=(0,r.useState)({token:null,active_school_id:null,user:null,isLoading:!0}),c=(0,n.useRouter)();(0,r.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("active_school_id");if(e){o.O.storeToken(e);try{let s=await o.O.getCurrentUser();i({token:e,active_school_id:t,user:s,isLoading:!1})}catch(e){console.error("Failed to fetch user data:",e),localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),i({token:null,active_school_id:null,user:null,isLoading:!1})}}else i({token:null,active_school_id:null,user:null,isLoading:!1})})()},[]);let u=async e=>{localStorage.setItem("token",e.token),o.O.storeToken(e.token);try{var t,s,a;let r=await o.O.getCurrentUser();i(t=>({...t,token:e.token,user:r,isLoading:!1})),(null===(t=r.roles)||void 0===t?void 0:t.includes("TESTER"))?c.replace("/tester"):(null===(s=r.permissions)||void 0===s?void 0:s.is_admin)||(null===(a=r.permissions)||void 0===a?void 0:a.is_super_admin)?c.replace("/admin"):c.replace("/dashboard")}catch(t){throw console.error("Failed to fetch user data after login:",t),i(t=>({...t,token:e.token,user:null,isLoading:!1})),t}},d={...s,login:u,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),o.O.logout(),i({token:null,active_school_id:null,user:null,isLoading:!1}),c.replace("/login")},setSchoolId:e=>{localStorage.setItem("active_school_id",e),o.O.storeSchoolId(e),i(t=>({...t,active_school_id:e}))},isAuthenticated:!!s.token&&!!s.user&&!s.isLoading};return(0,a.jsx)(l.Provider,{value:d,children:t})}let c=()=>(0,r.useContext)(l)},5733:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(8030).Z)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},459:function(e,t,s){"use strict";s.d(t,{x:function(){return o}});var a=s(8472),r=s(357);class n{handleApiError(e){if(console.error("❌ API Error:",e),e.response){let t=e.response.status,s=e.response.data;switch(t){case 401:localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),window.location.pathname.includes("/login")||window.location.pathname.includes("/signup")||window.location.pathname.includes("/public")||(window.location.href="/login");break;case 403:console.warn("⚠️ Access forbidden:",(null==s?void 0:s.detail)||"Insufficient permissions");break;case 404:console.warn("⚠️ Resource not found:",(null==s?void 0:s.detail)||"Resource not found");break;case 422:console.warn("⚠️ Validation error:",(null==s?void 0:s.detail)||"Invalid request data");break;case 500:console.error("\uD83D\uDCA5 Server error:",(null==s?void 0:s.detail)||"Internal server error");break;default:console.error("\uD83D\uDCA5 HTTP ".concat(t,":"),(null==s?void 0:s.detail)||e.message)}}else e.request?console.error("\uD83C\uDF10 Network error - no response received:",e.message):console.error("⚙️ Request setup error:",e.message)}async get(e,t){return this.client.get(e,{params:t})}async post(e,t){return this.client.post(e,t)}async put(e,t){return this.client.put(e,t)}async patch(e,t){return this.client.patch(e,t)}async delete(e){return this.client.delete(e)}async uploadFile(e,t,s){let a=new FormData;return a.append("file",t),s&&Object.keys(s).forEach(e=>{a.append(e,s[e])}),this.client.post(e,a,{headers:{"Content-Type":"multipart/form-data"}})}async healthCheck(){try{let e=await this.client.get("/healthz");return 200===e.status}catch(e){return console.error("Health check failed:",e),!1}}getBaseURL(){return this.baseURL}setAuthToken(e){this.client.defaults.headers.common.Authorization="Bearer ".concat(e)}clearAuthToken(){delete this.client.defaults.headers.common.Authorization}static isSuccess(e){return e.status>=200&&e.status<300}static getErrorMessage(e){var t;if(null===(t=e.response)||void 0===t?void 0:t.data){let t=e.response.data;return t.detail||t.message||"An error occurred"}return e.message||"Network error"}constructor(){this.baseURL=r.env.NEXT_PUBLIC_API_URL||"http://localhost:8000",this.client=a.Z.create({baseURL:this.baseURL,timeout:3e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>(console.error("❌ Request interceptor error:",e),Promise.reject(e))),this.client.interceptors.response.use(e=>e,e=>(this.handleApiError(e),Promise.reject(e)))}}let o=new n},1785:function(e,t,s){"use strict";s.d(t,{O:function(){return n}});var a=s(459);class r{async login(e){return(await a.x.post("/api/auth/login",e)).data}async register(e){return(await a.x.post("/api/auth/register",e)).data}async switchSchool(e){return(await a.x.post("/api/auth/switch-school",e)).data}async getCurrentUser(){return(await a.x.get("/api/auth/me")).data}async getUserPermissions(){return(await a.x.get("/api/auth/permissions")).data}hasRole(e,t){var s,a;return null!==(a=null==e?void 0:null===(s=e.roles)||void 0===s?void 0:s.includes(t))&&void 0!==a&&a}hasAnyRole(e,t){return null!=e&&!!e.roles&&t.some(t=>e.roles.includes(t))}isAdmin(e){return this.hasAnyRole(e,["ADMIN","SUPER_ADMIN"])}isSuperAdmin(e){return this.hasRole(e,"SUPER_ADMIN")}isTester(e){return this.hasRole(e,"TESTER")}getPrimaryRole(e){var t;return null!==(t=null==e?void 0:e.primary_role)&&void 0!==t?t:"PARENT"}formatRoleName(e){return({SUPER_ADMIN:"Super Admin",ADMIN:"Administrator",TESTER:"Tester",TEACHER:"Teacher",ACCOUNTANT:"Accountant",PARENT:"Parent"})[e]||e}getAvailableActions(e){let t=[];return e&&(e.can_manage_students&&t.push("manage_students"),e.can_manage_classes&&t.push("manage_classes"),e.can_manage_fees&&t.push("manage_fees"),e.can_manage_payments&&t.push("manage_payments"),e.can_manage_school&&t.push("manage_school"),e.can_manage_users&&t.push("manage_users"),e.can_view_logs&&t.push("view_logs"),e.can_manage_intent_config&&t.push("manage_intent_config"),e.can_access_tester_queue&&t.push("access_tester_queue"),e.can_submit_suggestions&&t.push("submit_suggestions"),e.can_manage_all_schools&&t.push("manage_all_schools"),e.can_access_system_settings&&t.push("access_system_settings")),t}logout(){localStorage.removeItem("token"),localStorage.removeItem("active_school_id")}getStoredToken(){return localStorage.getItem("token")}getStoredSchoolId(){return localStorage.getItem("active_school_id")}storeToken(e){localStorage.setItem("token",e)}storeSchoolId(e){localStorage.setItem("active_school_id",e)}}let n=new r}},function(e){e.O(0,[236,787,971,23,744],function(){return e(e.s=6476)}),_N_E=e.O()}]);