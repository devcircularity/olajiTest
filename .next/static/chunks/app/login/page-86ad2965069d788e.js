(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{6476:function(e,t,s){Promise.resolve().then(s.bind(s,4977))},4977:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return v}});var a=s(7437),n=s(6463),r=s(857),l=s(1785),o=s(2265),i=s(7138),c=s(5520),u=s(4839);function d(e){let{id:t,label:s,type:n="text",value:r,onChange:l,placeholder:o,required:i,error:c,helperText:d,autoComplete:h}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:t,className:"label",children:s}),(0,a.jsx)("input",{id:t,type:n,value:r,onChange:l,placeholder:o,autoComplete:h,required:i,"aria-invalid":!!c,"aria-describedby":c?"".concat(t,"-error"):d?"".concat(t,"-help"):void 0,className:(0,u.Z)("input",c&&"input-invalid")}),c?(0,a.jsx)("p",{id:"".concat(t,"-error"),role:"alert",className:"error-text mt-1",children:c}):d?(0,a.jsx)("p",{id:"".concat(t,"-help"),className:"helper mt-1",children:d}):null]})}let h=(0,s(8030).Z)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var m=s(5733);function p(e){let[t,s]=(0,o.useState)(!1);return(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(d,{...e,type:t?"text":"password"}),(0,a.jsx)("button",{type:"button",onClick:()=>s(e=>!e),"aria-label":t?"Hide password":"Show password",className:"absolute right-3 top-[38px] text-neutral-500 hover:text-neutral-700 dark:text-neutral-400 dark:hover:text-neutral-200 transition-colors",children:t?(0,a.jsx)(h,{size:18}):(0,a.jsx)(m.Z,{size:18})})]})}var g=s(4308);function f(){let e=(0,n.useRouter)(),t=(0,n.useSearchParams)().get("next")||"/",{login:s,setSchoolId:u}=(0,r.a)(),[h,m]=(0,o.useState)(""),[f,v]=(0,o.useState)(""),[x,_]=(0,o.useState)(null),[w,j]=(0,o.useState)(!1);async function y(a){var n,r,o,i,c,d,m,p;a.preventDefault(),_(null),j(!0);try{let a=await l.O.login({email:h,password:f}),i=null==a?void 0:a.access_token;if(!i)throw console.error("Login response:",a),Error("No access token in response");let c=await s({token:i});if((null===(d=c.roles)||void 0===d||!d.includes("TESTER"))&&(null===(m=c.permissions)||void 0===m||!m.is_admin)&&(null===(p=c.permissions)||void 0===p||!p.is_super_admin)){_("Access denied. Please contact an administrator to request access.");return}let g=null==a?void 0:a.school_id;g&&u(g.toString()),(null===(n=c.roles)||void 0===n?void 0:n.includes("TESTER"))?e.replace("/tester"):(null===(r=c.permissions)||void 0===r?void 0:r.is_admin)||(null===(o=c.permissions)||void 0===o?void 0:o.is_super_admin)?e.replace("/admin"):g?e.replace(t):e.replace("/onboarding/school?next=".concat(encodeURIComponent(t)))}catch(e){console.error("Login error:",e),_((null==e?void 0:null===(c=e.response)||void 0===c?void 0:null===(i=c.data)||void 0===i?void 0:i.detail)||(null==e?void 0:e.message)||"Login failed")}finally{j(!1)}}return(0,a.jsxs)(c.default,{title:"Welcome back",subtitle:"Sign in to manage your school",children:[(0,a.jsxs)("form",{onSubmit:y,className:"space-y-4",noValidate:!0,children:[(0,a.jsx)(d,{id:"email",label:"Email",type:"email",value:h,onChange:e=>m(e.target.value),placeholder:"email address",autoComplete:"email",required:!0}),(0,a.jsx)(p,{id:"password",label:"Password",value:f,onChange:e=>v(e.target.value),placeholder:"Password",autoComplete:"current-password",required:!0}),(0,a.jsx)(g.default,{className:"w-full",disabled:w,children:w?"Signing inâ€¦":"Continue"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm mt-4",children:[(0,a.jsx)(i.default,{href:"/forgot-password",className:"link",children:"Forgot password?"}),(0,a.jsxs)("span",{className:"opacity-80",children:["Don't have an account? ",(0,a.jsx)("a",{href:"https://olaji.co/signup",className:"link",target:"_blank",rel:"noopener noreferrer",children:"Create one"})]})]}),x&&(0,a.jsx)("p",{className:"error-text mt-3",role:"alert","aria-live":"polite",children:x})]})}function v(){return(0,a.jsx)(o.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(f,{})})}},5520:function(e,t,s){"use strict";s.d(t,{default:function(){return l}});var a=s(7437),n=s(9581);function r(){return(0,a.jsx)("nav",{className:"w-full",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex items-center h-16",children:[(0,a.jsx)("div",{className:"w-full md:w-auto flex justify-center md:justify-start",children:(0,a.jsx)(n.D2,{})}),(0,a.jsx)("div",{className:"hidden md:flex items-center space-x-4 ml-auto"})]})})})}function l(e){let{children:t,title:s,subtitle:n}=e;return(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)("div",{className:"absolute top-0 left-0 right-0 z-10",children:(0,a.jsx)(r,{})}),(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center px-6 py-12",children:(0,a.jsxs)("div",{className:"w-full max-w-md",children:[(0,a.jsxs)("div",{className:"mb-8 text-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-semibold mb-2",children:s}),n&&(0,a.jsx)("p",{className:"text-lg text-neutral-600 dark:text-neutral-400",children:n})]}),(0,a.jsx)("div",{className:"card p-6",children:t})]})})]})}},4308:function(e,t,s){"use strict";s.d(t,{default:function(){return r}});var a=s(7437),n=s(4839);function r(e){let{className:t,children:s,...r}=e;return(0,a.jsx)("button",{className:(0,n.Z)("btn-primary",t),...r,children:s})}},9581:function(e,t,s){"use strict";s.d(t,{D2:function(){return d},K7:function(){return h},ZP:function(){return u}});var a=s(7437),n=s(7138),r=s(3027),l=s(4839);let o=(0,r.j)("flex items-center gap-3",{variants:{size:{sm:"",md:"",lg:""}},defaultVariants:{size:"sm"}}),i=(0,r.j)("relative rounded-xl bg-gradient-to-br from-[#1f7daf] to-[#104f73] grid place-items-center text-white font-bold shadow-lg ring-2 ring-[#1f7daf]/20",{variants:{size:{sm:"h-9 w-9 text-lg",md:"h-12 w-12 text-xl",lg:"h-16 w-16 text-2xl"}},defaultVariants:{size:"sm"}}),c=(0,r.j)("font-semibold bg-gradient-to-r from-[#1f7daf] to-[#104f73] bg-clip-text text-transparent",{variants:{size:{sm:"text-xl",md:"text-2xl",lg:"text-3xl"}},defaultVariants:{size:"sm"}});function u(e){let{size:t="sm",href:s="/",className:r,showText:u=!0,asLink:d=!0}=e,h=(0,a.jsxs)("div",{className:(0,l.Z)(o({size:t}),r),children:[(0,a.jsx)("div",{className:i({size:t}),children:(0,a.jsx)("span",{className:"drop-shadow-sm",children:"O"})}),u&&(0,a.jsx)("span",{className:c({size:t}),children:"Olaji"})]});return d&&s?(0,a.jsx)(n.default,{href:s,children:h}):h}function d(e){let{className:t,asLink:s=!1}=e;return(0,a.jsx)(u,{size:"sm",className:t,asLink:s})}function h(e){let{size:t="sm",className:s}=e;return(0,a.jsx)(u,{size:t,showText:!1,asLink:!1,className:s})}},857:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return i},a:function(){return c}});var a=s(7437),n=s(2265),r=s(6463),l=s(1785);let o=(0,n.createContext)({token:null,active_school_id:null,user:null,isLoading:!0,login:async()=>({}),logout:()=>{},setSchoolId:()=>{},isAuthenticated:!1,hasValidRole:!1});function i(e){var t,s,i,c;let{children:u}=e,[d,h]=(0,n.useState)({token:null,active_school_id:null,user:null,isLoading:!0}),m=(0,r.useRouter)();(0,n.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("active_school_id");if(e){l.O.storeToken(e);try{let s=await l.O.getCurrentUser();h({token:e,active_school_id:t,user:s,isLoading:!1})}catch(e){localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),h({token:null,active_school_id:null,user:null,isLoading:!1})}}else h({token:null,active_school_id:null,user:null,isLoading:!1})})()},[]);let p=async e=>{localStorage.setItem("token",e.token),l.O.storeToken(e.token);try{let t=await l.O.getCurrentUser();return h(s=>({...s,token:e.token,user:t,isLoading:!1})),t}catch(t){throw h(t=>({...t,token:e.token,user:null,isLoading:!1})),t}},g=!!(t=d.user)&&!!((null===(s=t.roles)||void 0===s?void 0:s.includes("TESTER"))||(null===(i=t.permissions)||void 0===i?void 0:i.is_admin)||(null===(c=t.permissions)||void 0===c?void 0:c.is_super_admin)),f={...d,login:p,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),l.O.logout(),h({token:null,active_school_id:null,user:null,isLoading:!1}),m.replace("/login")},setSchoolId:e=>{localStorage.setItem("active_school_id",e),l.O.storeSchoolId(e),h(t=>({...t,active_school_id:e}))},isAuthenticated:!!d.token&&!!d.user&&!d.isLoading,hasValidRole:g};return(0,a.jsx)(o.Provider,{value:f,children:u})}let c=()=>(0,n.useContext)(o)},8030:function(e,t,s){"use strict";s.d(t,{Z:function(){return d}});var a=s(2265);/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),r=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,s)=>s?s.toUpperCase():t.toLowerCase()),l=e=>{let t=r(e);return t.charAt(0).toUpperCase()+t.slice(1)},o=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return t.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim()},i=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.539.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let u=(0,a.forwardRef)((e,t)=>{let{color:s="currentColor",size:n=24,strokeWidth:r=2,absoluteStrokeWidth:l,className:u="",children:d,iconNode:h,...m}=e;return(0,a.createElement)("svg",{ref:t,...c,width:n,height:n,stroke:s,strokeWidth:l?24*Number(r)/Number(n):r,className:o("lucide",u),...!d&&!i(m)&&{"aria-hidden":"true"},...m},[...h.map(e=>{let[t,s]=e;return(0,a.createElement)(t,s)}),...Array.isArray(d)?d:[d]])}),d=(e,t)=>{let s=(0,a.forwardRef)((s,r)=>{let{className:i,...c}=s;return(0,a.createElement)(u,{ref:r,iconNode:t,className:o("lucide-".concat(n(l(e))),"lucide-".concat(e),i),...c})});return s.displayName=l(e),s}},5733:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});let a=(0,s(8030).Z)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},459:function(e,t,s){"use strict";s.d(t,{x:function(){return r}});var a=s(8472);class n{handleApiError(e){!e.response||401!==e.response.status||(localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),window.location.pathname.includes("/login")||window.location.pathname.includes("/signup")||window.location.pathname.includes("/public")||(window.location.href="/login"))}async get(e,t){return this.client.get(e,{params:t})}async post(e,t){return this.client.post(e,t)}async put(e,t){return this.client.put(e,t)}async patch(e,t){return this.client.patch(e,t)}async delete(e){return this.client.delete(e)}async uploadFile(e,t,s){let a=new FormData;return a.append("file",t),s&&Object.keys(s).forEach(e=>{a.append(e,s[e])}),this.client.post(e,a,{headers:{"Content-Type":"multipart/form-data"}})}async healthCheck(){try{let e=await this.client.get("/healthz");return 200===e.status}catch(e){return!1}}getBaseURL(){return this.baseURL}setAuthToken(e){this.client.defaults.headers.common.Authorization="Bearer ".concat(e)}clearAuthToken(){delete this.client.defaults.headers.common.Authorization}static isSuccess(e){return e.status>=200&&e.status<300}static getErrorMessage(e){var t;if(null===(t=e.response)||void 0===t?void 0:t.data){let t=e.response.data;return t.detail||t.message||"An error occurred"}return e.message||"Network error"}constructor(){this.baseURL="http://localhost:8000",this.client=a.Z.create({baseURL:this.baseURL,timeout:3e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,e=>(this.handleApiError(e),Promise.reject(e)))}}let r=new n},1785:function(e,t,s){"use strict";s.d(t,{O:function(){return r}});var a=s(459);class n{async login(e){return(await a.x.post("/api/auth/login",e)).data}async register(e){return(await a.x.post("/api/auth/register",e)).data}async switchSchool(e){return(await a.x.post("/api/auth/switch-school",e)).data}async getCurrentUser(){return(await a.x.get("/api/auth/me")).data}async getUserPermissions(){return(await a.x.get("/api/auth/permissions")).data}hasRole(e,t){var s,a;return null!==(a=null==e?void 0:null===(s=e.roles)||void 0===s?void 0:s.includes(t))&&void 0!==a&&a}hasAnyRole(e,t){return null!=e&&!!e.roles&&t.some(t=>e.roles.includes(t))}isAdmin(e){return this.hasAnyRole(e,["ADMIN","SUPER_ADMIN"])}isSuperAdmin(e){return this.hasRole(e,"SUPER_ADMIN")}isTester(e){return this.hasRole(e,"TESTER")}getPrimaryRole(e){var t;return null!==(t=null==e?void 0:e.primary_role)&&void 0!==t?t:"PARENT"}formatRoleName(e){return({SUPER_ADMIN:"Super Admin",ADMIN:"Administrator",TESTER:"Tester",TEACHER:"Teacher",ACCOUNTANT:"Accountant",PARENT:"Parent"})[e]||e}getAvailableActions(e){let t=[];return e&&(e.can_manage_students&&t.push("manage_students"),e.can_manage_classes&&t.push("manage_classes"),e.can_manage_fees&&t.push("manage_fees"),e.can_manage_payments&&t.push("manage_payments"),e.can_manage_school&&t.push("manage_school"),e.can_manage_users&&t.push("manage_users"),e.can_view_logs&&t.push("view_logs"),e.can_manage_intent_config&&t.push("manage_intent_config"),e.can_access_tester_queue&&t.push("access_tester_queue"),e.can_submit_suggestions&&t.push("submit_suggestions"),e.can_manage_all_schools&&t.push("manage_all_schools"),e.can_access_system_settings&&t.push("access_system_settings")),t}logout(){localStorage.removeItem("token"),localStorage.removeItem("active_school_id")}getStoredToken(){return localStorage.getItem("token")}getStoredSchoolId(){return localStorage.getItem("active_school_id")}storeToken(e){localStorage.setItem("token",e)}storeSchoolId(e){localStorage.setItem("active_school_id",e)}}let r=new n}},function(e){e.O(0,[236,964,971,23,744],function(){return e(e.s=6476)}),_N_E=e.O()}]);