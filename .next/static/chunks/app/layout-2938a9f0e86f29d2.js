(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{9090:function(e,t,o){Promise.resolve().then(o.t.bind(o,8877,23)),Promise.resolve().then(o.bind(o,857))},857:function(e,t,o){"use strict";o.d(t,{AuthProvider:function(){return i},a:function(){return c}});var s=o(7437),n=o(2265),a=o(6463),r=o(1785);let l=(0,n.createContext)({token:null,active_school_id:null,user:null,isLoading:!0,login:async()=>{},logout:()=>{},setSchoolId:()=>{},isAuthenticated:!1});function i(e){let{children:t}=e,[o,i]=(0,n.useState)({token:null,active_school_id:null,user:null,isLoading:!0}),c=(0,a.useRouter)();(0,n.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("active_school_id");if(e){r.O.storeToken(e);try{let o=await r.O.getCurrentUser();i({token:e,active_school_id:t,user:o,isLoading:!1})}catch(e){console.error("Failed to fetch user data:",e),localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),i({token:null,active_school_id:null,user:null,isLoading:!1})}}else i({token:null,active_school_id:null,user:null,isLoading:!1})})()},[]);let u=async e=>{localStorage.setItem("token",e.token),r.O.storeToken(e.token);try{var t,o,s;let n=await r.O.getCurrentUser();i(t=>({...t,token:e.token,user:n,isLoading:!1})),(null===(t=n.roles)||void 0===t?void 0:t.includes("TESTER"))?c.replace("/tester"):(null===(o=n.permissions)||void 0===o?void 0:o.is_admin)||(null===(s=n.permissions)||void 0===s?void 0:s.is_super_admin)?c.replace("/admin"):c.replace("/dashboard")}catch(t){throw console.error("Failed to fetch user data after login:",t),i(t=>({...t,token:e.token,user:null,isLoading:!1})),t}},d={...o,login:u,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),r.O.logout(),i({token:null,active_school_id:null,user:null,isLoading:!1}),c.replace("/login")},setSchoolId:e=>{localStorage.setItem("active_school_id",e),r.O.storeSchoolId(e),i(t=>({...t,active_school_id:e}))},isAuthenticated:!!o.token&&!!o.user&&!o.isLoading};return(0,s.jsx)(l.Provider,{value:d,children:t})}let c=()=>(0,n.useContext)(l)},459:function(e,t,o){"use strict";o.d(t,{x:function(){return r}});var s=o(8472),n=o(357);class a{handleApiError(e){if(console.error("❌ API Error:",e),e.response){let t=e.response.status,o=e.response.data;switch(t){case 401:localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),window.location.pathname.includes("/login")||window.location.pathname.includes("/signup")||window.location.pathname.includes("/public")||(window.location.href="/login");break;case 403:console.warn("⚠️ Access forbidden:",(null==o?void 0:o.detail)||"Insufficient permissions");break;case 404:console.warn("⚠️ Resource not found:",(null==o?void 0:o.detail)||"Resource not found");break;case 422:console.warn("⚠️ Validation error:",(null==o?void 0:o.detail)||"Invalid request data");break;case 500:console.error("\uD83D\uDCA5 Server error:",(null==o?void 0:o.detail)||"Internal server error");break;default:console.error("\uD83D\uDCA5 HTTP ".concat(t,":"),(null==o?void 0:o.detail)||e.message)}}else e.request?console.error("\uD83C\uDF10 Network error - no response received:",e.message):console.error("⚙️ Request setup error:",e.message)}async get(e,t){return this.client.get(e,{params:t})}async post(e,t){return this.client.post(e,t)}async put(e,t){return this.client.put(e,t)}async patch(e,t){return this.client.patch(e,t)}async delete(e){return this.client.delete(e)}async uploadFile(e,t,o){let s=new FormData;return s.append("file",t),o&&Object.keys(o).forEach(e=>{s.append(e,o[e])}),this.client.post(e,s,{headers:{"Content-Type":"multipart/form-data"}})}async healthCheck(){try{let e=await this.client.get("/healthz");return 200===e.status}catch(e){return console.error("Health check failed:",e),!1}}getBaseURL(){return this.baseURL}setAuthToken(e){this.client.defaults.headers.common.Authorization="Bearer ".concat(e)}clearAuthToken(){delete this.client.defaults.headers.common.Authorization}static isSuccess(e){return e.status>=200&&e.status<300}static getErrorMessage(e){var t;if(null===(t=e.response)||void 0===t?void 0:t.data){let t=e.response.data;return t.detail||t.message||"An error occurred"}return e.message||"Network error"}constructor(){this.baseURL=n.env.NEXT_PUBLIC_API_URL||"http://localhost:8000",this.client=s.Z.create({baseURL:this.baseURL,timeout:3e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>(console.error("❌ Request interceptor error:",e),Promise.reject(e))),this.client.interceptors.response.use(e=>e,e=>(this.handleApiError(e),Promise.reject(e)))}}let r=new a},1785:function(e,t,o){"use strict";o.d(t,{O:function(){return a}});var s=o(459);class n{async login(e){return(await s.x.post("/api/auth/login",e)).data}async register(e){return(await s.x.post("/api/auth/register",e)).data}async switchSchool(e){return(await s.x.post("/api/auth/switch-school",e)).data}async getCurrentUser(){return(await s.x.get("/api/auth/me")).data}async getUserPermissions(){return(await s.x.get("/api/auth/permissions")).data}hasRole(e,t){var o,s;return null!==(s=null==e?void 0:null===(o=e.roles)||void 0===o?void 0:o.includes(t))&&void 0!==s&&s}hasAnyRole(e,t){return null!=e&&!!e.roles&&t.some(t=>e.roles.includes(t))}isAdmin(e){return this.hasAnyRole(e,["ADMIN","SUPER_ADMIN"])}isSuperAdmin(e){return this.hasRole(e,"SUPER_ADMIN")}isTester(e){return this.hasRole(e,"TESTER")}getPrimaryRole(e){var t;return null!==(t=null==e?void 0:e.primary_role)&&void 0!==t?t:"PARENT"}formatRoleName(e){return({SUPER_ADMIN:"Super Admin",ADMIN:"Administrator",TESTER:"Tester",TEACHER:"Teacher",ACCOUNTANT:"Accountant",PARENT:"Parent"})[e]||e}getAvailableActions(e){let t=[];return e&&(e.can_manage_students&&t.push("manage_students"),e.can_manage_classes&&t.push("manage_classes"),e.can_manage_fees&&t.push("manage_fees"),e.can_manage_payments&&t.push("manage_payments"),e.can_manage_school&&t.push("manage_school"),e.can_manage_users&&t.push("manage_users"),e.can_view_logs&&t.push("view_logs"),e.can_manage_intent_config&&t.push("manage_intent_config"),e.can_access_tester_queue&&t.push("access_tester_queue"),e.can_submit_suggestions&&t.push("submit_suggestions"),e.can_manage_all_schools&&t.push("manage_all_schools"),e.can_access_system_settings&&t.push("access_system_settings")),t}logout(){localStorage.removeItem("token"),localStorage.removeItem("active_school_id")}getStoredToken(){return localStorage.getItem("token")}getStoredSchoolId(){return localStorage.getItem("active_school_id")}storeToken(e){localStorage.setItem("token",e)}storeSchoolId(e){localStorage.setItem("active_school_id",e)}}let a=new n},8877:function(){}},function(e){e.O(0,[404,236,971,23,744],function(){return e(e.s=9090)}),_N_E=e.O()}]);