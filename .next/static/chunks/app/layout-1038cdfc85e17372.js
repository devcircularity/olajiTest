(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{9090:function(e,t,s){Promise.resolve().then(s.t.bind(s,8877,23)),Promise.resolve().then(s.bind(s,857))},857:function(e,t,s){"use strict";s.d(t,{AuthProvider:function(){return l},a:function(){return c}});var o=s(7437),n=s(2265),a=s(6463),r=s(1785);let i=(0,n.createContext)({token:null,active_school_id:null,user:null,isLoading:!0,login:async()=>({}),logout:()=>{},setSchoolId:()=>{},isAuthenticated:!1,hasValidRole:!1});function l(e){var t,s,l,c;let{children:u}=e,[h,d]=(0,n.useState)({token:null,active_school_id:null,user:null,isLoading:!0}),g=(0,a.useRouter)();(0,n.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("active_school_id");if(e){r.O.storeToken(e);try{let s=await r.O.getCurrentUser();d({token:e,active_school_id:t,user:s,isLoading:!1})}catch(e){localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),d({token:null,active_school_id:null,user:null,isLoading:!1})}}else d({token:null,active_school_id:null,user:null,isLoading:!1})})()},[]);let _=async e=>{localStorage.setItem("token",e.token),r.O.storeToken(e.token);try{let t=await r.O.getCurrentUser();return d(s=>({...s,token:e.token,user:t,isLoading:!1})),t}catch(t){throw d(t=>({...t,token:e.token,user:null,isLoading:!1})),t}},m=!!(t=h.user)&&!!((null===(s=t.roles)||void 0===s?void 0:s.includes("TESTER"))||(null===(l=t.permissions)||void 0===l?void 0:l.is_admin)||(null===(c=t.permissions)||void 0===c?void 0:c.is_super_admin)),p={...h,login:_,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),r.O.logout(),d({token:null,active_school_id:null,user:null,isLoading:!1}),g.replace("/login")},setSchoolId:e=>{localStorage.setItem("active_school_id",e),r.O.storeSchoolId(e),d(t=>({...t,active_school_id:e}))},isAuthenticated:!!h.token&&!!h.user&&!h.isLoading,hasValidRole:m};return(0,o.jsx)(i.Provider,{value:p,children:u})}let c=()=>(0,n.useContext)(i)},459:function(e,t,s){"use strict";s.d(t,{x:function(){return a}});var o=s(8472);class n{handleApiError(e){!e.response||401!==e.response.status||(localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),window.location.pathname.includes("/login")||window.location.pathname.includes("/signup")||window.location.pathname.includes("/public")||(window.location.href="/login"))}async get(e,t){return this.client.get(e,{params:t})}async post(e,t){return this.client.post(e,t)}async put(e,t){return this.client.put(e,t)}async patch(e,t){return this.client.patch(e,t)}async delete(e){return this.client.delete(e)}async uploadFile(e,t,s){let o=new FormData;return o.append("file",t),s&&Object.keys(s).forEach(e=>{o.append(e,s[e])}),this.client.post(e,o,{headers:{"Content-Type":"multipart/form-data"}})}async healthCheck(){try{let e=await this.client.get("/healthz");return 200===e.status}catch(e){return!1}}getBaseURL(){return this.baseURL}setAuthToken(e){this.client.defaults.headers.common.Authorization="Bearer ".concat(e)}clearAuthToken(){delete this.client.defaults.headers.common.Authorization}static isSuccess(e){return e.status>=200&&e.status<300}static getErrorMessage(e){var t;if(null===(t=e.response)||void 0===t?void 0:t.data){let t=e.response.data;return t.detail||t.message||"An error occurred"}return e.message||"Network error"}constructor(){this.baseURL="http://localhost:8000",this.client=o.Z.create({baseURL:this.baseURL,timeout:3e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,e=>(this.handleApiError(e),Promise.reject(e)))}}let a=new n},1785:function(e,t,s){"use strict";s.d(t,{O:function(){return a}});var o=s(459);class n{async login(e){return(await o.x.post("/api/auth/login",e)).data}async register(e){return(await o.x.post("/api/auth/register",e)).data}async switchSchool(e){return(await o.x.post("/api/auth/switch-school",e)).data}async getCurrentUser(){return(await o.x.get("/api/auth/me")).data}async getUserPermissions(){return(await o.x.get("/api/auth/permissions")).data}hasRole(e,t){var s,o;return null!==(o=null==e?void 0:null===(s=e.roles)||void 0===s?void 0:s.includes(t))&&void 0!==o&&o}hasAnyRole(e,t){return null!=e&&!!e.roles&&t.some(t=>e.roles.includes(t))}isAdmin(e){return this.hasAnyRole(e,["ADMIN","SUPER_ADMIN"])}isSuperAdmin(e){return this.hasRole(e,"SUPER_ADMIN")}isTester(e){return this.hasRole(e,"TESTER")}getPrimaryRole(e){var t;return null!==(t=null==e?void 0:e.primary_role)&&void 0!==t?t:"PARENT"}formatRoleName(e){return({SUPER_ADMIN:"Super Admin",ADMIN:"Administrator",TESTER:"Tester",TEACHER:"Teacher",ACCOUNTANT:"Accountant",PARENT:"Parent"})[e]||e}getAvailableActions(e){let t=[];return e&&(e.can_manage_students&&t.push("manage_students"),e.can_manage_classes&&t.push("manage_classes"),e.can_manage_fees&&t.push("manage_fees"),e.can_manage_payments&&t.push("manage_payments"),e.can_manage_school&&t.push("manage_school"),e.can_manage_users&&t.push("manage_users"),e.can_view_logs&&t.push("view_logs"),e.can_manage_intent_config&&t.push("manage_intent_config"),e.can_access_tester_queue&&t.push("access_tester_queue"),e.can_submit_suggestions&&t.push("submit_suggestions"),e.can_manage_all_schools&&t.push("manage_all_schools"),e.can_access_system_settings&&t.push("access_system_settings")),t}logout(){localStorage.removeItem("token"),localStorage.removeItem("active_school_id")}getStoredToken(){return localStorage.getItem("token")}getStoredSchoolId(){return localStorage.getItem("active_school_id")}storeToken(e){localStorage.setItem("token",e)}storeSchoolId(e){localStorage.setItem("active_school_id",e)}}let a=new n},8877:function(){}},function(e){e.O(0,[404,236,971,23,744],function(){return e(e.s=9090)}),_N_E=e.O()}]);