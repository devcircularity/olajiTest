"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[745],{4308:function(e,t,a){a.d(t,{default:function(){return r}});var n=a(7437),s=a(4839);function r(e){let{className:t,children:a,...r}=e;return(0,n.jsx)("button",{className:(0,s.Z)("btn-primary",t),...r,children:a})}},7886:function(e,t,a){a.d(t,{Z:function(){return c}});var n=a(7437),s=a(2265),r=a(4817),l=a(518),o=a(7592),i=a(4308);function c(e){let{data:t,columns:a,actions:c,loading:d=!1,searchable:u=!1,searchPlaceholder:h="Search...",pagination:m,emptyMessage:g="No data available",className:p=""}=e,[x,v]=(0,s.useState)(""),[_,b]=(0,s.useState)(null),k=u?t.filter(e=>Object.values(e).some(e=>String(e).toLowerCase().includes(x.toLowerCase()))):t,f=_?[...k].sort((e,t)=>{let a=e[_.key],n=t[_.key];return a<n?"asc"===_.direction?-1:1:a>n?"asc"===_.direction?1:-1:0}):k,y=e=>{b(t=>(null==t?void 0:t.key)===e?{key:e,direction:"asc"===t.direction?"desc":"asc"}:{key:e,direction:"asc"})},w=(e,t)=>{let a=e[t.key];return t.render?t.render(a,e):a};return d?(0,n.jsx)("div",{className:"h-full flex items-center justify-center ".concat(p),children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-[--color-brand]"}),(0,n.jsx)("p",{className:"mt-2 text-neutral-600",children:"Loading..."})]})}):(0,n.jsxs)("div",{className:"h-full flex flex-col bg-white dark:bg-neutral-900 rounded-xl border border-neutral-200 dark:border-neutral-700 shadow-sm ".concat(p),children:[u&&(0,n.jsx)("div",{className:"flex-none p-4 border-b border-neutral-200 dark:border-neutral-700",children:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(r.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-neutral-400",size:16}),(0,n.jsx)("input",{type:"text",placeholder:h,value:x,onChange:e=>v(e.target.value),className:"w-full pl-10 pr-4 py-2 border border-neutral-300 dark:border-neutral-600 rounded-lg  bg-white dark:bg-neutral-800 focus:ring-2 focus:ring-[--color-brand] focus:border-transparent text-sm"})]})}),(0,n.jsx)("div",{className:"flex-1 min-h-0 overflow-auto",children:(0,n.jsxs)("table",{className:"w-full",children:[(0,n.jsx)("thead",{className:"bg-neutral-50 dark:bg-neutral-800 sticky top-0 z-10",children:(0,n.jsxs)("tr",{children:[a.map((e,t)=>(0,n.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider\n                    ".concat(e.sortable?"cursor-pointer hover:bg-neutral-100 dark:hover:bg-neutral-700":"","\n                    ").concat(e.width?"":"min-w-0"),style:e.width?{width:e.width,minWidth:e.width}:{},onClick:e.sortable?()=>y(String(e.key)):void 0,children:(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("span",{className:"truncate",children:e.label}),e.sortable&&(null==_?void 0:_.key)===e.key&&(0,n.jsx)("span",{className:"text-[--color-brand] flex-shrink-0",children:"asc"===_.direction?"↑":"↓"})]})},t)),c&&c.length>0&&(0,n.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-neutral-500 dark:text-neutral-400 uppercase tracking-wider w-32",children:"Actions"})]})}),(0,n.jsx)("tbody",{className:"divide-y divide-neutral-200 dark:divide-neutral-700",children:0===f.length?(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:a.length+(c?1:0),className:"px-4 py-8 text-center text-neutral-500 dark:text-neutral-400",children:g})}):f.map((e,t)=>(0,n.jsxs)("tr",{className:"hover:bg-neutral-50 dark:hover:bg-neutral-800/50",children:[a.map((t,a)=>(0,n.jsx)("td",{className:"px-4 py-3 text-sm text-neutral-900 dark:text-neutral-100",style:t.width?{width:t.width,minWidth:t.width}:{},children:(0,n.jsx)("div",{className:"min-w-0",children:w(e,t)})},a)),c&&c.length>0&&(0,n.jsx)("td",{className:"px-4 py-3 text-sm w-32",children:(0,n.jsx)("div",{className:"flex gap-1 flex-wrap",children:c.map((t,a)=>{var s;return(0,n.jsxs)(i.default,{onClick:()=>t.onClick(e),className:"btn-sm whitespace-nowrap ".concat("danger"===t.variant?"btn-danger":"secondary"===t.variant?"btn-secondary":"btn-primary"),disabled:null===(s=t.disabled)||void 0===s?void 0:s.call(t,e),title:t.label,children:[t.icon&&(0,n.jsx)("span",{className:"mr-1",children:t.icon}),(0,n.jsx)("span",{className:"hidden sm:inline",children:t.label}),(0,n.jsx)("span",{className:"sm:hidden",children:t.icon})]},a)})})})]},t))})]})}),m&&(0,n.jsxs)("div",{className:"flex-none px-4 py-3 border-t border-neutral-200 dark:border-neutral-700 flex items-center justify-between bg-neutral-50 dark:bg-neutral-800",children:[(0,n.jsxs)("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:["Page ",m.currentPage," of ",m.totalPages]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsxs)(i.default,{onClick:()=>m.onPageChange(m.currentPage-1),disabled:m.currentPage<=1,className:"btn-sm btn-secondary",children:[(0,n.jsx)(l.Z,{size:16}),(0,n.jsx)("span",{className:"hidden sm:inline ml-1",children:"Previous"})]}),(0,n.jsxs)(i.default,{onClick:()=>m.onPageChange(m.currentPage+1),disabled:m.currentPage>=m.totalPages,className:"btn-sm btn-secondary",children:[(0,n.jsx)("span",{className:"hidden sm:inline mr-1",children:"Next"}),(0,n.jsx)(o.Z,{size:16})]})]})]})]})}},857:function(e,t,a){a.d(t,{AuthProvider:function(){return i},a:function(){return c}});var n=a(7437),s=a(2265),r=a(6463),l=a(1785);let o=(0,s.createContext)({token:null,active_school_id:null,user:null,isLoading:!0,login:async()=>({}),logout:()=>{},setSchoolId:()=>{},isAuthenticated:!1,hasValidRole:!1});function i(e){var t,a,i,c;let{children:d}=e,[u,h]=(0,s.useState)({token:null,active_school_id:null,user:null,isLoading:!0}),m=(0,r.useRouter)();(0,s.useEffect)(()=>{(async()=>{let e=localStorage.getItem("token"),t=localStorage.getItem("active_school_id");if(e){l.O.storeToken(e);try{let a=await l.O.getCurrentUser();h({token:e,active_school_id:t,user:a,isLoading:!1})}catch(e){localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),h({token:null,active_school_id:null,user:null,isLoading:!1})}}else h({token:null,active_school_id:null,user:null,isLoading:!1})})()},[]);let g=async e=>{localStorage.setItem("token",e.token),l.O.storeToken(e.token);try{let t=await l.O.getCurrentUser();return h(a=>({...a,token:e.token,user:t,isLoading:!1})),t}catch(t){throw h(t=>({...t,token:e.token,user:null,isLoading:!1})),t}},p=!!(t=u.user)&&!!((null===(a=t.roles)||void 0===a?void 0:a.includes("TESTER"))||(null===(i=t.permissions)||void 0===i?void 0:i.is_admin)||(null===(c=t.permissions)||void 0===c?void 0:c.is_super_admin)),x={...u,login:g,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),l.O.logout(),h({token:null,active_school_id:null,user:null,isLoading:!1}),m.replace("/login")},setSchoolId:e=>{localStorage.setItem("active_school_id",e),l.O.storeSchoolId(e),h(t=>({...t,active_school_id:e}))},isAuthenticated:!!u.token&&!!u.user&&!u.isLoading,hasValidRole:p};return(0,n.jsx)(o.Provider,{value:x,children:d})}let c=()=>(0,s.useContext)(o)},459:function(e,t,a){a.d(t,{x:function(){return r}});var n=a(8472);class s{handleApiError(e){!e.response||401!==e.response.status||(localStorage.removeItem("token"),localStorage.removeItem("active_school_id"),window.location.pathname.includes("/login")||window.location.pathname.includes("/signup")||window.location.pathname.includes("/public")||(window.location.href="/login"))}async get(e,t){return this.client.get(e,{params:t})}async post(e,t){return this.client.post(e,t)}async put(e,t){return this.client.put(e,t)}async patch(e,t){return this.client.patch(e,t)}async delete(e){return this.client.delete(e)}async uploadFile(e,t,a){let n=new FormData;return n.append("file",t),a&&Object.keys(a).forEach(e=>{n.append(e,a[e])}),this.client.post(e,n,{headers:{"Content-Type":"multipart/form-data"}})}async healthCheck(){try{let e=await this.client.get("/healthz");return 200===e.status}catch(e){return!1}}getBaseURL(){return this.baseURL}setAuthToken(e){this.client.defaults.headers.common.Authorization="Bearer ".concat(e)}clearAuthToken(){delete this.client.defaults.headers.common.Authorization}static isSuccess(e){return e.status>=200&&e.status<300}static getErrorMessage(e){var t;if(null===(t=e.response)||void 0===t?void 0:t.data){let t=e.response.data;return t.detail||t.message||"An error occurred"}return e.message||"Network error"}constructor(){this.baseURL="http://localhost:8000",this.client=n.Z.create({baseURL:this.baseURL,timeout:3e4,headers:{"Content-Type":"application/json"}}),this.client.interceptors.request.use(e=>{let t=localStorage.getItem("token");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),this.client.interceptors.response.use(e=>e,e=>(this.handleApiError(e),Promise.reject(e)))}}let r=new s},1785:function(e,t,a){a.d(t,{O:function(){return r}});var n=a(459);class s{async login(e){return(await n.x.post("/api/auth/login",e)).data}async register(e){return(await n.x.post("/api/auth/register",e)).data}async switchSchool(e){return(await n.x.post("/api/auth/switch-school",e)).data}async getCurrentUser(){return(await n.x.get("/api/auth/me")).data}async getUserPermissions(){return(await n.x.get("/api/auth/permissions")).data}hasRole(e,t){var a,n;return null!==(n=null==e?void 0:null===(a=e.roles)||void 0===a?void 0:a.includes(t))&&void 0!==n&&n}hasAnyRole(e,t){return null!=e&&!!e.roles&&t.some(t=>e.roles.includes(t))}isAdmin(e){return this.hasAnyRole(e,["ADMIN","SUPER_ADMIN"])}isSuperAdmin(e){return this.hasRole(e,"SUPER_ADMIN")}isTester(e){return this.hasRole(e,"TESTER")}getPrimaryRole(e){var t;return null!==(t=null==e?void 0:e.primary_role)&&void 0!==t?t:"PARENT"}formatRoleName(e){return({SUPER_ADMIN:"Super Admin",ADMIN:"Administrator",TESTER:"Tester",TEACHER:"Teacher",ACCOUNTANT:"Accountant",PARENT:"Parent"})[e]||e}getAvailableActions(e){let t=[];return e&&(e.can_manage_students&&t.push("manage_students"),e.can_manage_classes&&t.push("manage_classes"),e.can_manage_fees&&t.push("manage_fees"),e.can_manage_payments&&t.push("manage_payments"),e.can_manage_school&&t.push("manage_school"),e.can_manage_users&&t.push("manage_users"),e.can_view_logs&&t.push("view_logs"),e.can_manage_intent_config&&t.push("manage_intent_config"),e.can_access_tester_queue&&t.push("access_tester_queue"),e.can_submit_suggestions&&t.push("submit_suggestions"),e.can_manage_all_schools&&t.push("manage_all_schools"),e.can_access_system_settings&&t.push("access_system_settings")),t}logout(){localStorage.removeItem("token"),localStorage.removeItem("active_school_id")}getStoredToken(){return localStorage.getItem("token")}getStoredSchoolId(){return localStorage.getItem("active_school_id")}storeToken(e){localStorage.setItem("token",e)}storeSchoolId(e){localStorage.setItem("active_school_id",e)}}let r=new s}}]);