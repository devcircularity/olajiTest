"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[581],{1806:function(e,t,r){r.d(t,{U:function(){return u},Z:function(){return x}});var s=r(7437),a=r(2265),l=r(857),n=r(7138),o=r(2873);function i(e){let{open:t,onClose:r,onLogout:l,userLabel:n,email:o,schoolId:i}=e;if((0,a.useEffect)(()=>{function e(e){"Escape"===e.key&&r()}return t&&document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,r]),!t)return null;let d=(n||o||"U").slice(0,1).toUpperCase();return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"fixed inset-0 z-[90] bg-black/40 backdrop-blur-[2px]",onClick:r}),(0,s.jsxs)("div",{className:"fixed right-4 top-16 z-[100] w-[360px] sm:w-[380px] rounded-[1.25rem] card border border-neutral-200/60 overflow-hidden shadow-[var(--shadow-soft)]",onClick:e=>e.stopPropagation(),role:"dialog","aria-modal":"true",children:[(0,s.jsxs)("div",{className:"relative px-4 py-3 bg-neutral-900/5 dark:bg-white/5",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("span",{className:"inline-flex h-8 w-8 items-center justify-center rounded-full bg-[--color-brand] text-white font-semibold",children:d}),(0,s.jsxs)("div",{className:"min-w-0",children:[o&&(0,s.jsx)("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 truncate",children:o}),(0,s.jsx)("div",{className:"text-sm font-medium truncate",children:n||"User"})]})]}),(0,s.jsx)("button",{onClick:r,className:"absolute right-3 top-3 text-neutral-500 hover:text-neutral-800 dark:hover:text-neutral-200","aria-label":"Close",children:"✕"})]}),(0,s.jsxs)("div",{className:"px-5 pt-4 pb-3",children:[(0,s.jsxs)("div",{className:"text-lg font-semibold",children:["Hi",n?", ".concat(n.split(" ")[0],"!"):"!"]}),(0,s.jsx)("button",{className:"mt-3 btn-primary w-full rounded-xl py-2.5",onClick:()=>alert("Manage account (stub)"),children:"Manage your Account"})]}),(0,s.jsx)("div",{className:"mx-4 mb-3 rounded-2xl bg-neutral-100 dark:bg-neutral-800 p-4",children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("div",{className:"text-xl leading-none",children:"\uD83C\uDFE0"}),(0,s.jsxs)("div",{className:"text-sm",children:[(0,s.jsx)("div",{className:"font-medium",children:"Set your school & year"}),(0,s.jsx)("div",{className:"text-neutral-600 dark:text-neutral-400",children:"Pick active school and academic year for better results."}),(0,s.jsxs)("div",{className:"mt-2 flex gap-3",children:[(0,s.jsx)("button",{className:"btn rounded-lg px-3 py-1.5 hover:bg-neutral-200 dark:hover:bg-neutral-700",children:"Dismiss"}),(0,s.jsx)("button",{className:"link-subtle",children:"Open settings"})]})]})]})}),(0,s.jsx)("div",{className:"px-4",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)("button",{className:"btn rounded-xl px-3 py-2 bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700",onClick:()=>alert("Add account (stub)"),children:"+ Add account"}),(0,s.jsx)("button",{className:"btn rounded-xl px-3 py-2 bg-neutral-100 dark:bg-neutral-800 hover:bg-neutral-200 dark:hover:bg-neutral-700",onClick:()=>{r(),l()},children:"Sign out"})]})}),(0,s.jsx)("div",{className:"mt-3 px-2 pb-2",children:(0,s.jsxs)("ul",{className:"grid gap-2",children:[(0,s.jsx)("li",{children:(0,s.jsxs)("button",{className:"w-full text-left rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800",children:["\uD83D\uDD0E ",(0,s.jsx)("span",{className:"ml-2",children:"Search history"}),(0,s.jsx)("span",{className:"float-right text-xs text-neutral-500",children:"Not saving"})]})}),(0,s.jsx)("li",{children:(0,s.jsxs)("button",{className:"w-full text-left rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800",children:["\uD83D\uDCC1 ",(0,s.jsx)("span",{className:"ml-2",children:"Saves & Collections"})]})}),(0,s.jsx)("li",{children:(0,s.jsxs)("button",{className:"w-full text-left rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800",children:["✨ ",(0,s.jsx)("span",{className:"ml-2",children:"Search personalization"})]})}),(0,s.jsxs)("li",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("button",{className:"rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 text-left",children:["\uD83D\uDEE1️ ",(0,s.jsx)("span",{className:"ml-2",children:"SafeSearch"}),(0,s.jsx)("div",{className:"text-xs text-neutral-500 ml-7 -mt-1",children:"Blurring on"})]}),(0,s.jsxs)("button",{className:"rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 text-left",children:["\uD83C\uDF10 ",(0,s.jsx)("span",{className:"ml-2",children:"Language"}),(0,s.jsx)("div",{className:"text-xs text-neutral-500 ml-7 -mt-1",children:"English"})]})]}),(0,s.jsxs)("li",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("button",{className:"rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 text-left",children:["⚙️ ",(0,s.jsx)("span",{className:"ml-2",children:"More settings"})]}),(0,s.jsxs)("button",{className:"rounded-xl px-3 py-2 hover:bg-neutral-100 dark:hover:bg-neutral-800 text-left",children:["❔ ",(0,s.jsx)("span",{className:"ml-2",children:"Help"})]})]})]})}),(0,s.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between text-xs text-neutral-600 dark:text-neutral-400 border-t border-neutral-200/70 dark:border-white/10",children:[(0,s.jsx)("div",{children:"Privacy Policy"}),(0,s.jsx)("div",{children:"Terms of Service"})]})]})]})}var d=r(7276);let c=new Set,u={send(e){c.forEach(t=>t(e))},on:e=>(c.add(e),()=>{c.delete(e)})};function x(){let{token:e,active_school_id:t,logout:r}=(0,l.a)(),[c,x]=(0,a.useState)(!1),[m,h]=(0,a.useState)(!1),[v,f]=(0,a.useState)(!1),[b,p]=(0,a.useState)(""),[g,j]=(0,a.useState)(""),N=(0,a.useRef)(null),k=(0,a.useMemo)(()=>(function(e){if(!e)return null;try{var t;let r=null===(t=e.split(".")[1])||void 0===t?void 0:t.replace(/-/g,"+").replace(/_/g,"/"),s=atob(r);return JSON.parse(s)}catch(e){return null}})(e||void 0),[e]),w=null==k?void 0:k.full_name,y=null==k?void 0:k.email,C=w||y||"Guest",E=function(e,t){var r;let s=(e||"").trim();return s?s.split(/\s+/).slice(0,2).map(e=>{var t;return(null===(t=e[0])||void 0===t?void 0:t.toUpperCase())||""}).join("")||"U":t&&(null===(r=t[0])||void 0===r?void 0:r.toUpperCase())||"U"}(w,y),_=null!=t?t:null==k?void 0:k.active_school_id;return(0,a.useEffect)(()=>{let e=()=>{f(window.innerWidth<1024)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,a.useEffect)(()=>u.on(e=>{"set"===e.type?(p(e.title),j(e.subtitle||"")):"clear"===e.type&&(p(""),j(""))}),[]),(0,a.useEffect)(()=>{function e(e){N.current&&!N.current.contains(e.target)&&h(!1)}return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]),(0,s.jsxs)("header",{className:"flex items-center justify-between px-4 py-3 border-b border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-900",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 min-w-0 flex-1",children:[v&&(0,s.jsx)("button",{onClick:()=>{d.z5.send({type:"toggle"})},className:"p-2 -ml-2 rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors","aria-label":"Toggle sidebar",children:(0,s.jsx)(o.Z,{size:20,className:"text-neutral-600 dark:text-neutral-400"})}),b&&(0,s.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,s.jsx)("h1",{className:"text-base sm:text-lg font-semibold text-neutral-900 dark:text-neutral-100 truncate",children:b}),g&&(0,s.jsx)("p",{className:"text-xs sm:text-sm text-neutral-600 dark:text-neutral-400 truncate",children:g})]})]}),(0,s.jsx)("div",{className:"flex items-center flex-shrink-0",children:e?(0,s.jsxs)("div",{className:"relative",ref:N,children:[(0,s.jsx)("button",{onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),onClick:()=>x(!0),className:"inline-flex h-10 w-10 items-center justify-center  rounded-full bg-[--color-brand] text-white font-semibold text-sm shadow-lg hover:shadow-xl ring-2 ring-[--color-brand]/30 dark:ring-[--color-brand]/40 border-2 border-[--color-brand-light]/50 hover:scale-105 active:scale-95 transition-all duration-200 ease-out","aria-label":"User menu",title:C,children:E}),m&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 card px-3 py-2 text-xs min-w-[200px] z-50",onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1),children:[(0,s.jsx)("div",{className:"font-medium truncate",children:C}),y&&(0,s.jsx)("div",{className:"text-neutral-600 dark:text-neutral-400 truncate",children:y})]}),(0,s.jsx)(i,{open:c,onClose:()=>x(!1),onLogout:r,userLabel:C,email:y||void 0,schoolId:_})]}):(0,s.jsxs)("div",{className:"flex items-center gap-3 text-sm",children:[(0,s.jsx)(n.default,{className:"link-subtle",href:"/login",children:"Login"}),(0,s.jsx)(n.default,{className:"link-subtle",href:"/signup",children:"Sign up"})]})})]})}},7276:function(e,t,r){r.d(t,{z5:function(){return D},ZP:function(){return L}});var s=r(7437),a=r(2265),l=r(6463),n=r(6195),o=r(857),i=r(6575),d=r(518),c=r(2513),u=r(6198),x=r(9338),m=r(6706),h=r(4258),v=r(9896),f=r(9581),b=r(3550),p=r(7494),g=r(5891),j=r(9913),N=r(883),k=r(4887);function w(e){let{isOpen:t,title:r,message:l,confirmText:n="Confirm",cancelText:o="Cancel",onConfirm:i,onCancel:d,variant:c="default"}=e;if((0,a.useEffect)(()=>{if(!t)return;let e=e=>{"Escape"===e.key&&d()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,d]),(0,a.useEffect)(()=>(t?document.body.style.overflow="hidden":document.body.style.overflow="",()=>{document.body.style.overflow=""}),[t]),!t)return null;let u=(()=>{switch(c){case"danger":return{backgroundColor:"var(--color-error)",color:"white",onHover:"var(--color-error-dark)"};case"warning":return{backgroundColor:"var(--color-warning)",color:"white",onHover:"var(--color-warning-dark)"};case"success":return{backgroundColor:"var(--color-success)",color:"white",onHover:"var(--color-success-dark)"};default:return{backgroundColor:"var(--color-brand)",color:"white",onHover:"var(--color-brand-dark)"}}})(),x=(0,s.jsxs)("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:d}),(0,s.jsxs)("div",{className:"relative bg-white dark:bg-neutral-800 rounded-2xl shadow-2xl max-w-md w-full p-6 border border-neutral-200 dark:border-neutral-700",children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold text-neutral-900 dark:text-neutral-100 mb-2",children:r}),(0,s.jsx)("p",{className:"text-neutral-600 dark:text-neutral-400",children:l})]}),(0,s.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,s.jsx)("button",{onClick:d,className:"px-4 py-2 rounded-lg border border-neutral-300 dark:border-neutral-600  bg-white dark:bg-neutral-800 text-neutral-700 dark:text-neutral-300 hover:bg-neutral-50 dark:hover:bg-neutral-700  transition-colors font-medium",children:o}),(0,s.jsx)("button",{onClick:i,className:"px-4 py-2 rounded-lg transition-colors font-medium",style:{backgroundColor:u.backgroundColor,color:u.color},onMouseEnter:e=>{e.currentTarget.style.backgroundColor=u.onHover},onMouseLeave:e=>{e.currentTarget.style.backgroundColor=u.backgroundColor},children:n})]})]})]});return"undefined"!=typeof document?(0,k.createPortal)(x,document.body):null}function y(e){let{chat:t,onUpdate:r,onDelete:l,forceVisible:o=!1}=e,[i,d]=(0,a.useState)(!1),[c,u]=(0,a.useState)(!1),[x,m]=(0,a.useState)(!1),[h,v]=(0,a.useState)(t.title),[f,k]=(0,a.useState)(!1),y=(0,a.useRef)(null),C=(0,a.useRef)(null);(0,a.useEffect)(()=>{function e(e){y.current&&!y.current.contains(e.target)&&d(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,a.useEffect)(()=>{c&&C.current&&(C.current.focus(),C.current.select())},[c]);let E=async e=>{if(e.preventDefault(),e.stopPropagation(),!f){k(!0);try{let e=await n.A.updateConversation(t.id,{is_archived:!t.is_archived});r(t.id,e)}catch(e){console.error("Failed to toggle archive:",e)}finally{k(!1),d(!1)}}},_=async e=>{if(e.preventDefault(),e.stopPropagation(),f)return;let s=h.trim();if(s&&s!==t.title){k(!0);try{let e=await n.A.updateConversation(t.id,{title:s});r(t.id,e)}catch(e){console.error("Failed to rename chat:",e),v(t.title)}finally{k(!1)}}u(!1)},S=()=>{v(t.title),u(!1)},z=async()=>{if(!f){k(!0);try{await n.A.deleteConversation(t.id),l(t.id)}catch(e){console.error("Failed to delete chat:",e)}finally{k(!1),m(!1)}}};return c?(0,s.jsx)("form",{onSubmit:_,className:"flex-1 mr-2",children:(0,s.jsx)("input",{ref:C,type:"text",value:h,onChange:e=>v(e.target.value),onBlur:S,onKeyDown:e=>{"Escape"===e.key&&S()},className:"w-full px-2 py-1 text-sm bg-white dark:bg-neutral-800 border border-neutral-300 dark:border-neutral-600 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",onClick:e=>e.stopPropagation(),disabled:f,maxLength:255})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"relative",ref:y,children:[(0,s.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),d(!i)},className:"p-1 rounded-md hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-opacity disabled:opacity-50 ".concat(o?"opacity-100":"opacity-0 group-hover:opacity-100"),title:"Chat options",disabled:f,children:(0,s.jsx)(b.Z,{size:16})}),i&&(0,s.jsxs)("div",{className:"absolute right-0 top-full mt-1 bg-white dark:bg-neutral-800 rounded-lg shadow-xl border border-neutral-200 dark:border-neutral-700 py-1 z-50 min-w-[160px]",children:[(0,s.jsx)("button",{onClick:E,disabled:f,className:"w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2 transition-colors disabled:opacity-50",children:t.is_archived?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Z,{size:16}),"Unarchive"]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g.Z,{size:16}),"Archive"]})}),(0,s.jsxs)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),u(!0),d(!1)},disabled:f,className:"w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2 transition-colors disabled:opacity-50",children:[(0,s.jsx)(j.Z,{size:16}),"Rename"]}),(0,s.jsxs)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),d(!1),m(!0)},disabled:f,className:"w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2 text-red-600 dark:text-red-400 transition-colors disabled:opacity-50",children:[(0,s.jsx)(N.Z,{size:16}),"Delete"]})]})]}),(0,s.jsx)(w,{isOpen:x,title:"Delete chat",message:"Are you sure you want to delete this chat?",confirmText:"Delete",cancelText:"Cancel",variant:"danger",onConfirm:z,onCancel:()=>{m(!1)}})]})}function C(e){let{collapsed:t,onCollapse:r,isMobile:b=!1}=e,[p,g]=(0,a.useState)([]),[j,N]=(0,a.useState)(!1),[k,w]=(0,a.useState)(!0),[C,E]=(0,a.useState)(!1),[_,S]=(0,a.useState)(null),z=(0,a.useRef)(null),{token:M,logout:D,isAuthenticated:L}=(0,o.a)(),I=(0,l.usePathname)(),P=(0,l.useRouter)(),U=(0,a.useMemo)(()=>{let e=I.match(/\/chat\/([^/]+)/);return e?e[1]:null},[I]),Z=(0,a.useMemo)(()=>(function(e){if(!e)return null;try{var t;let r=null===(t=e.split(".")[1])||void 0===t?void 0:t.replace(/-/g,"+").replace(/_/g,"/"),s=atob(r);return JSON.parse(s)}catch(e){return null}})(M||void 0),[M]),R=null==Z?void 0:Z.full_name,T=null==Z?void 0:Z.email,F=null==Z?void 0:Z.active_school_id,A=R||T||"Guest",H=function(e,t){var r;let s=(e||"").trim();return s?s.split(/\s+/).slice(0,2).map(e=>{var t;return(null===(t=e[0])||void 0===t?void 0:t.toUpperCase())||""}).join("")||"U":t&&(null===(r=t[0])||void 0===r?void 0:r.toUpperCase())||"U"}(R,T),O=(0,a.useCallback)(()=>{t||r(!0)},[t,r]);(0,a.useEffect)(()=>{function e(e){z.current&&!z.current.contains(e.target)&&N(!1)}return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);let B=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(L)try{e?E(!0):w(!0),S(null);let t=(await n.A.getConversations(1,50,!1)).conversations.map(e=>({id:e.id,title:e.title,is_starred:!1,last_activity:e.last_activity,message_count:e.message_count,is_archived:e.is_archived}));g(t)}catch(e){console.error("Failed to load chats:",e),S("Failed to load chats"),g([])}finally{w(!1),E(!1)}},[L]);!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e4;(function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{onConversationCreated:r,onConversationUpdated:s,onConversationDeleted:l,onMessageSent:n,onForceRefresh:o,enableAutoRefresh:d=!0,refreshInterval:c=3e4}=t,u=null!==(e=(0,i.rc)())&&void 0!==e?e:void 0,x=(0,a.useRef)();(0,a.useEffect)(()=>{if(!d)return;let e=()=>{x.current=setTimeout(()=>{!document.hidden&&o&&o(),e()},c)};return e(),()=>{x.current&&clearTimeout(x.current)}},[d,c,o]),(0,a.useEffect)(()=>{let e=[],t=e=>!e||e!==u;return r&&e.push(i.MN.subscribe("conversation_created",e=>{t(e.userId)&&e.conversationId&&r(e.conversationId,e.data)})),s&&e.push(i.MN.subscribe("conversation_updated",e=>{t(e.userId)&&e.conversationId&&s(e.conversationId,e.data)})),l&&e.push(i.MN.subscribe("conversation_deleted",e=>{t(e.userId)&&e.conversationId&&l(e.conversationId)})),n&&e.push(i.MN.subscribe("message_sent",e=>{t(e.userId)&&e.conversationId&&n(e.conversationId,e.data)})),o&&e.push(i.MN.subscribe("force_refresh",e=>{t(e.userId)&&o()})),()=>{e.forEach(e=>e())}},[u,r,s,l,n,o]),(0,a.useCallback)(()=>{i.MN.forceRefresh(u)},[u]),(0,a.useCallback)((e,t)=>{i.MN.conversationCreated(e,t,u)},[u]),(0,a.useCallback)((e,t)=>{i.MN.conversationUpdated(e,t,u)},[u]),(0,a.useCallback)(e=>{i.MN.conversationDeleted(e,u)},[u]),(0,a.useCallback)((e,t)=>{i.MN.messageSent(e,t,u)},[u])})({onConversationCreated:e,onConversationUpdated:e,onConversationDeleted:e,onMessageSent:e,onForceRefresh:e,enableAutoRefresh:!0,refreshInterval:t})}((0,a.useCallback)(()=>B(!0),[B]),3e4),(0,a.useEffect)(()=>{B()},[B]),(0,a.useEffect)(()=>{if(I.includes("/chat/")&&U&&"new"!==U){let e=setTimeout(()=>B(!0),1e3);return()=>clearTimeout(e)}},[U,B]),(0,a.useEffect)(()=>{if(!L)return;let e=setInterval(()=>{document.hidden||B(!0)},3e4);return()=>clearInterval(e)},[L,B]),(0,a.useEffect)(()=>{let e=()=>{L&&B(!0)},t=()=>{!document.hidden&&L&&B(!0)};return window.addEventListener("focus",e),document.addEventListener("visibilitychange",t),()=>{window.removeEventListener("focus",e),document.removeEventListener("visibilitychange",t)}},[L,B]);let V=(e,t)=>{g(r=>r.map(r=>r.id===e?{...r,title:t.title||r.title,is_starred:void 0===t.is_archived&&r.is_starred,is_archived:void 0!==t.is_archived?t.is_archived:r.is_archived}:r).sort((e,t)=>e.is_starred!==t.is_starred?(t.is_starred?1:0)-(e.is_starred?1:0):new Date(t.last_activity).getTime()-new Date(e.last_activity).getTime()))},K=e=>{g(t=>t.filter(t=>t.id!==e)),U===e&&(P.replace("/chat/new"),O())},W=()=>{B(!0)},G=e=>{P.push("/chat/".concat(e)),O()};return L?(0,s.jsxs)("aside",{className:"\n        border-r border-neutral-200/70 dark:border-white/10 \n        bg-white/70 dark:bg-neutral-900/60 backdrop-blur \n        flex flex-col h-full transition-all duration-300\n        ".concat(t?"w-[70px] cursor-pointer":"w-[260px]","\n      "),onClick:t?()=>r(!1):void 0,children:[(0,s.jsx)("div",{className:"px-2 py-3",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{className:"flex items-center ml-2",children:t?(0,s.jsx)(f.K7,{size:"sm"}):(0,s.jsx)(f.ZP,{size:"sm",href:"/"})}),!t&&(0,s.jsx)("div",{className:"flex items-center gap-1",children:(0,s.jsx)("button",{onClick:()=>r(!0),className:"p-1 rounded-md hover:bg-neutral-100 dark:hover:bg-neutral-800",title:"Collapse sidebar",children:(0,s.jsx)(d.Z,{size:18})})})]})}),(0,s.jsx)("div",{className:"px-2 pb-2",onClick:t?e=>e.stopPropagation():void 0,children:(0,s.jsxs)("button",{className:"w-full rounded-xl py-2 px-1 flex items-center font-medium transition-colors duration-200 hover:bg-neutral-100 dark:hover:bg-neutral-800",style:{color:"var(--color-brand)"},onClick:()=>{P.push("/"),O()},title:"New Chat",children:[(0,s.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 ml-2",style:{backgroundColor:"var(--color-brand)"},children:(0,s.jsx)(c.Z,{size:14,className:"text-white"})}),!t&&(0,s.jsx)("div",{className:"ml-3 overflow-hidden",children:(0,s.jsx)("span",{className:"whitespace-nowrap block",children:"New Chat"})})]})}),F&&(0,s.jsx)("div",{className:"px-2 pb-2",onClick:t?e=>e.stopPropagation():void 0,children:(0,s.jsxs)("button",{onClick:()=>{P.push("/school/".concat(F)),O()},className:"w-full flex items-center px-1 py-2 rounded-lg hover:bg-neutral-100 dark:hover:bg-neutral-800 transition-colors text-neutral-700 dark:text-neutral-200",title:t?"My School":void 0,children:[(0,s.jsx)(u.Z,{size:18,className:"flex-shrink-0 ml-2"}),!t&&(0,s.jsx)("div",{className:"ml-3 overflow-hidden",children:(0,s.jsx)("span",{className:"text-sm font-medium whitespace-nowrap block",children:"My School"})})]})}),!t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"px-2 py-1 flex items-center justify-between",children:[(0,s.jsx)("h3",{className:"text-xs uppercase tracking-wide text-neutral-500 dark:text-neutral-400 font-medium",children:"Recents"}),(C||k)&&(0,s.jsx)("div",{className:"w-3 h-3 border border-neutral-300 dark:border-neutral-600 border-t-transparent rounded-full animate-spin"})]}),(0,s.jsx)("div",{className:"flex-1 overflow-auto px-2",children:(0,s.jsx)("div",{className:"space-y-0.5",children:k&&!C?(0,s.jsx)("div",{className:"px-3 py-2 text-sm text-neutral-500",children:"Loading chats..."}):_?(0,s.jsxs)("div",{className:"px-3 py-2 text-sm text-red-500",children:[_,(0,s.jsx)("button",{onClick:W,className:"block mt-1 text-xs text-blue-500 hover:underline",children:"Retry"})]}):0===p.length?(0,s.jsxs)("div",{className:"px-3 py-2 text-sm text-neutral-500",children:["No chats yet.",(0,s.jsx)("button",{onClick:W,className:"block mt-1 text-xs text-blue-500 hover:underline",children:"Refresh"})]}):p.map(e=>{let t=U===e.id;return(0,s.jsxs)("div",{className:"\n                        group flex items-center rounded-lg transition-colors\n                        ".concat(t?"bg-neutral-200 dark:bg-neutral-700 hover:bg-neutral-250 dark:hover:bg-neutral-650":"hover:bg-neutral-100 dark:hover:bg-neutral-800","\n                      "),children:[(0,s.jsxs)("button",{onClick:()=>G(e.id),className:"flex items-center flex-1 px-3 py-1.5 min-w-0 text-left rounded-lg hover:bg-transparent",children:[e.is_starred&&(0,s.jsx)(x.Z,{size:14,className:"mr-2 text-yellow-400 fill-yellow-400 flex-shrink-0"}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsx)("span",{className:"block truncate text-sm text-neutral-700 dark:text-neutral-200",children:e.title})})]}),(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(y,{chat:{id:e.id,title:e.title,first_message:"",last_activity:e.last_activity,message_count:e.message_count,is_archived:e.is_archived,created_at:e.last_activity},onUpdate:(e,t)=>V(e,t),onDelete:K,forceVisible:t})})]},e.id)})})})]}),t&&(0,s.jsx)("div",{className:"flex-1"}),M&&(0,s.jsx)("div",{className:"border-t border-neutral-200/70 dark:border-white/10 p-3 mt-auto",onClick:t?e=>e.stopPropagation():void 0,children:(0,s.jsxs)("div",{className:"relative",ref:z,children:[(0,s.jsxs)("button",{onClick:()=>N(!j),className:"\n                w-full flex items-center gap-3 p-2 rounded-lg \n                hover:bg-neutral-100 dark:hover:bg-neutral-800 \n                transition-all duration-200 ease-out\n                ".concat(t?"justify-center":"","\n              "),title:t?"".concat(A).concat(T?" - ".concat(T):""):void 0,"aria-label":"User menu",children:[(0,s.jsx)("div",{className:" inline-flex h-8 w-8 items-center justify-center  rounded-full text-white font-semibold text-sm shadow-md hover:shadow-lg ring-2 ring-blue-500/20 dark:ring-blue-400/30 border border-blue-300/30 hover:scale-105 active:scale-95 transition-all duration-200 ease-out flex-shrink-0 ",style:{backgroundColor:"var(--color-brand)"},children:H}),!t&&(0,s.jsxs)("div",{className:"flex-1 text-left min-w-0",children:[(0,s.jsx)("div",{className:"text-sm font-medium truncate",children:A}),T&&(0,s.jsx)("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 truncate",children:T})]})]}),j&&(0,s.jsxs)("div",{className:"\n                  absolute bottom-full mb-2 bg-white dark:bg-neutral-900 rounded-lg \n                  shadow-xl border border-neutral-200 dark:border-neutral-700 py-1 z-50\n                  backdrop-blur-sm\n                  ".concat(t?"left-full ml-2 w-48":"left-0 right-0","\n                "),children:[t&&(0,s.jsxs)("div",{className:"px-3 py-2 border-b border-neutral-200 dark:border-neutral-700",children:[(0,s.jsx)("div",{className:"font-medium text-sm truncate",children:A}),T&&(0,s.jsx)("div",{className:"text-xs text-neutral-500 dark:text-neutral-400 truncate",children:T})]}),(0,s.jsxs)("button",{onClick:()=>{N(!1),W()},className:"w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2 transition-colors",children:[(0,s.jsx)(m.Z,{size:16}),"Refresh Chats"]}),(0,s.jsxs)("button",{onClick:()=>{N(!1),P.push("/settings/profile"),O()},className:"w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2 transition-colors",children:[(0,s.jsx)(h.Z,{size:16}),"Settings"]}),(0,s.jsxs)("button",{onClick:()=>{D(),N(!1)},className:"w-full text-left px-3 py-2 text-sm hover:bg-neutral-100 dark:hover:bg-neutral-700 flex items-center gap-2 text-red-600 dark:text-red-400 transition-colors",children:[(0,s.jsx)(v.Z,{size:16}),"Logout"]})]})]})})]}):null}function E(e){let{open:t,width:r,onResize:l,onRequestClose:n}=e,[o,i]=(0,a.useState)(!1),d=(0,a.useRef)(0),c=(0,a.useRef)(r);return((0,a.useEffect)(()=>{c.current=r},[r]),(0,a.useEffect)(()=>{function e(e){if(!o)return;let t=d.current-e.clientX;l(Math.max(320,Math.min(800,c.current+t)))}function t(){i(!1)}return o&&(document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)),()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)}},[o,l]),t)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"absolute inset-0 z-[45]",onClick:n}),(0,s.jsxs)("div",{className:"relative z-[50] h-[calc(100svh-48px)] border-l border-neutral-200/70 dark:border-white/10 bg-white/80 dark:bg-neutral-900/70 backdrop-blur",style:{width:r},onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("div",{onMouseDown:e=>{i(!0),d.current=e.clientX},className:"absolute left-0 top-0 h-full w-1 cursor-col-resize bg-transparent",title:"Drag to resize",children:(0,s.jsx)("div",{className:"absolute left-[-2px] top-1/2 -translate-y-1/2 h-10 w-[3px] rounded-full bg-neutral-300/70 dark:bg-neutral-700/70"})}),(0,s.jsxs)("div",{className:"h-full overflow-auto p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("div",{className:"font-medium",children:"Canvas"}),(0,s.jsx)("button",{onClick:n,className:"btn rounded-lg px-3 py-1.5 hover:bg-neutral-100 dark:hover:bg-neutral-800",children:"Close"})]}),(0,s.jsxs)("div",{className:"card p-4",children:[(0,s.jsx)("p",{className:"text-sm text-neutral-700 dark:text-neutral-300",children:"This area can show context, notes, inspector panels, or AI tools. Use the shell’s “Show Canvas” button or call the bus:"}),(0,s.jsx)("pre",{className:"mt-3 rounded-xl bg-neutral-100 dark:bg-neutral-800 p-3 text-xs overflow-auto",children:"import { CanvasBus } from '@/components/layout/WorkspaceShell'\n\n// Open with a custom width\nCanvasBus.send({ type: 'open', width: 520 })\n\n// Toggle\nCanvasBus.send({ type: 'toggle' })\n"})]})]})]})]}):(0,s.jsx)("div",{style:{width:0}})}var _=r(1806);let S=new Set,z={send(e){S.forEach(t=>t(e))},on:e=>(S.add(e),()=>{S.delete(e)})},M=new Set,D={send(e){M.forEach(t=>t(e))},on:e=>(M.add(e),()=>{M.delete(e)})};function L(e){let{children:t}=e,[r,l]=(0,a.useState)(!0),[n,o]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=()=>{let e=window.innerWidth<1024;o(e),e&&l(!0)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,a.useEffect)(()=>{"0"!==localStorage.getItem("sidebar_collapsed")||n||l(!1)},[n]);let i=e=>{console.log("Toggle sidebar called:",{newState:e,currentCollapsed:r,isMobile:n}),l(t=>{let r=void 0!==e?e:!t;return console.log("Sidebar state changing from",t,"to",r),n||localStorage.setItem("sidebar_collapsed",r?"1":"0"),r})};(0,a.useEffect)(()=>D.on(e=>{console.log("SidebarBus command received:",e,{isMobile:n,collapsed:r}),"toggle"===e.type&&i(),"open"===e.type&&i(!1),"close"===e.type&&i(!0),"auto-collapse"!==e.type||n||r||(console.log("Auto-collapsing sidebar after user action"),i(!0))}),[i,n,r]);let[d,c]=(0,a.useState)(!1),[u,x]=(0,a.useState)(420);return(0,a.useEffect)(()=>{if(n){c(!1);return}let e=localStorage.getItem("canvas_open"),t=localStorage.getItem("canvas_width");return e&&c("1"===e),t&&x(Math.max(320,Math.min(800,parseInt(t,10)||420))),z.on(e=>{!n&&("open"===e.type&&c(!0),"close"===e.type&&c(!1),"toggle"===e.type&&c(e=>!e),e.width&&x(Math.max(320,Math.min(800,e.width))))})},[n]),(0,a.useEffect)(()=>{n||localStorage.setItem("canvas_open",d?"1":"0")},[d,n]),(0,a.useEffect)(()=>{n||localStorage.setItem("canvas_width",String(u))},[u,n]),(0,s.jsx)("div",{className:"h-svh w-full overflow-hidden",children:(0,s.jsxs)("div",{className:"flex-1 overflow-hidden relative h-full",children:[n&&!r&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 z-30",onClick:()=>i(!0)}),(0,s.jsxs)("div",{className:"relative flex overflow-hidden h-full",children:[(0,s.jsx)("div",{className:"\n            transition-all duration-300 ease-in-out\n            ".concat(n?"fixed left-0 top-0 h-full w-80 z-40 ".concat(r?"-translate-x-full":"translate-x-0"):"relative z-10 ".concat(r?"w-16":"w-auto"),"\n          "),children:(0,s.jsx)(C,{collapsed:r&&!n,onCollapse:i,isMobile:n})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0 flex flex-col h-full overflow-hidden",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)(_.Z,{})}),(0,s.jsx)("div",{className:"flex-1 min-h-0 overflow-hidden",children:t})]}),!n&&(0,s.jsx)(E,{open:d,width:u,onResize:x,onRequestClose:()=>c(!1)})]})]})})}},9581:function(e,t,r){r.d(t,{D2:function(){return u},K7:function(){return x},ZP:function(){return c}});var s=r(7437),a=r(7138),l=r(3027),n=r(4839);let o=(0,l.j)("flex items-center gap-3",{variants:{size:{sm:"",md:"",lg:""}},defaultVariants:{size:"sm"}}),i=(0,l.j)("relative rounded-xl bg-gradient-to-br from-[#1f7daf] to-[#104f73] grid place-items-center text-white font-bold shadow-lg ring-2 ring-[#1f7daf]/20",{variants:{size:{sm:"h-9 w-9 text-lg",md:"h-12 w-12 text-xl",lg:"h-16 w-16 text-2xl"}},defaultVariants:{size:"sm"}}),d=(0,l.j)("font-semibold bg-gradient-to-r from-[#1f7daf] to-[#104f73] bg-clip-text text-transparent",{variants:{size:{sm:"text-xl",md:"text-2xl",lg:"text-3xl"}},defaultVariants:{size:"sm"}});function c(e){let{size:t="sm",href:r="/",className:l,showText:c=!0}=e,u=(0,s.jsxs)("div",{className:(0,n.Z)(o({size:t}),l),children:[(0,s.jsx)("div",{className:i({size:t}),children:(0,s.jsx)("span",{className:"drop-shadow-sm",children:"O"})}),c&&(0,s.jsx)("span",{className:d({size:t}),children:"Olaji"})]});return r?(0,s.jsx)(a.default,{href:r,children:u}):u}function u(e){let{className:t}=e;return(0,s.jsx)(c,{size:"sm",className:t})}function x(e){let{size:t="sm",className:r}=e;return(0,s.jsx)(c,{size:t,showText:!1,href:void 0,className:r})}}}]);